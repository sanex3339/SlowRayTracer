(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.PathTracer = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var Vector_1=require("./Vector"),Camera=function(){function t(t,r,e,o){this.position=t,this.direction=Vector_1.Vector.normalized(r),this.screenWidth=e,this.screenHeight=o,this.forwardVector=Vector_1.Vector.normalized(Vector_1.Vector.substract(this.direction,this.position)),this.rightVector=Vector_1.Vector.scaled(Vector_1.Vector.normalized(Vector_1.Vector.cross(this.forwardVector,new Vector_1.Vector(0,-1,0))),3),this.upVector=Vector_1.Vector.scaled(Vector_1.Vector.normalized(Vector_1.Vector.cross(this.forwardVector,this.rightVector)),3)}return t.prototype.getDirection=function(){return this.direction},t.prototype.getPosition=function(){return this.position},t.prototype.getForwardVector=function(){return this.forwardVector},t.prototype.getRightVector=function(){return this.rightVector},t.prototype.getUpVector=function(){return this.upVector},t.prototype.recenterX=function(t){var r=this.screenHeight/this.screenWidth*2;return(t-this.screenWidth/2)/r/this.screenWidth},t.prototype.recenterY=function(t){return-(t-this.screenHeight/2)/2/this.screenHeight},t}();exports.Camera=Camera;


},{"./Vector":16}],2:[function(require,module,exports){
var FloatColor_1=require("./FloatColor"),Color=function(){function o(o){this.red=o.red,this.green=o.green,this.blue=o.blue}return o.prototype.add=function(e){return new o(new FloatColor_1.FloatColor(this.red+e.red,this.green+e.green,this.blue+e.blue))},o.prototype.substract=function(e){return new o(new FloatColor_1.FloatColor(this.red-e.red,this.green-e.green,this.blue-e.blue))},o.prototype.scaled=function(e){return new o(new FloatColor_1.FloatColor(this.red*e,this.green*e,this.blue*e))},o.prototype.multiple=function(e){return new o(new FloatColor_1.FloatColor(this.red*e.red,this.green*e.green,this.blue*e.blue))},o.prototype.divide=function(e){return new o(new FloatColor_1.FloatColor(this.red/e,this.green/e,this.blue/e))},o.sRGBEncode=function(o){return.0031308>=o?12.92*o:1.055*Math.pow(o,.4166667)-.055},o.toRGB=function(e){return{red:Math.floor(255*o.clampColor(e.red)),green:Math.floor(255*o.clampColor(e.green)),blue:Math.floor(255*o.clampColor(e.blue))}},o.clampColor=function(o){return o>1?1:o},o}();exports.Color=Color;


},{"./FloatColor":3}],3:[function(require,module,exports){
var FloatColor=function(){function o(o,t,r){this.red=o,this.green=t,this.blue=r}return o}();exports.FloatColor=FloatColor;


},{}],4:[function(require,module,exports){
var RGBColor=function(){function o(t,r,n){this.red=o.toFloat(t),this.green=o.toFloat(r),this.blue=o.toFloat(n)}return o.toFloat=function(o){return 0===o?o:o/255},o}();exports.RGBColor=RGBColor;


},{}],5:[function(require,module,exports){
var AbstractLight=function(){function t(){}return t}();exports.AbstractLight=AbstractLight;


},{}],6:[function(require,module,exports){
var __extends=this&&this.__extends||function(t,r){function e(){this.constructor=t}for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)},AbstractLight_1=require("./AbstractLight"),Color_1=require("./../Color/Color"),Material_1=require("./../Material"),RGBColor_1=require("./../Color/RGBColor"),RTMath_1=require("./../RTMath"),Vector_1=require("./../Vector"),SphericalLight=function(t){function r(r,e,o){t.call(this),this.radius=50,this.fadeRadius=2500,this.material=new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(244,244,244)),0).setLambertCoeff(1),this.type="light",this.position=r,this.power=e,o&&(this.radius=o)}return __extends(r,t),r.prototype.getFadeRadius=function(){return this.radius+this.fadeRadius},r.prototype.getPosition=function(){return this.position},r.prototype.getPower=function(){return this.power},r.prototype.getRadius=function(){return this.radius},r.prototype.getRandomPoint=function(){var t=Math.random(),r=Math.random(),e=2*Math.PI*t,o=Math.pow(Math.cos(2*r-1),-1);return new Vector_1.Vector(this.radius*Math.cos(e)*Math.sin(o),this.radius*Math.sin(e)*Math.sin(o),this.radius*Math.cos(o))},r.prototype.getIntersectData=function(t){var r,e,o,i,a,s,n,h=Vector_1.Vector.substract(t.getOrigin(),this.position),c=Vector_1.Vector.dot(h,t.getDirection()),u=Vector_1.Vector.dot(h,h)-Math.pow(this.radius,2),p=Math.pow(c,2)-u;if(!(c>0||0>p||p>=0&&(r=-c+Math.sqrt(p),e=-c-Math.sqrt(p),o=Math.min(r,e),i=Math.max(r,e),a=o>RTMath_1.RTMath.EPSILON?o:i,a<RTMath_1.RTMath.EPSILON)))return s=Vector_1.Vector.add(Vector_1.Vector.scaled(t.getDirection(),a),t.getOrigin()),n=Vector_1.Vector.substract(s,t.getOrigin()).getLength(),{point:s,distance:n}},r.prototype.getNormal=function(t){return Vector_1.Vector.normalized(Vector_1.Vector.scaled(Vector_1.Vector.substract(t,this.position),1/this.radius))},r.prototype.getMaterial=function(){return this.material},r.prototype.getType=function(){return this.type},r.prototype.setMaterial=function(t){return this.material=t,this},r}(AbstractLight_1.AbstractLight);exports.SphericalLight=SphericalLight;


},{"./../Color/Color":2,"./../Color/RGBColor":4,"./../Material":7,"./../RTMath":12,"./../Vector":16,"./AbstractLight":5}],7:[function(require,module,exports){
var Color_1=require("./Color/Color"),RGBColor_1=require("./Color/RGBColor"),Material=function(){function o(o,t){void 0===o&&(o=new Color_1.Color(new RGBColor_1.RGBColor(255,0,0))),void 0===t&&(t=0),this.lambertCoeff=.5,this.phongCoeff=.5,this.reflectionCoeff=0,this.color=o,this.reflectionCoeff=t}return o.prototype.getColor=function(){return this.color},o.prototype.getLambertCoeff=function(){return this.lambertCoeff},o.prototype.getPhongCoeff=function(){return this.phongCoeff},o.prototype.getReflectionValue=function(){return this.reflectionCoeff},o.prototype.setLambertCoeff=function(o){return this.lambertCoeff=o,this.phongCoeff=1-o,this},o.prototype.setPhongCoeff=function(o){return this.phongCoeff=o,this.lambertCoeff=1-o,this},o}();exports.Material=Material;


},{"./Color/Color":2,"./Color/RGBColor":4}],8:[function(require,module,exports){
var AbstractObject=function(){function t(){}return t}();exports.AbstractObject=AbstractObject;


},{}],9:[function(require,module,exports){
var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},RTMath_1=require("../RTMath"),AbstractObject_1=require("./AbstractObject"),Color_1=require("../Color/Color"),Material_1=require("../Material"),RGBColor_1=require("../Color/RGBColor"),Vector_1=require("../Vector"),Polygon=function(t){function e(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];t.call(this),this.material=new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(115,115,115)),0),this.type="surface",this.vertices=e}return __extends(e,t),e.prototype.getIntersectData=function(t){var r,o,i,c,s;if(o=Vector_1.Vector.dot(this.vertices[0],this.getNormal()),s=Vector_1.Vector.dot(this.getNormal(),t.getDirection()),c=-Vector_1.Vector.dot(this.getNormal(),t.getOrigin())+o,r=c/s,!(r<RTMath_1.RTMath.EPSILON)){t.setDistance(r),i=t.getHitPoint();for(var a=0;a<this.vertices.length;a++){var n=this.vertices[a],l=void 0;if(l=a===this.vertices.length-1?this.vertices[0]:this.vertices[a+1],!e.checkSameClockDir(Vector_1.Vector.substract(l,n),Vector_1.Vector.substract(i,n),this.getNormal()))return}return r=Vector_1.Vector.substract(i,t.getOrigin()).getLength(),{point:i,distance:r}}},e.prototype.getMaterial=function(){return this.material},e.prototype.getNormal=function(){var t=Vector_1.Vector.substract(this.vertices[2],this.vertices[0]),e=Vector_1.Vector.substract(this.vertices[1],this.vertices[0]);return Vector_1.Vector.normalized(Vector_1.Vector.cross(t,e))},e.prototype.getType=function(){return this.type},e.prototype.setMaterial=function(t){return this.material=t,this},e.checkSameClockDir=function(t,e,r){var o=Vector_1.Vector.cross(e,t);return Vector_1.Vector.dot(o,r)>=0},e}(AbstractObject_1.AbstractObject);exports.Polygon=Polygon;


},{"../Color/Color":2,"../Color/RGBColor":4,"../Material":7,"../RTMath":12,"../Vector":16,"./AbstractObject":8}],10:[function(require,module,exports){
var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},RTMath_1=require("../RTMath"),AbstractObject_1=require("./AbstractObject"),Color_1=require("../Color/Color"),Material_1=require("../Material"),RGBColor_1=require("../Color/RGBColor"),Vector_1=require("../Vector"),Sphere=function(t){function e(e,r){t.call(this),this.material=new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,0,0)),0),this.type="surface",this.center=e,this.radius=r}return __extends(e,t),e.prototype.getIntersectData=function(t){var e,r,o,i,a,c,n,s=Vector_1.Vector.substract(t.getOrigin(),this.center),h=Vector_1.Vector.dot(s,t.getDirection()),u=Vector_1.Vector.dot(s,s)-Math.pow(this.radius,2),l=Math.pow(h,2)-u;if(!(h>0||0>l||l>=0&&(e=-h+Math.sqrt(l),r=-h-Math.sqrt(l),o=Math.min(e,r),i=Math.max(e,r),a=o>RTMath_1.RTMath.EPSILON?o:i,a<RTMath_1.RTMath.EPSILON)))return c=Vector_1.Vector.add(Vector_1.Vector.scaled(t.getDirection(),a),t.getOrigin()),n=Vector_1.Vector.substract(c,t.getOrigin()).getLength(),{point:c,distance:n}},e.prototype.getMaterial=function(){return this.material},e.prototype.getNormal=function(t){return Vector_1.Vector.normalized(Vector_1.Vector.scaled(Vector_1.Vector.substract(t,this.center),1/this.radius))},e.prototype.getType=function(){return this.type},e.prototype.setMaterial=function(t){return this.material=t,this},e}(AbstractObject_1.AbstractObject);exports.Sphere=Sphere;


},{"../Color/Color":2,"../Color/RGBColor":4,"../Material":7,"../RTMath":12,"../Vector":16,"./AbstractObject":8}],11:[function(require,module,exports){
var Camera_1=require("./Camera"),Color_1=require("./Color/Color"),SphericalLight_1=require("./Lights/SphericalLight"),Material_1=require("./Material"),Polygon_1=require("./Objects/Polygon"),RGBColor_1=require("./Color/RGBColor"),Scene_1=require("./Scene"),Sphere_1=require("./Objects/Sphere"),Tracer_1=require("./Tracer"),Vector_1=require("./Vector"),screenWidth=100,screenHeight=100,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),image,tracer=new Tracer_1.Tracer;canvas.width=screenWidth,canvas.height=screenHeight,canvas.style.display="none",document.body.appendChild(canvas),tracer.setScene(new Scene_1.Scene({camera:new Camera_1.Camera(new Vector_1.Vector(0,0,-699),new Vector_1.Vector(0,0,1),screenWidth,screenHeight),lights:[new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,640,0),1.2,50).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255))))],objects:[new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(-700,-700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(-700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,700,-700),new Vector_1.Vector(700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(-700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,0,0)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),0).setLambertCoeff(1)),new Sphere_1.Sphere(new Vector_1.Vector(-250,-500,450),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),1)),new Sphere_1.Sphere(new Vector_1.Vector(250,-500,400),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,255,0)),0))]})),tracer.render(ctx,screenWidth,screenHeight),image=canvas.toDataURL("image/png"),document.write("<img src='"+image+"' />");


},{"./Camera":1,"./Color/Color":2,"./Color/RGBColor":4,"./Lights/SphericalLight":6,"./Material":7,"./Objects/Polygon":9,"./Objects/Sphere":10,"./Scene":14,"./Tracer":15,"./Vector":16}],12:[function(require,module,exports){
var RTMath;!function(t){t.EPSILON=.001}(RTMath=exports.RTMath||(exports.RTMath={}));


},{}],13:[function(require,module,exports){
var Vector_1=require("./Vector"),Ray=function(){function t(t,i,e){this.distance=0,this.iteration=8,this.origin=t,this.direction=Vector_1.Vector.normalized(i),e&&(this.iteration=e)}return t.prototype.getDirection=function(){return this.direction},t.prototype.getDistance=function(){return this.distance},t.prototype.getIteration=function(){return this.iteration},t.prototype.getOrigin=function(){return this.origin},t.prototype.getHitPoint=function(){return Vector_1.Vector.add(this.origin,Vector_1.Vector.scaled(this.direction,this.distance))},t.prototype.setDistance=function(t){this.distance=t},t.prototype.setIteration=function(t){this.iteration=t},t}();exports.Ray=Ray;


},{"./Vector":16}],14:[function(require,module,exports){
var Scene=function(){function t(t){this.objects=[],this.lights=[],this.objects=t.objects,this.camera=t.camera,this.lights=t.lights}return t.prototype.addObject=function(t){this.objects.push(t)},t.prototype.getCamera=function(){return this.camera},t.prototype.getLights=function(){return this.lights},t.prototype.getObjects=function(){return this.objects},t}();exports.Scene=Scene;


},{}],15:[function(require,module,exports){
var Color_1=require("./Color/Color"),Ray_1=require("./Ray"),RGBColor_1=require("./Color/RGBColor"),Vector_1=require("./Vector"),Tracer=function(){function e(){this.raysPerPixel=1,this.screenWidth=250,this.screenHeight=250}return e.prototype.getColor=function(e,o){void 0===o&&(o=!0);var t=this.trace(e),r=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0));return null===t.owner?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(r=this.getDiffuseColor(e,t,o),o&&(n=this.getReflectionColor(e,t)),r.add(n))},e.prototype.getDiffuseColor=function(e,o,t){void 0===t&&(t=!0);for(var r,n,i,a,l,c,s,g,C=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),d=0,V=this.scene.getLights();d<V.length;d++){var w=V[d];if("light"===o.ownerType)return o.owner.getMaterial().getColor();var _=this.getLightPower(o,w);if(r=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),i=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),a=Vector_1.Vector.normalized(Vector_1.Vector.substract(o.point,w.getPosition())),c=Math.max(0,-Vector_1.Vector.dot(a,o.owner.getNormal(o.point))),r=r.add(o.owner.getMaterial().getColor().multiple(w.getMaterial().getColor().scaled(_*c*o.owner.getMaterial().getLambertCoeff()))),t)for(var h=35,p=function(e){for(;;){var o=new Vector_1.Vector(Math.random()-.5,Math.random()-.5,Math.random()-.5);if(!(Vector_1.Vector.dot(o,o)>Math.pow(.5,2)))return o=Vector_1.Vector.normalized(o),Vector_1.Vector.dot(o,e)<0&&(o=Vector_1.Vector.inverse(o)),o}},u=0;h>u;++u){var R=p(o.owner.getNormal(o.point)),f=this.getColor(new Ray_1.Ray(o.point,R),!1),v=Vector_1.Vector.dot(R,o.owner.getNormal(o.point));n=n.add(o.owner.getMaterial().getColor().divide(Math.PI).multiple(f.scaled(v)))}l=Vector_1.Vector.reflect(a,o.owner.getNormal(o.point)),s=-Vector_1.Vector.dot(l,e.getDirection()),s>0&&(g=Math.pow(s,35),i=i.add(o.owner.getMaterial().getColor().multiple(w.getMaterial().getColor().scaled(_*g*o.owner.getMaterial().getPhongCoeff())))),C=C.add(r.add(n.divide(15))).add(i)}return C},e.prototype.getReflectionColor=function(e,o){var t,r;return e.setIteration(e.getIteration()-1),0===e.getIteration()||0===o.owner.getMaterial().getReflectionValue()?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(r=Vector_1.Vector.reflect(e.getDirection(),o.owner.getNormal(o.point)),t=this.getColor(new Ray_1.Ray(o.point,r,e.getIteration())).scaled(o.owner.getMaterial().getReflectionValue()))},e.prototype.getPerspectiveVector=function(e,o,t,r){var n=this.scene.getCamera();return Vector_1.Vector.normalized(Vector_1.Vector.add(n.getForwardVector(),Vector_1.Vector.add(Vector_1.Vector.scaled(n.getRightVector(),n.recenterX(e)),Vector_1.Vector.scaled(n.getUpVector(),n.recenterY(o)))))},e.prototype.getLightPower=function(e,o){for(var t,r=10,n=o.getPower(),i=0,a=0;r>a;a++){t=o.getRandomPoint();var l=this.trace(new Ray_1.Ray(e.point,Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),t),e.point)));null!==l.point&&l.owner===o&&(i+=(n-Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),t),e.point).getLength()*(n/o.getFadeRadius()))/r)}return i},e.prototype.trace=function(e){for(var o,t={distance:0,point:null,owner:null,ownerType:null},r=this.scene.getObjects().concat(this.scene.getLights()),n=0,i=r;n<i.length;n++){var a=i[n];o=a.getIntersectData(e),o&&o.distance>0&&(null===t.owner||o.distance<t.distance)&&(t.distance=o.distance,t.point=o.point,t.owner=a,t.ownerType=a.getType())}return t},e.prototype.render=function(e,o,t){var r,n,i,a,l=.5;this.screenWidth=o,this.screenHeight=t;for(var c=0;t>c;c++)for(var s=0;o>s;s++){r=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),console.log(c,s);for(var g=0;g<this.raysPerPixel;g++)n=0,console.log(g),this.raysPerPixel>1&&(g%2?n+=Math.random()*l:n-=Math.random()*l),i=new Ray_1.Ray(this.scene.getCamera().getPosition(),this.getPerspectiveVector(s+n,c+n,o,t)),r=r.add(this.getColor(i));r=r.divide(this.raysPerPixel);for(var C in r)r[C]=Color_1.Color.sRGBEncode(r[C]);a=Color_1.Color.toRGB(r),e.fillStyle="rgb("+a.red+", "+a.green+", "+a.blue+")",e.fillRect(s,c,s+1,c+1)}},e.prototype.setScene=function(e){this.scene=e},e}();exports.Tracer=Tracer;


},{"./Color/Color":2,"./Color/RGBColor":4,"./Ray":13,"./Vector":16}],16:[function(require,module,exports){
var Vector=function(){function t(t,n,r){this.x=t,this.y=n,this.z=r}return t.prototype.getCoordinates=function(){return{x:this.x,y:this.y,z:this.z}},t.prototype.asArray=function(){return[this.x,this.y,this.z]},t.prototype.getLength=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))},t.add=function(n,r){return new t(n.x+r.x,n.y+r.y,n.z+r.z)},t.substract=function(n,r){return new t(n.x-r.x,n.y-r.y,n.z-r.z)},t.scaled=function(n,r){return new t(n.x*r,n.y*r,n.z*r)},t.cross=function(n,r){return new t(n.y*r.z-n.z*r.y,n.z*r.x-n.x*r.z,n.x*r.y-n.y*r.x)},t.inverse=function(n){return t.scaled(n,-1)},t.dot=function(t,n){return t.x*n.x+t.y*n.y+t.z*n.z},t.normalized=function(n){return t.scaled(n,1/n.getLength())},t.reflect=function(n,r){var e=2*t.dot(n,r);return t.substract(n,t.scaled(r,e))},t}();exports.Vector=Vector;


},{}]},{},[11])(11)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvc291cmNlL0NhbWVyYS50cyIsIi9zb3VyY2UvQ29sb3IvQ29sb3IudHMiLCIvc291cmNlL0NvbG9yL0Zsb2F0Q29sb3IudHMiLCIvc291cmNlL0NvbG9yL1JHQkNvbG9yLnRzIiwiL3NvdXJjZS9MaWdodHMvQWJzdHJhY3RMaWdodC50cyIsIi9zb3VyY2UvTGlnaHRzL1NwaGVyaWNhbExpZ2h0LmpzIiwiL3NvdXJjZS9MaWdodHMvU3BoZXJpY2FsTGlnaHQudHMiLCIvc291cmNlL01hdGVyaWFsLnRzIiwiL3NvdXJjZS9PYmplY3RzL0Fic3RyYWN0T2JqZWN0LnRzIiwiL3NvdXJjZS9PYmplY3RzL1BvbHlnb24uanMiLCIvc291cmNlL09iamVjdHMvUG9seWdvbi50cyIsIi9zb3VyY2UvT2JqZWN0cy9TcGhlcmUuanMiLCIvc291cmNlL09iamVjdHMvU3BoZXJlLnRzIiwiL3NvdXJjZS9QYXRoVHJhY2VyLnRzIiwiL3NvdXJjZS9SVE1hdGgudHMiLCIvc291cmNlL1JheS50cyIsIi9zb3VyY2UvU2NlbmUudHMiLCIvc291cmNlL1RyYWNlci50cyIsIi9zb3VyY2UvVmVjdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsR0FBQSxVQUFBLFFBQXVCLFlBRXZCLE9BQUEsV0FTSSxRQUFBLEdBQWEsRUFBa0IsRUFBbUIsRUFBcUIsR0FDbkUsS0FBSyxTQUFXLEVBQ2hCLEtBQUssVUFBWSxTQUFBLE9BQU8sV0FBVyxHQUNuQyxLQUFLLFlBQWMsRUFDbkIsS0FBSyxhQUFlLEVBRXBCLEtBQUssY0FBZ0IsU0FBQSxPQUFPLFdBQVcsU0FBQSxPQUFPLFVBQVUsS0FBSyxVQUFXLEtBQUssV0FDN0UsS0FBSyxZQUFjLFNBQUEsT0FBTyxPQUN0QixTQUFBLE9BQU8sV0FDSCxTQUFBLE9BQU8sTUFDSCxLQUFLLGNBQ0wsR0FBSSxV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QUksWUFBQSxTQUFTLEdBQUksU0FBQSxNQUFNLEdBQUksWUFBQSxTQUFTLElBQUssSUFBSyxNQUFPLEdBQUcsZ0JBQWdCLElBRXRGLEdBQUksV0FBQSxRQUNBLEdBQUksVUFBQSxPQUFPLEtBQU0sSUFBSyxNQUN0QixHQUFJLFVBQUEsT0FBTyxLQUFNLElBQUssS0FDdEIsR0FBSSxVQUFBLE9BQU8sSUFBSyxJQUFLLEtBQ3JCLEdBQUksVUFBQSxPQUFPLElBQUssSUFBSyxPQUN2QixZQUFZLEdBQUksWUFBQSxTQUFTLEdBQUksU0FBQSxNQUFNLEdBQUksWUFBQSxTQUFTLElBQUssSUFBSyxNQUFPLEdBQUcsZ0JBQWdCLElBRXRGLEdBQUksV0FBQSxRQUNBLEdBQUksVUFBQSxPQUFPLElBQUssS0FBTSxLQUN0QixHQUFJLFVBQUEsT0FBTyxJQUFLLEtBQU0sTUFDdEIsR0FBSSxVQUFBLE9BQU8sSUFBSyxJQUFLLE1BQ3JCLEdBQUksVUFBQSxPQUFPLElBQUssSUFBSyxNQUN2QixZQUFZLEdBQUksWUFBQSxTQUFTLEdBQUksU0FBQSxNQUFNLEdBQUksWUFBQSxTQUFTLEVBQUcsRUFBRyxNQUFPLEdBQUcsZ0JBQWdCLElBRWxGLEdBQUksV0FBQSxRQUNBLEdBQUksVUFBQSxPQUFPLEtBQU0sS0FBTSxNQUN2QixHQUFJLFVBQUEsT0FBTyxLQUFNLEtBQU0sS0FDdkIsR0FBSSxVQUFBLE9BQU8sS0FBTSxJQUFLLEtBQ3RCLEdBQUksVUFBQSxPQUFPLEtBQU0sSUFBSyxPQUN4QixZQUFZLEdBQUksWUFBQSxTQUFTLEdBQUksU0FBQSxNQUFNLEdBQUksWUFBQSxTQUFTLElBQUssRUFBRyxJQUFLLEdBQUcsZ0JBQWdCLElBRWxGLEdBQUksV0FBQSxRQUNBLEdBQUksVUFBQSxPQUFPLElBQUssS0FBTSxNQUN0QixHQUFJLFVBQUEsT0FBTyxLQUFNLEtBQU0sTUFDdkIsR0FBSSxVQUFBLE9BQU8sS0FBTSxJQUFLLE1BQ3RCLEdBQUksVUFBQSxPQUFPLElBQUssSUFBSyxPQUN2QixZQUFZLEdBQUksWUFBQSxTQUFT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QUFPLGNBRzlCLEVBQUEsUUFBZCxTQUF1QixFQUFnQixHQUNuQyxHQUFJLEdBQUksRUFBSSxFQUFPLElBQUksRUFBUSxFQUUvQixPQUFPLEdBQU8sVUFDVixFQUNBLEVBQU8sT0FBTyxFQUFRLEtBR2xDLElBdkVhLFNBQUEsT0FBTSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgeyBWZWN0b3IgfSBmcm9tIFwiLi9WZWN0b3JcIjtcblxuZXhwb3J0IGNsYXNzIENhbWVyYSB7XG4gICAgcHJpdmF0ZSBkaXJlY3Rpb246IFZlY3RvcjtcbiAgICBwcml2YXRlIHBvc2l0aW9uOiBWZWN0b3I7XG4gICAgcHJpdmF0ZSBmb3J3YXJkVmVjdG9yOiBWZWN0b3I7XG4gICAgcHJpdmF0ZSByaWdodFZlY3RvcjogVmVjdG9yO1xuICAgIHByaXZhdGUgdXBWZWN0b3I6IFZlY3RvcjtcbiAgICBwcml2YXRlIHNjcmVlbldpZHRoOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBzY3JlZW5IZWlnaHQ6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yIChwb3NpdGlvbjogVmVjdG9yLCBkaXJlY3Rpb246IFZlY3Rvciwgc2NyZWVuV2lkdGg6IG51bWJlciwgc2NyZWVuSGVpZ2h0OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IFZlY3Rvci5ub3JtYWxpemVkKGRpcmVjdGlvbik7XG4gICAgICAgIHRoaXMuc2NyZWVuV2lkdGggPSBzY3JlZW5XaWR0aDtcbiAgICAgICAgdGhpcy5zY3JlZW5IZWlnaHQgPSBzY3JlZW5IZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5mb3J3YXJkVmVjdG9yID0gVmVjdG9yLm5vcm1hbGl6ZWQoVmVjdG9yLnN1YnN0cmFjdCh0aGlzLmRpcmVjdGlvbiwgdGhpcy5wb3NpdGlvbikpO1xuICAgICAgICB0aGlzLnJpZ2h0VmVjdG9yID0gVmVjdG9yLnNjYWxlZChcbiAgICAgICAgICAgIFZlY3Rvci5ub3JtYWxpemVkKFxuICAgICAgICAgICAgICAgIFZlY3Rvci5jcm9zcyhcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3J3YXJkVmVjdG9yLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDAsIC0xLCAwKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICAzXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMudXBWZWN0b3IgPSBWZWN0b3Iuc2NhbGVkKFxuICAgICAgICAgICAgVmVjdG9yLm5vcm1hbGl6ZWQoXG4gICAgICAgICAgICAgICAgVmVjdG9yLmNyb3NzKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcndhcmRWZWN0b3IsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmlnaHRWZWN0b3JcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgM1xuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXREaXJlY3Rpb24gKCk6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpcmVjdGlvbjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UG9zaXRpb24gKCk6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRGb3J3YXJkVmVjdG9yICgpOiBWZWN0b3Ige1xuICAgICAgICByZXR1cm4gdGhpcy5mb3J3YXJkVmVjdG9yO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRSaWdodFZlY3RvciAoKTogVmVjdG9yIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmlnaHRWZWN0b3I7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFVwVmVjdG9yICgpOiBWZWN0b3Ige1xuICAgICAgICByZXR1cm4gdGhpcy51cFZlY3RvcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVjZW50ZXJYICh4OiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICBsZXQgYXNwZWN0Q29lZmYgPSAodGhpcy5zY3JlZW5IZWlnaHQgLyB0aGlzLnNjcmVlbldpZHRoKSAqIDI7XG5cbiAgICAgICAgcmV0dXJuICh4IC0gKHRoaXMuc2NyZWVuV2lkdGggLyAyKSkgLyBhc3BlY3RDb2VmZiAvIHRoaXMuc2NyZWVuV2lkdGg7XG4gICAgfVxuXG4gICAgcHVibGljIHJlY2VudGVyWSAoeTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIC0oeSAtICh0aGlzLnNjcmVlbkhlaWdodCAvIDIpKSAvIDIgLyB0aGlzLnNjcmVlbkhlaWdodDtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBSR0JDb2xvciB9IGZyb20gXCIuL1JHQkNvbG9yXCI7XG5pbXBvcnQgeyBGbG9hdENvbG9yIH0gZnJvbSBcIi4vRmxvYXRDb2xvclwiO1xuXG5leHBvcnQgY2xhc3MgQ29sb3Ige1xuICAgIHJlZDogbnVtYmVyO1xuICAgIGdyZWVuOiBudW1iZXI7XG4gICAgYmx1ZTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IgKGNvbG9yOiBSR0JDb2xvcnxGbG9hdENvbG9yKSB7XG4gICAgICAgIHRoaXMucmVkID0gY29sb3IucmVkO1xuICAgICAgICB0aGlzLmdyZWVuID0gY29sb3IuZ3JlZW47XG4gICAgICAgIHRoaXMuYmx1ZSA9IGNvbG9yLmJsdWU7XG4gICAgfVxuXG4gICAgcHVibGljIGFkZCAoY29sb3I6IENvbG9yKTogQ29sb3Ige1xuICAgICAgICByZXR1cm4gbmV3IENvbG9yKFxuICAgICAgICAgICAgbmV3IEZsb2F0Q29sb3IoXG4gICAgICAgICAgICAgICAgdGhpcy5yZWQgKyBjb2xvci5yZWQsXG4gICAgICAgICAgICAgICAgdGhpcy5ncmVlbiArIGNvbG9yLmdyZWVuLFxuICAgICAgICAgICAgICAgIHRoaXMuYmx1ZSArIGNvbG9yLmJsdWVcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3Vic3RyYWN0IChjb2xvcjogQ29sb3IpOiBDb2xvciB7XG4gICAgICAgIHJldHVybiBuZXcgQ29sb3IoXG4gICAgICAgICAgICBuZXcgRmxvYXRDb2xvcihcbiAgICAgICAgICAgICAgICB0aGlzLnJlZCAtIGNvbG9yLnJlZCxcbiAgICAgICAgICAgICAgICB0aGlzLmdyZWVuIC0gY29sb3IuZ3JlZW4sXG4gICAgICAgICAgICAgICAgdGhpcy5ibHVlIC0gY29sb3IuYmx1ZVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBzY2FsZWQgKG11bHRpcGxpZXI6IG51bWJlcik6IENvbG9yIHtcbiAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihcbiAgICAgICAgICAgIG5ldyBGbG9hdENvbG9yKFxuICAgICAgICAgICAgICAgIHRoaXMucmVkICogbXVsdGlwbGllcixcbiAgICAgICAgICAgICAgICB0aGlzLmdyZWVuICogbXVsdGlwbGllcixcbiAgICAgICAgICAgICAgICB0aGlzLmJsdWUgKiBtdWx0aXBsaWVyXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIG11bHRpcGxlIChjb2xvcjogQ29sb3IpOiBDb2xvciB7XG4gICAgICAgIHJldHVybiBuZXcgQ29sb3IoXG4gICAgICAgICAgICBuZXcgRmxvYXRDb2xvcihcbiAgICAgICAgICAgICAgICB0aGlzLnJlZCAqIGNvbG9yLnJlZCxcbiAgICAgICAgICAgICAgICB0aGlzLmdyZWVuICogY29sb3IuZ3JlZW4sXG4gICAgICAgICAgICAgICAgdGhpcy5ibHVlICogY29sb3IuYmx1ZVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBkaXZpZGUgKHZhbHVlOiBudW1iZXIpOiBDb2xvciB7XG4gICAgICAgIHJldHVybiBuZXcgQ29sb3IoXG4gICAgICAgICAgICBuZXcgRmxvYXRDb2xvcihcbiAgICAgICAgICAgICAgICB0aGlzLnJlZCAvIHZhbHVlLFxuICAgICAgICAgICAgICAgIHRoaXMuZ3JlZW4gLyB2YWx1ZSxcbiAgICAgICAgICAgICAgICB0aGlzLmJsdWUgLyB2YWx1ZVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgc1JHQkVuY29kZSAoY29sb3I6IG51bWJlcikge1xuICAgICAgICBpZiAoY29sb3IgPD0gMC4wMDMxMzA4KSB7XG4gICAgICAgICAgICByZXR1cm4gMTIuOTIgKiBjb2xvcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAxLjA1NSAqIChjb2xvciAqKiAwLjQxNjY2NjcpIC0gMC4wNTU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHRvUkdCIChjb2xvcjogQ29sb3IpOiB7cmVkOiBudW1iZXIsIGdyZWVuOiBudW1iZXIsIGJsdWU6IG51bWJlcn0ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVkOiBNYXRoLmZsb29yKENvbG9yLmNsYW1wQ29sb3IoY29sb3IucmVkKSAqIDI1NSksXG4gICAgICAgICAgICBncmVlbjogTWF0aC5mbG9vcihDb2xvci5jbGFtcENvbG9yKGNvbG9yLmdyZWVuKSAqIDI1NSksXG4gICAgICAgICAgICBibHVlOiBNYXRoLmZsb29yKENvbG9yLmNsYW1wQ29sb3IoY29sb3IuYmx1ZSkgKiAyNTUpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBjbGFtcENvbG9yIChjb2xvcjogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGNvbG9yID4gMSA/IDEgOiBjb2xvcjtcbiAgICB9XG59XG4iLCJleHBvcnQgY2xhc3MgRmxvYXRDb2xvciB7XG4gICAgcHVibGljIHJlZDogbnVtYmVyO1xuICAgIHB1YmxpYyBncmVlbjogbnVtYmVyO1xuICAgIHB1YmxpYyBibHVlOiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3RvciAocmVkOiBudW1iZXIsIGdyZWVuOiBudW1iZXIsIGJsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLnJlZCA9IHJlZDtcbiAgICAgICAgdGhpcy5ncmVlbiA9IGdyZWVuO1xuICAgICAgICB0aGlzLmJsdWUgPSBibHVlO1xuICAgIH1cbn0iLCJleHBvcnQgY2xhc3MgUkdCQ29sb3Ige1xuICAgIHB1YmxpYyByZWQ6IG51bWJlcjtcbiAgICBwdWJsaWMgZ3JlZW46IG51bWJlcjtcbiAgICBwdWJsaWMgYmx1ZTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IgKHJlZDogbnVtYmVyLCBncmVlbjogbnVtYmVyLCBibHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5yZWQgPSBSR0JDb2xvci50b0Zsb2F0KHJlZCk7XG4gICAgICAgIHRoaXMuZ3JlZW4gPSBSR0JDb2xvci50b0Zsb2F0KGdyZWVuKTtcbiAgICAgICAgdGhpcy5ibHVlID0gUkdCQ29sb3IudG9GbG9hdChibHVlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyB0b0Zsb2F0IChjb2xvcjogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGNvbG9yID09PSAwID8gY29sb3IgOiBjb2xvciAvIDI1NTtcbiAgICB9XG59IiwiaW1wb3J0IHsgTWF0ZXJpYWwgfSBmcm9tIFwiLi4vTWF0ZXJpYWxcIjtcbmltcG9ydCB7IFJheSB9IGZyb20gXCIuLi9SYXlcIjtcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gXCIuLi9WZWN0b3JcIjtcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0TGlnaHQge1xuICAgIHB1YmxpYyBhYnN0cmFjdCBnZXRGYWRlUmFkaXVzICgpOiBudW1iZXI7XG4gICAgcHVibGljIGFic3RyYWN0IGdldFBvc2l0aW9uICgpOiBWZWN0b3I7XG4gICAgcHVibGljIGFic3RyYWN0IGdldFBvd2VyICgpOiBudW1iZXI7XG4gICAgcHVibGljIGFic3RyYWN0IGdldFJhZGl1cyAoKTogbnVtYmVyO1xuICAgIHB1YmxpYyBhYnN0cmFjdCBnZXRJbnRlcnNlY3REYXRhIChyYXk6IFJheSk6IGFueTtcbiAgICBwdWJsaWMgYWJzdHJhY3QgZ2V0Tm9ybWFsIChwb2ludDogVmVjdG9yKTogVmVjdG9yO1xuICAgIHB1YmxpYyBhYnN0cmFjdCBnZXRNYXRlcmlhbCAoKTogTWF0ZXJpYWw7XG4gICAgcHVibGljIGFic3RyYWN0IGdldFJhbmRvbVBvaW50ICgpOiBWZWN0b3I7XG4gICAgcHVibGljIGFic3RyYWN0IGdldFR5cGUgKCk6IHN0cmluZztcbiAgICBwdWJsaWMgYWJzdHJhY3Qgc2V0TWF0ZXJpYWwgKG1hdGVyaWFsOiBNYXRlcmlhbCk6IHRoaXM7XG59XG4iLCJ2YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBBYnN0cmFjdExpZ2h0XzEgPSByZXF1aXJlKFwiLi9BYnN0cmFjdExpZ2h0XCIpO1xudmFyIENvbG9yXzEgPSByZXF1aXJlKFwiLi8uLi9Db2xvci9Db2xvclwiKTtcbnZhciBNYXRlcmlhbF8xID0gcmVxdWlyZShcIi4vLi4vTWF0ZXJpYWxcIik7XG52YXIgUkdCQ29sb3JfMSA9IHJlcXVpcmUoXCIuLy4uL0NvbG9yL1JHQkNvbG9yXCIpO1xudmFyIFJUTWF0aF8xID0gcmVxdWlyZShcIi4vLi4vUlRNYXRoXCIpO1xudmFyIFZlY3Rvcl8xID0gcmVxdWlyZShcIi4vLi4vVmVjdG9yXCIpO1xudmFyIFNwaGVyaWNhbExpZ2h0ID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoU3BoZXJpY2FsTGlnaHQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gU3BoZXJpY2FsTGlnaHQocG9zaXRpb24sIHBvd2VyLCByYWRpdXMpIHtcbiAgICAgICAgX3N1cGVyLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMucmFkaXVzID0gNTA7XG4gICAgICAgIHRoaXMuZmFkZVJhZGl1cyA9IDI1MDA7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWxfMS5NYXRlcmlhbChuZXcgQ29sb3JfMS5Db2xvcihuZXcgUkdCQ29sb3JfMS5SR0JDb2xvcigyNDQsIDI0NCwgMjQ0KSksIDApLnNldExhbWJlcnRDb2VmZigxKTtcbiAgICAgICAgdGhpcy50eXBlID0gJ2xpZ2h0JztcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICB0aGlzLnBvd2VyID0gcG93ZXI7XG4gICAgICAgIGlmIChyYWRpdXMpIHtcbiAgICAgICAgICAgIHRoaXMucmFkaXVzID0gcmFkaXVzO1xuICAgICAgICB9XG4gICAgfVxuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5nZXRGYWRlUmFkaXVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yYWRpdXMgKyB0aGlzLmZhZGVSYWRpdXM7XG4gICAgfTtcbiAgICBTcGhlcmljYWxMaWdodC5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uO1xuICAgIH07XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldFBvd2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wb3dlcjtcbiAgICB9O1xuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5nZXRSYWRpdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJhZGl1cztcbiAgICB9O1xuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5nZXRSYW5kb21Qb2ludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHUgPSBNYXRoLnJhbmRvbSgpLCB2ID0gTWF0aC5yYW5kb20oKSwgcSA9IDIgKiBNYXRoLlBJICogdSwgZiA9IE1hdGgucG93KE1hdGguY29zKDIgKiB2IC0gMSksIC0xKTtcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3JfMS5WZWN0b3IodGhpcy5yYWRpdXMgKiBNYXRoLmNvcyhxKSAqIE1hdGguc2luKGYpLCB0aGlzLnJhZGl1cyAqIE1hdGguc2luKHEpICogTWF0aC5zaW4oZiksIHRoaXMucmFkaXVzICogTWF0aC5jb3MoZikpO1xuICAgIH07XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldEludGVyc2VjdERhdGEgPSBmdW5jdGlvbiAocmF5KSB7XG4gICAgICAgIHZhciBrID0gVmVjdG9yXzEuVmVjdG9yLnN1YnN0cmFjdChyYXkuZ2V0T3JpZ2luKCksIHRoaXMucG9zaXRpb24pLCBiID0gVmVjdG9yXzEuVmVjdG9yLmRvdChrLCByYXkuZ2V0RGlyZWN0aW9uKCkpLCBjID0gVmVjdG9yXzEuVmVjdG9yLmRvdChrLCBrKSAtIE1hdGgucG93KHRoaXMucmFkaXVzLCAyKSwgZCA9IE1hdGgucG93KGIsIDIpIC0gYywgdDEsIHQyLCBtaW5ULCBtYXhULCBpbnRlcnNlY3Rpb25Qb2ludCwgcG9pbnQsIGRpc3RhbmNlO1xuICAgICAgICBpZiAoYiA+IDAgfHwgZCA8IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZCA+PSAwKSB7XG4gICAgICAgICAgICB0MSA9IC1iICsgTWF0aC5zcXJ0KGQpO1xuICAgICAgICAgICAgdDIgPSAtYiAtIE1hdGguc3FydChkKTtcbiAgICAgICAgICAgIG1pblQgPSBNYXRoLm1pbih0MSwgdDIpO1xuICAgICAgICAgICAgbWF4VCA9IE1hdGgubWF4KHQxLCB0Mik7XG4gICAgICAgICAgICBpZiAobWluVCA+IFJUTWF0aF8xLlJUTWF0aC5FUFNJTE9OKSB7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQgPSBtaW5UO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQgPSBtYXhUO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGludGVyc2VjdGlvblBvaW50IDwgUlRNYXRoXzEuUlRNYXRoLkVQU0lMT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcG9pbnQgPSBWZWN0b3JfMS5WZWN0b3IuYWRkKFZlY3Rvcl8xLlZlY3Rvci5zY2FsZWQocmF5LmdldERpcmVjdGlvbigpLCBpbnRlcnNlY3Rpb25Qb2ludCksIHJheS5nZXRPcmlnaW4oKSk7XG4gICAgICAgIGRpc3RhbmNlID0gVmVjdG9yXzEuVmVjdG9yLnN1YnN0cmFjdChwb2ludCwgcmF5LmdldE9yaWdpbigpKS5nZXRMZW5ndGgoKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBvaW50OiBwb2ludCxcbiAgICAgICAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZVxuICAgICAgICB9O1xuICAgIH07XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldE5vcm1hbCA9IGZ1bmN0aW9uIChwb2ludCkge1xuICAgICAgICByZXR1cm4gVmVjdG9yXzEuVmVjdG9yLm5vcm1hbGl6ZWQoVmVjdG9yXzEuVmVjdG9yLnNjYWxlZChWZWN0b3JfMS5WZWN0b3Iuc3Vic3RyYWN0KHBvaW50LCB0aGlzLnBvc2l0aW9uKSwgMSAvIHRoaXMucmFkaXVzKSk7XG4gICAgfTtcbiAgICBTcGhlcmljYWxMaWdodC5wcm90b3R5cGUuZ2V0TWF0ZXJpYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1hdGVyaWFsO1xuICAgIH07XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldFR5cGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnR5cGU7XG4gICAgfTtcbiAgICBTcGhlcmljYWxMaWdodC5wcm90b3R5cGUuc2V0TWF0ZXJpYWwgPSBmdW5jdGlvbiAobWF0ZXJpYWwpIHtcbiAgICAgICAgdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBTcGhlcmljYWxMaWdodDtcbn0pKEFic3RyYWN0TGlnaHRfMS5BYnN0cmFjdExpZ2h0KTtcbmV4cG9ydHMuU3BoZXJpY2FsTGlnaHQgPSBTcGhlcmljYWxMaWdodDtcbiIsImltcG9ydCB7IEFic3RyYWN0TGlnaHQgfSBmcm9tIFwiLi9BYnN0cmFjdExpZ2h0XCI7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gXCIuLy4uL0NvbG9yL0NvbG9yXCI7XG5pbXBvcnQgeyBNYXRlcmlhbCB9IGZyb20gXCIuLy4uL01hdGVyaWFsXCI7XG5pbXBvcnQgeyBSYXkgfSBmcm9tIFwiLi8uLi9SYXlcIjtcbmltcG9ydCB7IFJHQkNvbG9yIH0gZnJvbSBcIi4vLi4vQ29sb3IvUkdCQ29sb3JcIjtcbmltcG9ydCB7IFJUTWF0aCB9IGZyb20gXCIuLy4uL1JUTWF0aFwiXG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tIFwiLi8uLi9WZWN0b3JcIjtcblxuZXhwb3J0IGNsYXNzIFNwaGVyaWNhbExpZ2h0IGV4dGVuZHMgQWJzdHJhY3RMaWdodCB7XG4gICAgcHJpdmF0ZSBwb3NpdGlvbjogVmVjdG9yO1xuICAgIHByaXZhdGUgcmFkaXVzOiBudW1iZXIgPSA1MDtcbiAgICBwcml2YXRlIHBvd2VyOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBmYWRlUmFkaXVzOiBudW1iZXIgPSAyNTAwO1xuICAgIHByaXZhdGUgbWF0ZXJpYWw6IE1hdGVyaWFsID0gbmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjQ0LCAyNDQsIDI0NCkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSk7XG4gICAgcHJpdmF0ZSB0eXBlOiBzdHJpbmcgPSAnbGlnaHQnO1xuXG4gICAgY29uc3RydWN0b3IgKHBvc2l0aW9uOiBWZWN0b3IsIHBvd2VyOiBudW1iZXIsIHJhZGl1cz86IG51bWJlcikge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgdGhpcy5wb3dlciA9IHBvd2VyO1xuXG4gICAgICAgIGlmIChyYWRpdXMpIHtcbiAgICAgICAgICAgIHRoaXMucmFkaXVzID0gcmFkaXVzO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldEZhZGVSYWRpdXMgKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnJhZGl1cyArIHRoaXMuZmFkZVJhZGl1cztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UG9zaXRpb24gKCk6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRQb3dlciAoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG93ZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFJhZGl1cyAoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmFkaXVzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRSYW5kb21Qb2ludCAoKTogVmVjdG9yIHtcbiAgICAgICAgbGV0IHUgPSBNYXRoLnJhbmRvbSgpLFxuICAgICAgICAgICAgdiA9IE1hdGgucmFuZG9tKCksXG4gICAgICAgICAgICBxID0gMiAqIE1hdGguUEkgKiB1LFxuICAgICAgICAgICAgZiA9IE1hdGgucG93KE1hdGguY29zKDIgKiB2IC0gMSksIC0xKTtcblxuICAgICAgICByZXR1cm4gbmV3IFZlY3RvcihcbiAgICAgICAgICAgIHRoaXMucmFkaXVzICogTWF0aC5jb3MocSkgKiBNYXRoLnNpbihmKSxcbiAgICAgICAgICAgIHRoaXMucmFkaXVzICogTWF0aC5zaW4ocSkgKiBNYXRoLnNpbihmKSxcbiAgICAgICAgICAgIHRoaXMucmFkaXVzICogTWF0aC5jb3MoZilcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0SW50ZXJzZWN0RGF0YSAocmF5OiBSYXkpOiBhbnkge1xuICAgICAgICBsZXQgayA9IFZlY3Rvci5zdWJzdHJhY3QocmF5LmdldE9yaWdpbigpLCB0aGlzLnBvc2l0aW9uKSxcbiAgICAgICAgICAgIGI6IG51bWJlciA9IFZlY3Rvci5kb3QoaywgcmF5LmdldERpcmVjdGlvbigpKSxcbiAgICAgICAgICAgIGM6IG51bWJlciA9IFZlY3Rvci5kb3QoaywgaykgLSB0aGlzLnJhZGl1cyAqKiAyLFxuICAgICAgICAgICAgZDogbnVtYmVyID0gYiAqKiAyIC0gYyxcbiAgICAgICAgICAgIHQxOiBudW1iZXIsXG4gICAgICAgICAgICB0MjogbnVtYmVyLFxuICAgICAgICAgICAgbWluVDogbnVtYmVyLFxuICAgICAgICAgICAgbWF4VDogbnVtYmVyLFxuICAgICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQ6IG51bWJlcixcbiAgICAgICAgICAgIHBvaW50OiBWZWN0b3IsXG4gICAgICAgICAgICBkaXN0YW5jZTogbnVtYmVyO1xuXG4gICAgICAgIGlmIChiID4gMCB8fCBkIDwgMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGQgPj0gMCkge1xuICAgICAgICAgICAgdDEgPSAtYiArIE1hdGguc3FydChkKTtcbiAgICAgICAgICAgIHQyID0gLWIgLSBNYXRoLnNxcnQoZCk7XG4gICAgICAgICAgICBtaW5UID0gTWF0aC5taW4odDEsIHQyKTtcbiAgICAgICAgICAgIG1heFQgPSBNYXRoLm1heCh0MSwgdDIpO1xuXG4gICAgICAgICAgICBpZiAobWluVCA+IFJUTWF0aC5FUFNJTE9OKSB7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQgPSBtaW5UO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludCA9IG1heFQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpbnRlcnNlY3Rpb25Qb2ludCA8IFJUTWF0aC5FUFNJTE9OKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcG9pbnQgPSBWZWN0b3IuYWRkKFxuICAgICAgICAgICAgVmVjdG9yLnNjYWxlZChyYXkuZ2V0RGlyZWN0aW9uKCksIGludGVyc2VjdGlvblBvaW50KSxcbiAgICAgICAgICAgIHJheS5nZXRPcmlnaW4oKVxuICAgICAgICApO1xuICAgICAgICBkaXN0YW5jZSA9IFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICBwb2ludCxcbiAgICAgICAgICAgIHJheS5nZXRPcmlnaW4oKVxuICAgICAgICApLmdldExlbmd0aCgpO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwb2ludCxcbiAgICAgICAgICAgIGRpc3RhbmNlXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGdldE5vcm1hbCAocG9pbnQ6IFZlY3Rvcik6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiBWZWN0b3Iubm9ybWFsaXplZChcbiAgICAgICAgICAgIFZlY3Rvci5zY2FsZWQoXG4gICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChwb2ludCwgdGhpcy5wb3NpdGlvbiksXG4gICAgICAgICAgICAgICAgMSAvIHRoaXMucmFkaXVzXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldE1hdGVyaWFsICgpOiBNYXRlcmlhbCB7XG4gICAgICAgIHJldHVybiB0aGlzLm1hdGVyaWFsO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRUeXBlICgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy50eXBlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRNYXRlcmlhbCAobWF0ZXJpYWw6IE1hdGVyaWFsKTogdGhpcyB7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbDtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBDb2xvciB9IGZyb20gXCIuL0NvbG9yL0NvbG9yXCI7XG5pbXBvcnQgeyBSR0JDb2xvciB9IGZyb20gXCIuL0NvbG9yL1JHQkNvbG9yXCI7XG5cbmV4cG9ydCBjbGFzcyBNYXRlcmlhbCB7XG4gICAgcHJpdmF0ZSBjb2xvcjogQ29sb3I7XG4gICAgcHJpdmF0ZSBsYW1iZXJ0Q29lZmY6IG51bWJlciA9IDAuNTtcbiAgICBwcml2YXRlIHBob25nQ29lZmY6IG51bWJlciA9IDAuNTtcbiAgICBwcml2YXRlIHJlZmxlY3Rpb25Db2VmZjogbnVtYmVyID0gMDtcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgY29sb3I6IENvbG9yID0gbmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDAsIDApKSxcbiAgICAgICAgcmVmbGVjdGlvbkNvZWZmOiBudW1iZXIgPSAwXG4gICAgKSB7XG4gICAgICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcbiAgICAgICAgdGhpcy5yZWZsZWN0aW9uQ29lZmYgPSByZWZsZWN0aW9uQ29lZmY7XG4gICAgfVxuXG4gICAgcHVibGljIGdldENvbG9yICgpOiBDb2xvciB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbG9yO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRMYW1iZXJ0Q29lZmYoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGFtYmVydENvZWZmO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRQaG9uZ0NvZWZmKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnBob25nQ29lZmY7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFJlZmxlY3Rpb25WYWx1ZSAoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVmbGVjdGlvbkNvZWZmO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRMYW1iZXJ0Q29lZmYobGFtYmVydENvZWZmOiBudW1iZXIpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5sYW1iZXJ0Q29lZmYgPSBsYW1iZXJ0Q29lZmY7XG4gICAgICAgIHRoaXMucGhvbmdDb2VmZiA9IDEgLSBsYW1iZXJ0Q29lZmY7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFBob25nQ29lZmYocGhvbmdDb2VmZjogbnVtYmVyKTogdGhpcyB7XG4gICAgICAgIHRoaXMucGhvbmdDb2VmZiA9IHBob25nQ29lZmY7XG4gICAgICAgIHRoaXMubGFtYmVydENvZWZmID0gMSAtIHBob25nQ29lZmY7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufSIsImltcG9ydCB7IE1hdGVyaWFsIH0gZnJvbSBcIi4uL01hdGVyaWFsXCI7XG5pbXBvcnQgeyBSYXkgfSBmcm9tIFwiLi4vUmF5XCI7XG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tIFwiLi4vVmVjdG9yXCI7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdE9iamVjdCB7XG4gICAgYWJzdHJhY3QgZ2V0TWF0ZXJpYWwgKCk6IE1hdGVyaWFsO1xuICAgIGFic3RyYWN0IHNldE1hdGVyaWFsIChtYXRlcmlhbDogTWF0ZXJpYWwpOiB0aGlzO1xuICAgIGFic3RyYWN0IGdldEludGVyc2VjdERhdGEgKHJheTogUmF5KTogYW55O1xufVxuIiwidmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCBmdW5jdGlvbiAoZCwgYikge1xuICAgIGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdO1xuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbn07XG52YXIgUlRNYXRoXzEgPSByZXF1aXJlKFwiLi4vUlRNYXRoXCIpO1xudmFyIEFic3RyYWN0T2JqZWN0XzEgPSByZXF1aXJlKFwiLi9BYnN0cmFjdE9iamVjdFwiKTtcbnZhciBDb2xvcl8xID0gcmVxdWlyZShcIi4uL0NvbG9yL0NvbG9yXCIpO1xudmFyIE1hdGVyaWFsXzEgPSByZXF1aXJlKFwiLi4vTWF0ZXJpYWxcIik7XG52YXIgUkdCQ29sb3JfMSA9IHJlcXVpcmUoXCIuLi9Db2xvci9SR0JDb2xvclwiKTtcbnZhciBWZWN0b3JfMSA9IHJlcXVpcmUoXCIuLi9WZWN0b3JcIik7XG52YXIgUG9seWdvbiA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFBvbHlnb24sIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUG9seWdvbigpIHtcbiAgICAgICAgdmFyIHZlcnRpY2VzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICB2ZXJ0aWNlc1tfaSAtIDBdID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBfc3VwZXIuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5tYXRlcmlhbCA9IG5ldyBNYXRlcmlhbF8xLk1hdGVyaWFsKG5ldyBDb2xvcl8xLkNvbG9yKG5ldyBSR0JDb2xvcl8xLlJHQkNvbG9yKDExNSwgMTE1LCAxMTUpKSwgMCk7XG4gICAgICAgIHRoaXMudHlwZSA9ICdzdXJmYWNlJztcbiAgICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzO1xuICAgIH1cbiAgICBQb2x5Z29uLnByb3RvdHlwZS5nZXRJbnRlcnNlY3REYXRhID0gZnVuY3Rpb24gKHJheSkge1xuICAgICAgICB2YXIgZGlzdGFuY2UsIGRpc3RhbmNlRnJvbUF4aXNDZW50ZXIsIGhpdFBvaW50LCBudW1lcmF0b3IsIGRlbm9taW5hdG9yO1xuICAgICAgICBkaXN0YW5jZUZyb21BeGlzQ2VudGVyID0gVmVjdG9yXzEuVmVjdG9yLmRvdCh0aGlzLnZlcnRpY2VzWzBdLCB0aGlzLmdldE5vcm1hbCgpKTtcbiAgICAgICAgZGVub21pbmF0b3IgPSBWZWN0b3JfMS5WZWN0b3IuZG90KHRoaXMuZ2V0Tm9ybWFsKCksIHJheS5nZXREaXJlY3Rpb24oKSk7XG4gICAgICAgIG51bWVyYXRvciA9IC1WZWN0b3JfMS5WZWN0b3IuZG90KHRoaXMuZ2V0Tm9ybWFsKCksIHJheS5nZXRPcmlnaW4oKSkgKyBkaXN0YW5jZUZyb21BeGlzQ2VudGVyO1xuICAgICAgICBkaXN0YW5jZSA9IG51bWVyYXRvciAvIGRlbm9taW5hdG9yO1xuICAgICAgICBpZiAoZGlzdGFuY2UgPCBSVE1hdGhfMS5SVE1hdGguRVBTSUxPTikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJheS5zZXREaXN0YW5jZShkaXN0YW5jZSk7XG4gICAgICAgIGhpdFBvaW50ID0gcmF5LmdldEhpdFBvaW50KCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52ZXJ0aWNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHZlcnRleDEgPSB0aGlzLnZlcnRpY2VzW2ldLCB2ZXJ0ZXgyID0gdm9pZCAwO1xuICAgICAgICAgICAgaWYgKGkgPT09IHRoaXMudmVydGljZXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIHZlcnRleDIgPSB0aGlzLnZlcnRpY2VzWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmVydGV4MiA9IHRoaXMudmVydGljZXNbaSArIDFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFQb2x5Z29uLmNoZWNrU2FtZUNsb2NrRGlyKFZlY3Rvcl8xLlZlY3Rvci5zdWJzdHJhY3QodmVydGV4MiwgdmVydGV4MSksIFZlY3Rvcl8xLlZlY3Rvci5zdWJzdHJhY3QoaGl0UG9pbnQsIHZlcnRleDEpLCB0aGlzLmdldE5vcm1hbCgpKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBkaXN0YW5jZSA9IFZlY3Rvcl8xLlZlY3Rvci5zdWJzdHJhY3QoaGl0UG9pbnQsIHJheS5nZXRPcmlnaW4oKSkuZ2V0TGVuZ3RoKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwb2ludDogaGl0UG9pbnQsXG4gICAgICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2VcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIFBvbHlnb24ucHJvdG90eXBlLmdldE1hdGVyaWFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXRlcmlhbDtcbiAgICB9O1xuICAgIFBvbHlnb24ucHJvdG90eXBlLmdldE5vcm1hbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVkZ2UxID0gVmVjdG9yXzEuVmVjdG9yLnN1YnN0cmFjdCh0aGlzLnZlcnRpY2VzWzJdLCB0aGlzLnZlcnRpY2VzWzBdKSwgZWRnZTIgPSBWZWN0b3JfMS5WZWN0b3Iuc3Vic3RyYWN0KHRoaXMudmVydGljZXNbMV0sIHRoaXMudmVydGljZXNbMF0pO1xuICAgICAgICByZXR1cm4gVmVjdG9yXzEuVmVjdG9yLm5vcm1hbGl6ZWQoVmVjdG9yXzEuVmVjdG9yLmNyb3NzKGVkZ2UxLCBlZGdlMikpO1xuICAgIH07XG4gICAgUG9seWdvbi5wcm90b3R5cGUuZ2V0VHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZTtcbiAgICB9O1xuICAgIFBvbHlnb24ucHJvdG90eXBlLnNldE1hdGVyaWFsID0gZnVuY3Rpb24gKG1hdGVyaWFsKSB7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBQb2x5Z29uLmNoZWNrU2FtZUNsb2NrRGlyID0gZnVuY3Rpb24gKHZlY3RvcjEsIHZlY3RvcjIsIG5vcm1hbCkge1xuICAgICAgICB2YXIgbm9ybWFsVjFWMiA9IFZlY3Rvcl8xLlZlY3Rvci5jcm9zcyh2ZWN0b3IyLCB2ZWN0b3IxKTtcbiAgICAgICAgcmV0dXJuIFZlY3Rvcl8xLlZlY3Rvci5kb3Qobm9ybWFsVjFWMiwgbm9ybWFsKSA+PSAwO1xuICAgIH07XG4gICAgcmV0dXJuIFBvbHlnb247XG59KShBYnN0cmFjdE9iamVjdF8xLkFic3RyYWN0T2JqZWN0KTtcbmV4cG9ydHMuUG9seWdvbiA9IFBvbHlnb247XG4iLCJpbXBvcnQgeyBSVE1hdGggfSBmcm9tIFwiLi4vUlRNYXRoXCI7XG5pbXBvcnQgeyBBYnN0cmFjdE9iamVjdCB9IGZyb20gXCIuL0Fic3RyYWN0T2JqZWN0XCI7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gXCIuLi9Db2xvci9Db2xvclwiO1xuaW1wb3J0IHsgTWF0ZXJpYWwgfSBmcm9tIFwiLi4vTWF0ZXJpYWxcIjtcbmltcG9ydCB7IFJheSB9IGZyb20gXCIuLi9SYXlcIjtcbmltcG9ydCB7IFJHQkNvbG9yIH0gZnJvbSBcIi4uL0NvbG9yL1JHQkNvbG9yXCI7XG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tIFwiLi4vVmVjdG9yXCI7XG5cbmV4cG9ydCBjbGFzcyBQb2x5Z29uIGV4dGVuZHMgQWJzdHJhY3RPYmplY3Qge1xuICAgIHByaXZhdGUgdmVydGljZXM6IFZlY3RvcltdO1xuICAgIHByaXZhdGUgbWF0ZXJpYWw6IE1hdGVyaWFsID0gbmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMTE1LCAxMTUsIDExNSkpLCAwKTtcbiAgICBwcml2YXRlIHR5cGU6IHN0cmluZyA9ICdzdXJmYWNlJztcblxuICAgIGNvbnN0cnVjdG9yICguLi52ZXJ0aWNlczogVmVjdG9yW10pIHtcbiAgICAgICAgc3VwZXIgKCk7XG5cbiAgICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRJbnRlcnNlY3REYXRhIChyYXk6IFJheSk6IGFueSB7XG4gICAgICAgIGxldCBkaXN0YW5jZTogbnVtYmVyLFxuICAgICAgICAgICAgZGlzdGFuY2VGcm9tQXhpc0NlbnRlcjogbnVtYmVyLFxuICAgICAgICAgICAgaGl0UG9pbnQ6IFZlY3RvcixcbiAgICAgICAgICAgIG51bWVyYXRvcjogbnVtYmVyLFxuICAgICAgICAgICAgZGVub21pbmF0b3I6IG51bWJlcjtcblxuICAgICAgICBkaXN0YW5jZUZyb21BeGlzQ2VudGVyID0gVmVjdG9yLmRvdCh0aGlzLnZlcnRpY2VzWzBdLCB0aGlzLmdldE5vcm1hbCgpKTtcblxuICAgICAgICBkZW5vbWluYXRvciA9IFZlY3Rvci5kb3QodGhpcy5nZXROb3JtYWwoKSwgcmF5LmdldERpcmVjdGlvbigpKTtcbiAgICAgICAgbnVtZXJhdG9yID0gLVZlY3Rvci5kb3QodGhpcy5nZXROb3JtYWwoKSwgcmF5LmdldE9yaWdpbigpKSArIGRpc3RhbmNlRnJvbUF4aXNDZW50ZXI7XG5cbiAgICAgICAgZGlzdGFuY2UgPSBudW1lcmF0b3IgLyBkZW5vbWluYXRvcjtcblxuICAgICAgICBpZiAoZGlzdGFuY2UgPCBSVE1hdGguRVBTSUxPTikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgcmF5LnNldERpc3RhbmNlKGRpc3RhbmNlKTtcblxuICAgICAgICBoaXRQb2ludCA9IHJheS5nZXRIaXRQb2ludCgpO1xuXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgdmVydGV4MTogVmVjdG9yID0gdGhpcy52ZXJ0aWNlc1tpXSxcbiAgICAgICAgICAgICAgICB2ZXJ0ZXgyOiBWZWN0b3I7XG5cbiAgICAgICAgICAgIGlmIChpID09PSB0aGlzLnZlcnRpY2VzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICB2ZXJ0ZXgyID0gdGhpcy52ZXJ0aWNlc1swXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmVydGV4MiA9IHRoaXMudmVydGljZXNbaSArIDFdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgIVBvbHlnb24uY2hlY2tTYW1lQ2xvY2tEaXIoXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QodmVydGV4MiwgdmVydGV4MSksXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoaGl0UG9pbnQsIHZlcnRleDEpLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldE5vcm1hbCgpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZGlzdGFuY2UgPSBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgaGl0UG9pbnQsXG4gICAgICAgICAgICByYXkuZ2V0T3JpZ2luKClcbiAgICAgICAgKS5nZXRMZW5ndGgoKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcG9pbnQ6IGhpdFBvaW50LFxuICAgICAgICAgICAgZGlzdGFuY2VcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TWF0ZXJpYWwgKCk6IE1hdGVyaWFsIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF0ZXJpYWw7XG4gICAgfVxuXG4gICAgcHVibGljIGdldE5vcm1hbCAoKTogVmVjdG9yIHtcbiAgICAgICAgbGV0IGVkZ2UxOiBWZWN0b3IgPSBWZWN0b3Iuc3Vic3RyYWN0KHRoaXMudmVydGljZXNbMl0sIHRoaXMudmVydGljZXNbMF0pLFxuICAgICAgICAgICAgZWRnZTI6IFZlY3RvciA9IFZlY3Rvci5zdWJzdHJhY3QodGhpcy52ZXJ0aWNlc1sxXSwgdGhpcy52ZXJ0aWNlc1swXSk7XG5cbiAgICAgICAgcmV0dXJuIFZlY3Rvci5ub3JtYWxpemVkKFZlY3Rvci5jcm9zcyhlZGdlMSwgZWRnZTIpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VHlwZSAoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0TWF0ZXJpYWwgKG1hdGVyaWFsOiBNYXRlcmlhbCk6IHRoaXMge1xuICAgICAgICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgY2hlY2tTYW1lQ2xvY2tEaXIgKHZlY3RvcjE6IFZlY3RvciwgdmVjdG9yMjogVmVjdG9yLCBub3JtYWw6IFZlY3Rvcik6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgbm9ybWFsVjFWMjogVmVjdG9yID0gVmVjdG9yLmNyb3NzKHZlY3RvcjIsIHZlY3RvcjEpO1xuXG4gICAgICAgIHJldHVybiBWZWN0b3IuZG90KG5vcm1hbFYxVjIsIG5vcm1hbCkgPj0gMDtcbiAgICB9XG59XG4iLCJ2YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBSVE1hdGhfMSA9IHJlcXVpcmUoXCIuLi9SVE1hdGhcIik7XG52YXIgQWJzdHJhY3RPYmplY3RfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0T2JqZWN0XCIpO1xudmFyIENvbG9yXzEgPSByZXF1aXJlKFwiLi4vQ29sb3IvQ29sb3JcIik7XG52YXIgTWF0ZXJpYWxfMSA9IHJlcXVpcmUoXCIuLi9NYXRlcmlhbFwiKTtcbnZhciBSR0JDb2xvcl8xID0gcmVxdWlyZShcIi4uL0NvbG9yL1JHQkNvbG9yXCIpO1xudmFyIFZlY3Rvcl8xID0gcmVxdWlyZShcIi4uL1ZlY3RvclwiKTtcbnZhciBTcGhlcmUgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhTcGhlcmUsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gU3BoZXJlKGNlbnRlciwgcmFkaXVzKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLm1hdGVyaWFsID0gbmV3IE1hdGVyaWFsXzEuTWF0ZXJpYWwobmV3IENvbG9yXzEuQ29sb3IobmV3IFJHQkNvbG9yXzEuUkdCQ29sb3IoMjU1LCAwLCAwKSksIDApO1xuICAgICAgICB0aGlzLnR5cGUgPSAnc3VyZmFjZSc7XG4gICAgICAgIHRoaXMuY2VudGVyID0gY2VudGVyO1xuICAgICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cztcbiAgICB9XG4gICAgU3BoZXJlLnByb3RvdHlwZS5nZXRJbnRlcnNlY3REYXRhID0gZnVuY3Rpb24gKHJheSkge1xuICAgICAgICB2YXIgayA9IFZlY3Rvcl8xLlZlY3Rvci5zdWJzdHJhY3QocmF5LmdldE9yaWdpbigpLCB0aGlzLmNlbnRlciksIGIgPSBWZWN0b3JfMS5WZWN0b3IuZG90KGssIHJheS5nZXREaXJlY3Rpb24oKSksIGMgPSBWZWN0b3JfMS5WZWN0b3IuZG90KGssIGspIC0gTWF0aC5wb3codGhpcy5yYWRpdXMsIDIpLCBkID0gTWF0aC5wb3coYiwgMikgLSBjLCB0MSwgdDIsIG1pblQsIG1heFQsIGludGVyc2VjdGlvblBvaW50LCBwb2ludCwgZGlzdGFuY2U7XG4gICAgICAgIGlmIChiID4gMCB8fCBkIDwgMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkID49IDApIHtcbiAgICAgICAgICAgIHQxID0gLWIgKyBNYXRoLnNxcnQoZCk7XG4gICAgICAgICAgICB0MiA9IC1iIC0gTWF0aC5zcXJ0KGQpO1xuICAgICAgICAgICAgbWluVCA9IE1hdGgubWluKHQxLCB0Mik7XG4gICAgICAgICAgICBtYXhUID0gTWF0aC5tYXgodDEsIHQyKTtcbiAgICAgICAgICAgIGlmIChtaW5UID4gUlRNYXRoXzEuUlRNYXRoLkVQU0lMT04pIHtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludCA9IG1pblQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludCA9IG1heFQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9uUG9pbnQgPCBSVE1hdGhfMS5SVE1hdGguRVBTSUxPTikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwb2ludCA9IFZlY3Rvcl8xLlZlY3Rvci5hZGQoVmVjdG9yXzEuVmVjdG9yLnNjYWxlZChyYXkuZ2V0RGlyZWN0aW9uKCksIGludGVyc2VjdGlvblBvaW50KSwgcmF5LmdldE9yaWdpbigpKTtcbiAgICAgICAgZGlzdGFuY2UgPSBWZWN0b3JfMS5WZWN0b3Iuc3Vic3RyYWN0KHBvaW50LCByYXkuZ2V0T3JpZ2luKCkpLmdldExlbmd0aCgpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcG9pbnQ6IHBvaW50LFxuICAgICAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBTcGhlcmUucHJvdG90eXBlLmdldE1hdGVyaWFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXRlcmlhbDtcbiAgICB9O1xuICAgIFNwaGVyZS5wcm90b3R5cGUuZ2V0Tm9ybWFsID0gZnVuY3Rpb24gKHBvaW50KSB7XG4gICAgICAgIHJldHVybiBWZWN0b3JfMS5WZWN0b3Iubm9ybWFsaXplZChWZWN0b3JfMS5WZWN0b3Iuc2NhbGVkKFZlY3Rvcl8xLlZlY3Rvci5zdWJzdHJhY3QocG9pbnQsIHRoaXMuY2VudGVyKSwgMSAvIHRoaXMucmFkaXVzKSk7XG4gICAgfTtcbiAgICBTcGhlcmUucHJvdG90eXBlLmdldFR5cGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnR5cGU7XG4gICAgfTtcbiAgICBTcGhlcmUucHJvdG90eXBlLnNldE1hdGVyaWFsID0gZnVuY3Rpb24gKG1hdGVyaWFsKSB7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gU3BoZXJlO1xufSkoQWJzdHJhY3RPYmplY3RfMS5BYnN0cmFjdE9iamVjdCk7XG5leHBvcnRzLlNwaGVyZSA9IFNwaGVyZTtcbiIsImltcG9ydCB7IFJUTWF0aCB9IGZyb20gXCIuLi9SVE1hdGhcIjtcbmltcG9ydCB7IEFic3RyYWN0T2JqZWN0IH0gZnJvbSBcIi4vQWJzdHJhY3RPYmplY3RcIjtcbmltcG9ydCB7IENvbG9yIH0gZnJvbSBcIi4uL0NvbG9yL0NvbG9yXCI7XG5pbXBvcnQgeyBNYXRlcmlhbCB9IGZyb20gXCIuLi9NYXRlcmlhbFwiO1xuaW1wb3J0IHsgUmF5IH0gZnJvbSBcIi4uL1JheVwiO1xuaW1wb3J0IHsgUkdCQ29sb3IgfSBmcm9tIFwiLi4vQ29sb3IvUkdCQ29sb3JcIjtcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gXCIuLi9WZWN0b3JcIjtcblxuZXhwb3J0IGNsYXNzIFNwaGVyZSBleHRlbmRzIEFic3RyYWN0T2JqZWN0IHtcbiAgICBwcml2YXRlIGNlbnRlcjogVmVjdG9yO1xuICAgIHByaXZhdGUgcmFkaXVzOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBtYXRlcmlhbDogTWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDAsIDApKSwgMCk7XG4gICAgcHJpdmF0ZSB0eXBlOiBzdHJpbmcgPSAnc3VyZmFjZSc7XG5cbiAgICBjb25zdHJ1Y3RvciAoY2VudGVyOiBWZWN0b3IsIHJhZGl1czogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyICgpO1xuXG4gICAgICAgIHRoaXMuY2VudGVyID0gY2VudGVyO1xuICAgICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0SW50ZXJzZWN0RGF0YSAocmF5OiBSYXkpOiBhbnkge1xuICAgICAgICBsZXQgayA9IFZlY3Rvci5zdWJzdHJhY3QocmF5LmdldE9yaWdpbigpLCB0aGlzLmNlbnRlciksXG4gICAgICAgICAgICBiOiBudW1iZXIgPSBWZWN0b3IuZG90KGssIHJheS5nZXREaXJlY3Rpb24oKSksXG4gICAgICAgICAgICBjOiBudW1iZXIgPSBWZWN0b3IuZG90KGssIGspIC0gdGhpcy5yYWRpdXMgKiogMixcbiAgICAgICAgICAgIGQ6IG51bWJlciA9IGIgKiogMiAtIGMsXG4gICAgICAgICAgICB0MTogbnVtYmVyLFxuICAgICAgICAgICAgdDI6IG51bWJlcixcbiAgICAgICAgICAgIG1pblQ6IG51bWJlcixcbiAgICAgICAgICAgIG1heFQ6IG51bWJlcixcbiAgICAgICAgICAgIGludGVyc2VjdGlvblBvaW50OiBudW1iZXIsXG4gICAgICAgICAgICBwb2ludDogVmVjdG9yLFxuICAgICAgICAgICAgZGlzdGFuY2U6IG51bWJlcjtcblxuICAgICAgICBpZiAoYiA+IDAgfHwgZCA8IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkID49IDApIHtcbiAgICAgICAgICAgIHQxID0gLWIgKyBNYXRoLnNxcnQoZCk7XG4gICAgICAgICAgICB0MiA9IC1iIC0gTWF0aC5zcXJ0KGQpO1xuICAgICAgICAgICAgbWluVCA9IE1hdGgubWluKHQxLCB0Mik7XG4gICAgICAgICAgICBtYXhUID0gTWF0aC5tYXgodDEsIHQyKTtcblxuICAgICAgICAgICAgaWYgKG1pblQgPiBSVE1hdGguRVBTSUxPTikge1xuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvblBvaW50ID0gbWluVDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQgPSBtYXhUO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9uUG9pbnQgPCBSVE1hdGguRVBTSUxPTikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHBvaW50ID0gVmVjdG9yLmFkZChcbiAgICAgICAgICAgIFZlY3Rvci5zY2FsZWQocmF5LmdldERpcmVjdGlvbigpLCBpbnRlcnNlY3Rpb25Qb2ludCksXG4gICAgICAgICAgICByYXkuZ2V0T3JpZ2luKClcbiAgICAgICAgKTtcbiAgICAgICAgZGlzdGFuY2UgPSBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgcG9pbnQsXG4gICAgICAgICAgICByYXkuZ2V0T3JpZ2luKClcbiAgICAgICAgKS5nZXRMZW5ndGgoKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcG9pbnQsXG4gICAgICAgICAgICBkaXN0YW5jZVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRNYXRlcmlhbCAoKTogTWF0ZXJpYWwge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXRlcmlhbDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Tm9ybWFsIChwb2ludDogVmVjdG9yKTogVmVjdG9yIHtcbiAgICAgICAgcmV0dXJuIFZlY3Rvci5ub3JtYWxpemVkKFxuICAgICAgICAgICAgVmVjdG9yLnNjYWxlZChcbiAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KHBvaW50LCB0aGlzLmNlbnRlciksXG4gICAgICAgICAgICAgICAgMSAvIHRoaXMucmFkaXVzXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFR5cGUgKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnR5cGU7XG4gICAgfVxuXG4gICAgcHVibGljIHNldE1hdGVyaWFsIChtYXRlcmlhbDogTWF0ZXJpYWwpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IENhbWVyYSB9IGZyb20gXCIuL0NhbWVyYVwiO1xuaW1wb3J0IHsgQ29sb3IgfSBmcm9tIFwiLi9Db2xvci9Db2xvclwiO1xuaW1wb3J0IHsgU3BoZXJpY2FsTGlnaHQgfSBmcm9tIFwiLi9MaWdodHMvU3BoZXJpY2FsTGlnaHRcIjtcbmltcG9ydCB7IE1hdGVyaWFsIH0gZnJvbSBcIi4vTWF0ZXJpYWxcIjtcbmltcG9ydCB7IFBsYW5lIH0gZnJvbSBcIi4vT2JqZWN0cy9QbGFuZVwiO1xuaW1wb3J0IHsgUG9seWdvbiB9IGZyb20gXCIuL09iamVjdHMvUG9seWdvblwiO1xuaW1wb3J0IHsgUmF5IH0gZnJvbSBcIi4vUmF5XCI7XG5pbXBvcnQgeyBSR0JDb2xvciB9IGZyb20gXCIuL0NvbG9yL1JHQkNvbG9yXCI7XG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XG5pbXBvcnQgeyBTcGhlcmUgfSBmcm9tIFwiLi9PYmplY3RzL1NwaGVyZVwiO1xuaW1wb3J0IHsgVHJhY2VyIH0gZnJvbSBcIi4vVHJhY2VyXCI7XG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tIFwiLi9WZWN0b3JcIjtcblxuY29uc3Qgc2NyZWVuV2lkdGggPSAxMDAsXG4gICAgc2NyZWVuSGVpZ2h0ID0gMTAwO1xuXG5sZXQgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIiksXG4gICAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSxcbiAgICBpbWFnZTogYW55LFxuICAgIHRyYWNlciA9IG5ldyBUcmFjZXIoKTtcblxuY2FudmFzLndpZHRoID0gc2NyZWVuV2lkdGg7XG5jYW52YXMuaGVpZ2h0ID0gc2NyZWVuSGVpZ2h0O1xuY2FudmFzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XG5cbnRyYWNlci5zZXRTY2VuZShcbiAgICBuZXcgU2NlbmUoe1xuICAgICAgICBjYW1lcmE6IG5ldyBDYW1lcmEoXG4gICAgICAgICAgICBuZXcgVmVjdG9yKDAsIDAsIC02OTkpLFxuICAgICAgICAgICAgbmV3IFZlY3RvcigwLCAwLCAxKSxcbiAgICAgICAgICAgIHNjcmVlbldpZHRoLFxuICAgICAgICAgICAgc2NyZWVuSGVpZ2h0XG4gICAgICAgICksXG4gICAgICAgIGxpZ2h0czogW1xuICAgICAgICAgICAgbmV3IFNwaGVyaWNhbExpZ2h0KG5ldyBWZWN0b3IgKDAsIDY0MCwgMCksIDEuMiwgNTApXG4gICAgICAgICAgICAgICAgLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDI1NSwgMjU1LCAyNTUpKSkpXG4gICAgICAgIF0sXG4gICAgICAgIG9iamVjdHM6IFtcbiAgICAgICAgICAgIC8vbmV3IFBsYW5lKG5ldyBWZWN0b3IoMCwgMSwgMCksIC00MDApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDExNSwgMTE1LCAxMTUpKSwgMCkpLFxuICAgICAgICAgICAgLy8gYm90dG9tIHBsYW5lXG4gICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIDcwMClcbiAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjU1LCAyNTUsIDI1NSkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgLy8gZnJvbnQgcGxhbmVcbiAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApXG4gICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDI1NSwgMjU1LCAyNTUpKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgIC8vIHRvcCBwbGFuZVxuICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIC03MDApLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMClcbiAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjU1LCAyNTUsIDI1NSkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgLy9yaWdodCBwbGFuZVxuICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIC03MDApLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIDcwMClcbiAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMjU1KSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAvL2xlZnQgcGxhbmVcbiAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKVxuICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDAsIDApKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgIC8vIGJhY2sgcGxhbmVcbiAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCAtNzAwKVxuICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICBuZXcgU3BoZXJlKG5ldyBWZWN0b3IoLTI1MCwgLTUwMCwgNDUwKSwgMjAwKVxuICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSksIDEpKSxcbiAgICAgICAgICAgIG5ldyBTcGhlcmUobmV3IFZlY3RvcigyNTAsIC01MDAsIDQwMCksIDIwMClcbiAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMjU1LCAwKSksIDApKVxuICAgICAgICBdXG4gICAgfSlcbik7XG5cbnRyYWNlci5yZW5kZXIoY3R4LCBzY3JlZW5XaWR0aCwgc2NyZWVuSGVpZ2h0KTtcbmltYWdlID0gY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcbmRvY3VtZW50LndyaXRlKGA8aW1nIHNyYz1cXCcke2ltYWdlfVxcJyAvPmApO1xuIiwiZXhwb3J0IG1vZHVsZSBSVE1hdGgge1xuICAgIGV4cG9ydCBjb25zdCBFUFNJTE9OID0gMC4wMDE7XG59IiwiaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSBcIi4vVmVjdG9yXCI7XG5cbmV4cG9ydCBjbGFzcyBSYXkge1xuICAgIHByaXZhdGUgb3JpZ2luOiBWZWN0b3I7XG4gICAgcHJpdmF0ZSBkaXJlY3Rpb246ICBWZWN0b3I7XG4gICAgcHJpdmF0ZSBkaXN0YW5jZTogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIGl0ZXJhdGlvbjogbnVtYmVyID0gODtcblxuICAgIGNvbnN0cnVjdG9yIChvcmlnaW46IFZlY3RvciwgZGlyZWN0aW9uOiBWZWN0b3IsIGl0ZXJhdGlvbj86IG51bWJlcikge1xuICAgICAgICB0aGlzLm9yaWdpbiA9IG9yaWdpbjtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBWZWN0b3Iubm9ybWFsaXplZChkaXJlY3Rpb24pO1xuXG4gICAgICAgIGlmIChpdGVyYXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuaXRlcmF0aW9uID0gaXRlcmF0aW9uO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldERpcmVjdGlvbiAoKTogVmVjdG9yIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXREaXN0YW5jZSAoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzdGFuY2U7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEl0ZXJhdGlvbiAoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlcmF0aW9uO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRPcmlnaW4gKCk6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiB0aGlzLm9yaWdpbjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0SGl0UG9pbnQgKCk6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiBWZWN0b3IuYWRkKHRoaXMub3JpZ2luLCBWZWN0b3Iuc2NhbGVkKHRoaXMuZGlyZWN0aW9uLCB0aGlzLmRpc3RhbmNlKSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldERpc3RhbmNlIChkaXN0YW5jZTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0SXRlcmF0aW9uIChpdGVyYXRpb246IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLml0ZXJhdGlvbiA9IGl0ZXJhdGlvbjtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBDYW1lcmEgfSBmcm9tIFwiLi9DYW1lcmFcIjtcbmltcG9ydCB7IEFic3RyYWN0TGlnaHQgfSBmcm9tIFwiLi9MaWdodHMvQWJzdHJhY3RMaWdodFwiO1xuXG5leHBvcnQgY2xhc3MgU2NlbmUge1xuICAgIHByaXZhdGUgY2FtZXJhOiBDYW1lcmE7XG4gICAgcHJpdmF0ZSBvYmplY3RzOiBhbnlbXSA9IFtdO1xuICAgIHByaXZhdGUgbGlnaHRzOiBBYnN0cmFjdExpZ2h0W10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yIChvYmplY3RzOiBhbnkpIHtcbiAgICAgICAgdGhpcy5vYmplY3RzID0gb2JqZWN0cy5vYmplY3RzO1xuICAgICAgICB0aGlzLmNhbWVyYSA9IG9iamVjdHMuY2FtZXJhO1xuICAgICAgICB0aGlzLmxpZ2h0cyA9IG9iamVjdHMubGlnaHRzO1xuICAgIH1cblxuICAgIHB1YmxpYyBhZGRPYmplY3QgKG9iamVjdDogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMub2JqZWN0cy5wdXNoKG9iamVjdCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldENhbWVyYSAoKTogQ2FtZXJhIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FtZXJhO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRMaWdodHMgKCk6IEFic3RyYWN0TGlnaHRbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxpZ2h0cztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0T2JqZWN0cyAoKTogYW55W10ge1xuICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IENhbWVyYSB9IGZyb20gXCIuL0NhbWVyYVwiO1xuaW1wb3J0IHsgQ29sb3IgfSBmcm9tIFwiLi9Db2xvci9Db2xvclwiO1xuaW1wb3J0IHsgUmF5IH0gZnJvbSBcIi4vUmF5XCI7XG5pbXBvcnQgeyBSR0JDb2xvciB9IGZyb20gXCIuL0NvbG9yL1JHQkNvbG9yXCI7XG5pbXBvcnQgeyBSVE1hdGggfSBmcm9tIFwiLi9SVE1hdGhcIjtcbmltcG9ydCB7IFNjZW5lIH0gZnJvbSBcIi4vU2NlbmVcIjtcbmltcG9ydCB7IFNwaGVyZSB9IGZyb20gXCIuL09iamVjdHMvU3BoZXJlXCI7XG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tIFwiLi9WZWN0b3JcIjtcbmltcG9ydCB7UGxhbmV9IGZyb20gXCIuL09iamVjdHMvUGxhbmVcIjtcbmltcG9ydCB7QWJzdHJhY3RMaWdodH0gZnJvbSBcIi4vTGlnaHRzL0Fic3RyYWN0TGlnaHRcIjtcblxuZXhwb3J0IGNsYXNzIFRyYWNlciB7XG4gICAgcHJpdmF0ZSBzY2VuZTogU2NlbmU7XG4gICAgcHJpdmF0ZSByYXlzUGVyUGl4ZWw6IG51bWJlciA9IDE7XG4gICAgcHJpdmF0ZSBzY3JlZW5XaWR0aDogbnVtYmVyID0gMjUwO1xuICAgIHByaXZhdGUgc2NyZWVuSGVpZ2h0OiBudW1iZXIgPSAyNTA7XG5cbiAgICBwcml2YXRlIGdldENvbG9yIChyYXk6IFJheSwgcmVjdXJjaXZlOiBib29sZWFuID0gdHJ1ZSk6IENvbG9yIHtcbiAgICAgICAgbGV0IGludGVyc2VjdCA9IHRoaXMudHJhY2UocmF5KSxcbiAgICAgICAgICAgIGRpZmZ1c2VDb2xvcjogQ29sb3IgPSBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKSxcbiAgICAgICAgICAgIHJlZmxlY3RDb2xvcjogQ29sb3IgPSBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcblxuICAgICAgICBpZiAoaW50ZXJzZWN0Wydvd25lciddID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSk7XG4gICAgICAgIH1cblxuICAgICAgICBkaWZmdXNlQ29sb3IgPSB0aGlzLmdldERpZmZ1c2VDb2xvcihyYXksIGludGVyc2VjdCwgcmVjdXJjaXZlKTtcblxuICAgICAgICBpZiAocmVjdXJjaXZlKSB7XG4gICAgICAgICAgICByZWZsZWN0Q29sb3IgPSB0aGlzLmdldFJlZmxlY3Rpb25Db2xvcihyYXksIGludGVyc2VjdCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGlmZnVzZUNvbG9yLmFkZChyZWZsZWN0Q29sb3IpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RGlmZnVzZUNvbG9yIChyYXk6IFJheSwgaW50ZXJzZWN0OiBhbnksIHJlY3Vyc2l2ZTogYm9vbGVhbiA9IHRydWUpOiBDb2xvciB7XG4gICAgICAgIGxldCBsYW1iQ29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcmFkaWFuY2VDb2xvcjogQ29sb3IsXG4gICAgICAgICAgICBwaG9uZ0NvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHBpeGVsQ29sb3I6IENvbG9yID0gbmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSksXG4gICAgICAgICAgICBsaWdodERpcmVjdGlvbjogVmVjdG9yLFxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyOiBWZWN0b3IsXG4gICAgICAgICAgICBsYW1iQ29zOiBudW1iZXIsXG4gICAgICAgICAgICBwaG9uZ0NvczogbnVtYmVyLFxuICAgICAgICAgICAgcGhvbmc6IG51bWJlcjtcblxuICAgICAgICBmb3IgKGxldCBsaWdodCBvZiB0aGlzLnNjZW5lLmdldExpZ2h0cygpKSB7XG4gICAgICAgICAgICAvLyBpZiBsaWdodCAtIHJldHVybiBvbmx5IGxpZ2h0IGNvbG9yXG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0Wydvd25lclR5cGUnXSA9PT0gJ2xpZ2h0Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcnNlY3RbJ293bmVyJ11cbiAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBsaWdodFBvd2VyID0gdGhpcy5nZXRMaWdodFBvd2VyKGludGVyc2VjdCwgbGlnaHQpO1xuXG4gICAgICAgICAgICBsYW1iQ29sb3IgPSBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcbiAgICAgICAgICAgIHJhZGlhbmNlQ29sb3IgPSBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcbiAgICAgICAgICAgIHBob25nQ29sb3IgPSBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcbiAgICAgICAgICAgIGxpZ2h0RGlyZWN0aW9uID0gVmVjdG9yLm5vcm1hbGl6ZWQoXG4gICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydwb2ludCddLFxuICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gbGFtYmVydFxuXG4gICAgICAgICAgICBsYW1iQ29zID0gTWF0aC5tYXgoXG4gICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICAtVmVjdG9yLmRvdChcbiAgICAgICAgICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXS5nZXROb3JtYWwoaW50ZXJzZWN0Wydwb2ludCddKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGxhbWJDb2xvciA9IGxhbWJDb2xvci5hZGQoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydvd25lciddXG4gICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgIC5tdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UG93ZXIgKiBsYW1iQ29zICogaW50ZXJzZWN0Wydvd25lciddLmdldE1hdGVyaWFsKCkuZ2V0TGFtYmVydENvZWZmKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChyZWN1cnNpdmUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBOVU1fRElSRUNUSU9OUyA9IDM1O1xuXG4gICAgICAgICAgICAgICAgbGV0IHJhbmREaXIgPSAobm9ybWFsOiBWZWN0b3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkaXI6IFZlY3RvciA9IG5ldyBWZWN0b3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5yYW5kb20oKSAtIDAuNSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpIC0gMC41LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucmFuZG9tKCkgLSAwLjVcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChWZWN0b3IuZG90KGRpciwgZGlyKSA+IDAuNSAqKiAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpciA9IFZlY3Rvci5ub3JtYWxpemVkKGRpcik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChWZWN0b3IuZG90KGRpciwgbm9ybWFsKSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXIgPSBWZWN0b3IuaW52ZXJzZShkaXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGlyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTlVNX0RJUkVDVElPTlM7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZGlyOiBWZWN0b3IgPSByYW5kRGlyKGludGVyc2VjdFsnb3duZXInXS5nZXROb3JtYWwoaW50ZXJzZWN0Wydwb2ludCddKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IHJhZGlhbmNlSW5UaGF0RGlyOiBDb2xvciA9IHRoaXMuZ2V0Q29sb3IobmV3IFJheShpbnRlcnNlY3RbJ3BvaW50J10sIGRpciksIGZhbHNlKTtcblxuICAgICAgICAgICAgICAgICAgICBsZXQgY29zSTogbnVtYmVyID0gVmVjdG9yLmRvdChcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXS5nZXROb3JtYWwoaW50ZXJzZWN0Wydwb2ludCddKVxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlQ29sb3IgPSByYWRpYW5jZUNvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGl2aWRlKE1hdGguUEkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlSW5UaGF0RGlyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNjYWxlZChjb3NJKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHBob25nXG5cbiAgICAgICAgICAgIHJlZmxlY3RQaG9uZ1ZlY3RvckRpciA9IFZlY3Rvci5yZWZsZWN0KFxuICAgICAgICAgICAgICAgIGxpZ2h0RGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXS5nZXROb3JtYWwoaW50ZXJzZWN0Wydwb2ludCddKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHBob25nQ29zID0gLVZlY3Rvci5kb3QocmVmbGVjdFBob25nVmVjdG9yRGlyLCByYXkuZ2V0RGlyZWN0aW9uKCkpO1xuXG4gICAgICAgICAgICBpZiAocGhvbmdDb3MgPiAwKSB7XG4gICAgICAgICAgICAgICAgcGhvbmcgPSBNYXRoLnBvdyhwaG9uZ0NvcywgMzUpO1xuICAgICAgICAgICAgICAgIHBob25nQ29sb3IgPSBwaG9uZ0NvbG9yLmFkZChcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydvd25lciddXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodFBvd2VyICogcGhvbmcgKiBpbnRlcnNlY3RbJ293bmVyJ10uZ2V0TWF0ZXJpYWwoKS5nZXRQaG9uZ0NvZWZmKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBpeGVsQ29sb3IgPSBwaXhlbENvbG9yLmFkZChsYW1iQ29sb3IuYWRkKHJhZGlhbmNlQ29sb3IuZGl2aWRlKDE1KSkpLmFkZChwaG9uZ0NvbG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwaXhlbENvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVmbGVjdGlvbkNvbG9yIChyYXk6IFJheSwgaW50ZXJzZWN0OiBhbnkpOiBhbnkge1xuICAgICAgICBsZXQgcmVmbGVjdGlvbkNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJlZmxlY3RlZFJheTogVmVjdG9yO1xuXG4gICAgICAgIHJheS5zZXRJdGVyYXRpb24ocmF5LmdldEl0ZXJhdGlvbigpIC0gMSk7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgcmF5LmdldEl0ZXJhdGlvbigpID09PSAwIHx8XG4gICAgICAgICAgICBpbnRlcnNlY3RbJ293bmVyJ10uZ2V0TWF0ZXJpYWwoKS5nZXRSZWZsZWN0aW9uVmFsdWUoKSA9PT0gMFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZmxlY3RlZFJheSA9IFZlY3Rvci5yZWZsZWN0KFxuICAgICAgICAgICAgcmF5LmdldERpcmVjdGlvbigpLFxuICAgICAgICAgICAgaW50ZXJzZWN0Wydvd25lciddLmdldE5vcm1hbChpbnRlcnNlY3RbJ3BvaW50J10pXG4gICAgICAgICk7XG5cbiAgICAgICAgcmVmbGVjdGlvbkNvbG9yID0gdGhpcy5nZXRDb2xvcihcbiAgICAgICAgICAgIG5ldyBSYXkoaW50ZXJzZWN0Wydwb2ludCddLCByZWZsZWN0ZWRSYXksIHJheS5nZXRJdGVyYXRpb24oKSlcbiAgICAgICAgKS5zY2FsZWQoXG4gICAgICAgICAgICBpbnRlcnNlY3RbJ293bmVyJ11cbiAgICAgICAgICAgICAgICAuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgIC5nZXRSZWZsZWN0aW9uVmFsdWUoKVxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiByZWZsZWN0aW9uQ29sb3I7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQZXJzcGVjdGl2ZVZlY3RvciAoeDogbnVtYmVyLCB5OiBudW1iZXIsIHNjcmVlbldpZHRoOiBudW1iZXIsIHNjcmVlbkhlaWdodDogbnVtYmVyKSB7XG4gICAgICAgIGxldCBjYW1lcmE6IENhbWVyYSA9IHRoaXMuc2NlbmUuZ2V0Q2FtZXJhKCk7XG5cbiAgICAgICAgcmV0dXJuIFZlY3Rvci5ub3JtYWxpemVkKFxuICAgICAgICAgICAgVmVjdG9yLmFkZChcbiAgICAgICAgICAgICAgICBjYW1lcmEuZ2V0Rm9yd2FyZFZlY3RvcigpLFxuICAgICAgICAgICAgICAgIFZlY3Rvci5hZGQoXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEuZ2V0UmlnaHRWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5yZWNlbnRlclgoeClcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnNjYWxlZChcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5nZXRVcFZlY3RvcigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLnJlY2VudGVyWSh5KVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TGlnaHRQb3dlciAoaW50ZXJzZWN0OiBhbnksIGxpZ2h0OiBBYnN0cmFjdExpZ2h0KTogbnVtYmVyIHtcbiAgICAgICAgY29uc3Qgc2FtcGxpbmcgPSAxMDtcblxuICAgICAgICBsZXQgbGlnaHRQb3dlciA9IGxpZ2h0LmdldFBvd2VyKCksXG4gICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50OiBWZWN0b3IsXG4gICAgICAgICAgICByZXN1bHRQb3dlciA9IDA7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzYW1wbGluZzsgaSsrKSB7XG4gICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50ID0gbGlnaHQuZ2V0UmFuZG9tUG9pbnQoKTtcblxuICAgICAgICAgICAgbGV0IGxpZ2h0UmF5ID0gdGhpcy50cmFjZShcbiAgICAgICAgICAgICAgICBuZXcgUmF5KFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ3BvaW50J10sXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRSYW5kb21Qb2ludFxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsncG9pbnQnXVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKGxpZ2h0UmF5Wydwb2ludCddID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChsaWdodFJheVsnb3duZXInXSAhPT0gbGlnaHQpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzdWx0UG93ZXIgKz0gKFxuICAgICAgICAgICAgICAgIGxpZ2h0UG93ZXIgLVxuICAgICAgICAgICAgICAgIChcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50XG4gICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydwb2ludCddXG4gICAgICAgICAgICAgICAgICAgICkuZ2V0TGVuZ3RoKCkgKiAobGlnaHRQb3dlciAvIGxpZ2h0LmdldEZhZGVSYWRpdXMoKSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApIC8gc2FtcGxpbmc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0UG93ZXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmFjZSAocmF5OiBSYXkpOiB7ZGlzdGFuY2U6IG51bWJlciwgcG9pbnQ6IFZlY3Rvciwgb3duZXI6IGFueSwgb3duZXJUeXBlOiBzdHJpbmd9IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBkaXN0YW5jZTogMCxcbiAgICAgICAgICAgICAgICBwb2ludDogbnVsbCxcbiAgICAgICAgICAgICAgICBvd25lcjogbnVsbCxcbiAgICAgICAgICAgICAgICBvd25lclR5cGU6IG51bGxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnRlcnNlY3REYXRhOiBhbnksXG4gICAgICAgICAgICBzY2VuZU9iamVjdHNXaXRoTGlnaHRzOiBhbnlbXSA9IHRoaXMuc2NlbmUuZ2V0T2JqZWN0cygpLmNvbmNhdCh0aGlzLnNjZW5lLmdldExpZ2h0cygpKTtcblxuICAgICAgICBmb3IgKGxldCBvYmplY3Qgb2Ygc2NlbmVPYmplY3RzV2l0aExpZ2h0cykge1xuICAgICAgICAgICAgaW50ZXJzZWN0RGF0YSA9IG9iamVjdC5nZXRJbnRlcnNlY3REYXRhKHJheSk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3REYXRhICYmXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXSA+IDAgJiZcbiAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFsnb3duZXInXSA9PT0gbnVsbCB8fFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3REYXRhWydkaXN0YW5jZSddIDwgcmVzdWx0WydkaXN0YW5jZSddXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0WydkaXN0YW5jZSddID0gaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXTtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ3BvaW50J10gPSBpbnRlcnNlY3REYXRhWydwb2ludCddO1xuICAgICAgICAgICAgICAgIHJlc3VsdFsnb3duZXInXSA9IG9iamVjdDtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ293bmVyVHlwZSddID0gb2JqZWN0LmdldFR5cGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlciAoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIHNjcmVlbldpZHRoPzogbnVtYmVyLCBzY3JlZW5IZWlnaHQ/OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmFuZG9NdWx0aXBsaWVyID0gMC41O1xuXG4gICAgICAgIGxldCBjb2xvcjogQ29sb3IsXG4gICAgICAgICAgICByYW5kOiBudW1iZXIsXG4gICAgICAgICAgICByYXk6IFJheSxcbiAgICAgICAgICAgIHJnYkNvbG9yOiB7XG4gICAgICAgICAgICAgICAgcmVkOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgZ3JlZW46IG51bWJlcixcbiAgICAgICAgICAgICAgICBibHVlOiBudW1iZXJcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5zY3JlZW5XaWR0aCA9IHNjcmVlbldpZHRoO1xuICAgICAgICB0aGlzLnNjcmVlbkhlaWdodCA9IHNjcmVlbkhlaWdodDtcblxuICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHNjcmVlbkhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHNjcmVlbldpZHRoOyB4KyspIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHksIHgpO1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaXRlciA9IDA7IGl0ZXIgPCB0aGlzLnJheXNQZXJQaXhlbDsgaXRlcisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmQgPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGl0ZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJheXNQZXJQaXhlbCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVyICUgMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmQgKz0gTWF0aC5yYW5kb20oKSAqIHJhbmRvTXVsdGlwbGllcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmQgLT0gTWF0aC5yYW5kb20oKSAqIHJhbmRvTXVsdGlwbGllcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJheSA9IG5ldyBSYXkoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLmdldENhbWVyYSgpLmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFBlcnNwZWN0aXZlVmVjdG9yKHggKyByYW5kLCB5ICsgcmFuZCwgc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodClcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBjb2xvciA9IGNvbG9yLmFkZCh0aGlzLmdldENvbG9yKHJheSkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbG9yID0gY29sb3IuZGl2aWRlKHRoaXMucmF5c1BlclBpeGVsKTtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGNvbXBvbmVudCBpbiBjb2xvcikge1xuICAgICAgICAgICAgICAgICAgICBjb2xvcltjb21wb25lbnRdID0gQ29sb3Iuc1JHQkVuY29kZShjb2xvcltjb21wb25lbnRdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZ2JDb2xvciA9IENvbG9yLnRvUkdCKGNvbG9yKTtcblxuICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBgcmdiKCR7cmdiQ29sb3IucmVkfSwgJHtyZ2JDb2xvci5ncmVlbn0sICR7cmdiQ29sb3IuYmx1ZX0pYDtcbiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoeCwgeSwgeCArIDEsIHkgKyAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcHVibGljIHNldFNjZW5lIChzY2VuZTogU2NlbmUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xuICAgIH1cbn1cbiIsImV4cG9ydCBjbGFzcyBWZWN0b3Ige1xuICAgIHByaXZhdGUgeDogbnVtYmVyO1xuICAgIHByaXZhdGUgeTogbnVtYmVyO1xuICAgIHByaXZhdGUgejogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IgKHg6IG51bWJlciwgeTogbnVtYmVyLCB6OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgdGhpcy55ID0geTtcbiAgICAgICAgdGhpcy56ID0gejtcbiAgICB9XG5cbiAgICBnZXRDb29yZGluYXRlcyAoKToge3g6IG51bWJlciwgeTogbnVtYmVyLCB6OiBudW1iZXJ9IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHg6IHRoaXMueCxcbiAgICAgICAgICAgIHk6IHRoaXMueSxcbiAgICAgICAgICAgIHo6IHRoaXMuelxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBhc0FycmF5ICgpOiBudW1iZXJbXSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICB0aGlzLngsXG4gICAgICAgICAgICB0aGlzLnksXG4gICAgICAgICAgICB0aGlzLnpcbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TGVuZ3RoICgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMueCAqKiAyICsgdGhpcy55ICoqIDIgKyB0aGlzLnogKiogMik7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBhZGQgKHZlY3RvcjE6IFZlY3RvciwgdmVjdG9yMjogVmVjdG9yKTogVmVjdG9yIHtcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IodmVjdG9yMS54ICsgdmVjdG9yMi54LCB2ZWN0b3IxLnkgKyB2ZWN0b3IyLnksIHZlY3RvcjEueiArIHZlY3RvcjIueik7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBzdWJzdHJhY3QgKHZlY3RvcjE6IFZlY3RvciwgdmVjdG9yMjogVmVjdG9yKTogVmVjdG9yIHtcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IodmVjdG9yMS54IC0gdmVjdG9yMi54LCB2ZWN0b3IxLnkgLSB2ZWN0b3IyLnksIHZlY3RvcjEueiAtIHZlY3RvcjIueik7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBzY2FsZWQgKHZlY3RvcjogVmVjdG9yLCBtdWx0aXBsaWVyOiBudW1iZXIpOiBWZWN0b3Ige1xuICAgICAgICByZXR1cm4gbmV3IFZlY3Rvcih2ZWN0b3IueCAqIG11bHRpcGxpZXIsIHZlY3Rvci55ICogbXVsdGlwbGllciwgdmVjdG9yLnogKiBtdWx0aXBsaWVyKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGNyb3NzICh2ZWN0b3IxOiBWZWN0b3IsIHZlY3RvcjI6IFZlY3Rvcik6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiBuZXcgVmVjdG9yKFxuICAgICAgICAgICAgdmVjdG9yMS55ICogdmVjdG9yMi56IC0gdmVjdG9yMS56ICogdmVjdG9yMi55LFxuICAgICAgICAgICAgdmVjdG9yMS56ICogdmVjdG9yMi54IC0gdmVjdG9yMS54ICogdmVjdG9yMi56LFxuICAgICAgICAgICAgdmVjdG9yMS54ICogdmVjdG9yMi55IC0gdmVjdG9yMS55ICogdmVjdG9yMi54XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBpbnZlcnNlICh2ZWN0b3I6IFZlY3Rvcik6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiBWZWN0b3Iuc2NhbGVkKHZlY3RvciwgLTEpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZG90ICh2ZWN0b3IxOiBWZWN0b3IsIHZlY3RvcjI6IFZlY3Rvcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB2ZWN0b3IxLnggKiB2ZWN0b3IyLnggKyB2ZWN0b3IxLnkgKiB2ZWN0b3IyLnkgKyB2ZWN0b3IxLnogKiB2ZWN0b3IyLno7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBub3JtYWxpemVkICh2ZWN0b3I6IFZlY3Rvcik6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiBWZWN0b3Iuc2NhbGVkKHZlY3RvciwgMSAvIHZlY3Rvci5nZXRMZW5ndGgoKSk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyByZWZsZWN0ICh2ZWN0b3I6IFZlY3Rvciwgbm9ybWFsOiBWZWN0b3IpOiBWZWN0b3Ige1xuICAgICAgICBsZXQgZiA9IDIgKiBWZWN0b3IuZG90KHZlY3Rvciwgbm9ybWFsKTtcblxuICAgICAgICByZXR1cm4gVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgIHZlY3RvcixcbiAgICAgICAgICAgIFZlY3Rvci5zY2FsZWQobm9ybWFsLCBmKVxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==
