"use strict";var __extends=this&&this.__extends||function(t,r){function e(){this.constructor=t}for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)},AbstractLight_1=require("./AbstractLight"),Color_1=require("./../Color/Color"),Material_1=require("./../Material"),RGBColor_1=require("./../Color/RGBColor"),RTMath_1=require("./../RTMath"),Vector_1=require("./../Vector"),SphericalLight=function(t){function r(r,e,o){t.call(this),this.radius=50,this.fadeRadius=2500,this.material=new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(244,244,244))).setLambertCoeff(1),this.center=r,this.power=e,o&&(this.radius=o)}return __extends(r,t),r.prototype.getFadeRadius=function(){return this.radius+this.fadeRadius},r.prototype.getPosition=function(){return this.center},r.prototype.getPower=function(){return this.power},r.prototype.getRadius=function(){return this.radius},r.prototype.getRandomPoint=function(){var t=Math.random(),r=Math.random(),e=2*Math.PI*t,o=Math.pow(Math.cos(2*r-1),-1);return new Vector_1.Vector(this.radius*Math.cos(e)*Math.sin(o),this.radius*Math.sin(e)*Math.sin(o),this.radius*Math.cos(o))},r.prototype.getIntersectData=function(t){var r,e,o,i,a,n,s,c=Vector_1.Vector.substract(t.getOrigin(),this.center),h=Vector_1.Vector.dot(c,t.getDirection()),u=Vector_1.Vector.dot(c,c)-Math.pow(this.radius,2),p=Math.pow(h,2)-u;if(!(h>0||0>p||p>=0&&(r=-h+Math.sqrt(p),e=-h-Math.sqrt(p),o=Math.min(r,e),i=Math.max(r,e),a=o>RTMath_1.RTMath.EPSILON?o:i,a<RTMath_1.RTMath.EPSILON)))return n=Vector_1.Vector.add(Vector_1.Vector.scale(t.getDirection(),a),t.getOrigin()),s=Vector_1.Vector.substract(n,t.getOrigin()).getLength(),{hitPoint:n,normal:this.getNormal(n),distance:s}},r.prototype.getNormal=function(t){return Vector_1.Vector.normalize(Vector_1.Vector.scale(Vector_1.Vector.substract(t,this.center),1/this.radius))},r.prototype.getMaterial=function(){return this.material},r.prototype.setMaterial=function(t){return this.material=t,this},r}(AbstractLight_1.AbstractLight);exports.SphericalLight=SphericalLight;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxpZ2h0cy9TcGhlcmljYWxMaWdodC5qcyIsIkxpZ2h0cy9TcGhlcmljYWxMaWdodC50cyJdLCJuYW1lcyI6WyJfX2V4dGVuZHMiLCJ0aGlzIiwiZCIsImIiLCJfXyIsImNvbnN0cnVjdG9yIiwicCIsImhhc093blByb3BlcnR5IiwicHJvdG90eXBlIiwiT2JqZWN0IiwiY3JlYXRlIiwiQWJzdHJhY3RMaWdodF8xIiwicmVxdWlyZSIsIkNvbG9yXzEiLCJNYXRlcmlhbF8xIiwiUkdCQ29sb3JfMSIsIlJUTWF0aF8xIiwiVmVjdG9yXzEiLCJTcGhlcmljYWxMaWdodCIsIl9zdXBlciIsIlNwaGVyaWNhbExpZ2h0LmNvbnN0cnVjdG9yIiwiU3BoZXJpY2FsTGlnaHQuZ2V0RmFkZVJhZGl1cyIsIlNwaGVyaWNhbExpZ2h0LmdldFBvc2l0aW9uIiwiU3BoZXJpY2FsTGlnaHQuZ2V0UG93ZXIiLCJTcGhlcmljYWxMaWdodC5nZXRSYWRpdXMiLCJTcGhlcmljYWxMaWdodC5nZXRSYW5kb21Qb2ludCIsIlNwaGVyaWNhbExpZ2h0LmdldEludGVyc2VjdERhdGEiLCJTcGhlcmljYWxMaWdodC5nZXROb3JtYWwiLCJTcGhlcmljYWxMaWdodC5nZXRNYXRlcmlhbCIsIlNwaGVyaWNhbExpZ2h0LnNldE1hdGVyaWFsIiwiQWJzdHJhY3RMaWdodCIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLFlBQ0EsSUFBSUEsV0FBYUMsTUFBUUEsS0FBS0QsV0FBYyxTQUFVRSxFQUFHQyxHQUVyRCxRQUFTQyxLQUFPSCxLQUFLSSxZQUFjSCxFQURuQyxJQUFLLEdBQUlJLEtBQUtILEdBQU9BLEVBQUVJLGVBQWVELEtBQUlKLEVBQUVJLEdBQUtILEVBQUVHLEdBRW5ESixHQUFFTSxVQUFrQixPQUFOTCxFQUFhTSxPQUFPQyxPQUFPUCxJQUFNQyxFQUFHSSxVQUFZTCxFQUFFSyxVQUFXLEdBQUlKLEtDSm5GTyxnQkFBQUMsUUFBOEIsbUJBQzlCQyxRQUFBRCxRQUFzQixvQkFDdEJF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Y0FBdkJDLFNBQUFiLGVBQWNBIiwiZmlsZSI6IkxpZ2h0cy9TcGhlcmljYWxMaWdodC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCBmdW5jdGlvbiAoZCwgYikge1xuICAgIGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdO1xuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbn07XG52YXIgQWJzdHJhY3RMaWdodF8xID0gcmVxdWlyZShcIi4vQWJzdHJhY3RMaWdodFwiKTtcbnZhciBDb2xvcl8xID0gcmVxdWlyZShcIi4vLi4vQ29sb3IvQ29sb3JcIik7XG52YXIgTWF0ZXJpYWxfMSA9IHJlcXVpcmUoXCIuLy4uL01hdGVyaWFsXCIpO1xudmFyIFJHQkNvbG9yXzEgPSByZXF1aXJlKFwiLi8uLi9Db2xvci9SR0JDb2xvclwiKTtcbnZhciBSVE1hdGhfMSA9IHJlcXVpcmUoXCIuLy4uL1JUTWF0aFwiKTtcbnZhciBWZWN0b3JfMSA9IHJlcXVpcmUoXCIuLy4uL1ZlY3RvclwiKTtcbnZhciBTcGhlcmljYWxMaWdodCA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFNwaGVyaWNhbExpZ2h0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFNwaGVyaWNhbExpZ2h0KHBvc2l0aW9uLCBwb3dlciwgcmFkaXVzKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLnJhZGl1cyA9IDUwO1xuICAgICAgICB0aGlzLmZhZGVSYWRpdXMgPSAyNTAwO1xuICAgICAgICB0aGlzLm1hdGVyaWFsID0gbmV3IE1hdGVyaWFsXzEuTWF0ZXJpYWwobmV3IENvbG9yXzEuQ29sb3IobmV3IFJHQkNvbG9yXzEuUkdCQ29sb3IoMjQ0LCAyNDQsIDI0NCkpKS5zZXRMYW1iZXJ0Q29lZmYoMSk7XG4gICAgICAgIHRoaXMuY2VudGVyID0gcG9zaXRpb247XG4gICAgICAgIHRoaXMucG93ZXIgPSBwb3dlcjtcbiAgICAgICAgaWYgKHJhZGl1cykge1xuICAgICAgICAgICAgdGhpcy5yYWRpdXMgPSByYWRpdXM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldEZhZGVSYWRpdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJhZGl1cyArIHRoaXMuZmFkZVJhZGl1cztcbiAgICB9O1xuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2VudGVyO1xuICAgIH07XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldFBvd2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wb3dlcjtcbiAgICB9O1xuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5nZXRSYWRpdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJhZGl1cztcbiAgICB9O1xuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5nZXRSYW5kb21Qb2ludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHUgPSBNYXRoLnJhbmRvbSgpLCB2ID0gTWF0aC5yYW5kb20oKSwgcSA9IDIgKiBNYXRoLlBJICogdSwgZiA9IE1hdGgucG93KE1hdGguY29zKDIgKiB2IC0gMSksIC0xKTtcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3JfMS5WZWN0b3IodGhpcy5yYWRpdXMgKiBNYXRoLmNvcyhxKSAqIE1hdGguc2luKGYpLCB0aGlzLnJhZGl1cyAqIE1hdGguc2luKHEpICogTWF0aC5zaW4oZiksIHRoaXMucmFkaXVzICogTWF0aC5jb3MoZikpO1xuICAgIH07XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldEludGVyc2VjdERhdGEgPSBmdW5jdGlvbiAocmF5KSB7XG4gICAgICAgIHZhciBrID0gVmVjdG9yXzEuVmVjdG9yLnN1YnN0cmFjdChyYXkuZ2V0T3JpZ2luKCksIHRoaXMuY2VudGVyKSwgYiA9IFZlY3Rvcl8xLlZlY3Rvci5kb3QoaywgcmF5LmdldERpcmVjdGlvbigpKSwgYyA9IFZlY3Rvcl8xLlZlY3Rvci5kb3QoaywgaykgLSBNYXRoLnBvdyh0aGlzLnJhZGl1cywgMiksIGQgPSBNYXRoLnBvdyhiLCAyKSAtIGMsIHQxLCB0MiwgbWluVCwgbWF4VCwgaW50ZXJzZWN0aW9uUG9pbnQsIGhpdFBvaW50LCBkaXN0YW5jZTtcbiAgICAgICAgaWYgKGIgPiAwIHx8IGQgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGQgPj0gMCkge1xuICAgICAgICAgICAgdDEgPSAtYiArIE1hdGguc3FydChkKTtcbiAgICAgICAgICAgIHQyID0gLWIgLSBNYXRoLnNxcnQoZCk7XG4gICAgICAgICAgICBtaW5UID0gTWF0aC5taW4odDEsIHQyKTtcbiAgICAgICAgICAgIG1heFQgPSBNYXRoLm1heCh0MSwgdDIpO1xuICAgICAgICAgICAgaWYgKG1pblQgPiBSVE1hdGhfMS5SVE1hdGguRVBTSUxPTikge1xuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvblBvaW50ID0gbWluVDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvblBvaW50ID0gbWF4VDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpbnRlcnNlY3Rpb25Qb2ludCA8IFJUTWF0aF8xLlJUTWF0aC5FUFNJTE9OKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGhpdFBvaW50ID0gVmVjdG9yXzEuVmVjdG9yLmFkZChWZWN0b3JfMS5WZWN0b3Iuc2NhbGUocmF5LmdldERpcmVjdGlvbigpLCBpbnRlcnNlY3Rpb25Qb2ludCksIHJheS5nZXRPcmlnaW4oKSk7XG4gICAgICAgIGRpc3RhbmNlID0gVmVjdG9yXzEuVmVjdG9yLnN1YnN0cmFjdChoaXRQb2ludCwgcmF5LmdldE9yaWdpbigpKS5nZXRMZW5ndGgoKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGhpdFBvaW50OiBoaXRQb2ludCxcbiAgICAgICAgICAgIG5vcm1hbDogdGhpcy5nZXROb3JtYWwoaGl0UG9pbnQpLFxuICAgICAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBTcGhlcmljYWxMaWdodC5wcm90b3R5cGUuZ2V0Tm9ybWFsID0gZnVuY3Rpb24gKHBvaW50KSB7XG4gICAgICAgIHJldHVybiBWZWN0b3JfMS5WZWN0b3Iubm9ybWFsaXplKFZlY3Rvcl8xLlZlY3Rvci5zY2FsZShWZWN0b3JfMS5WZWN0b3Iuc3Vic3RyYWN0KHBvaW50LCB0aGlzLmNlbnRlciksIDEgLyB0aGlzLnJhZGl1cykpO1xuICAgIH07XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldE1hdGVyaWFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXRlcmlhbDtcbiAgICB9O1xuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5zZXRNYXRlcmlhbCA9IGZ1bmN0aW9uIChtYXRlcmlhbCkge1xuICAgICAgICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIFNwaGVyaWNhbExpZ2h0O1xufSkoQWJzdHJhY3RMaWdodF8xLkFic3RyYWN0TGlnaHQpO1xuZXhwb3J0cy5TcGhlcmljYWxMaWdodCA9IFNwaGVyaWNhbExpZ2h0O1xuIiwiaW1wb3J0IHsgQWJzdHJhY3RMaWdodCB9IGZyb20gXCIuL0Fic3RyYWN0TGlnaHRcIjtcbmltcG9ydCB7IENvbG9yIH0gZnJvbSBcIi4vLi4vQ29sb3IvQ29sb3JcIjtcbmltcG9ydCB7IE1hdGVyaWFsIH0gZnJvbSBcIi4vLi4vTWF0ZXJpYWxcIjtcbmltcG9ydCB7IFJheSB9IGZyb20gXCIuLy4uL1JheVwiO1xuaW1wb3J0IHsgUkdCQ29sb3IgfSBmcm9tIFwiLi8uLi9Db2xvci9SR0JDb2xvclwiO1xuaW1wb3J0IHsgUlRNYXRoIH0gZnJvbSBcIi4vLi4vUlRNYXRoXCJcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gXCIuLy4uL1ZlY3RvclwiO1xuXG5leHBvcnQgY2xhc3MgU3BoZXJpY2FsTGlnaHQgZXh0ZW5kcyBBYnN0cmFjdExpZ2h0IHtcbiAgICBwcml2YXRlIGNlbnRlcjogVmVjdG9yO1xuICAgIHByaXZhdGUgcmFkaXVzOiBudW1iZXIgPSA1MDtcbiAgICBwcml2YXRlIHBvd2VyOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBmYWRlUmFkaXVzOiBudW1iZXIgPSAyNTAwO1xuICAgIHByaXZhdGUgbWF0ZXJpYWw6IE1hdGVyaWFsID0gbmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjQ0LCAyNDQsIDI0NCkpKS5zZXRMYW1iZXJ0Q29lZmYoMSk7XG5cbiAgICBjb25zdHJ1Y3RvciAocG9zaXRpb246IFZlY3RvciwgcG93ZXI6IG51bWJlciwgcmFkaXVzPzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5jZW50ZXIgPSBwb3NpdGlvbjtcbiAgICAgICAgdGhpcy5wb3dlciA9IHBvd2VyO1xuXG4gICAgICAgIGlmIChyYWRpdXMpIHtcbiAgICAgICAgICAgIHRoaXMucmFkaXVzID0gcmFkaXVzO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldEZhZGVSYWRpdXMgKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnJhZGl1cyArIHRoaXMuZmFkZVJhZGl1cztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UG9zaXRpb24gKCk6IFZlY3RvciB7XG4gICAgICAgIHJldHVybiB0aGlzLmNlbnRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UG93ZXIgKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvd2VyO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRSYWRpdXMgKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnJhZGl1cztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UmFuZG9tUG9pbnQgKCk6IFZlY3RvciB7XG4gICAgICAgIGxldCB1ID0gTWF0aC5yYW5kb20oKSxcbiAgICAgICAgICAgIHYgPSBNYXRoLnJhbmRvbSgpLFxuICAgICAgICAgICAgcSA9IDIgKiBNYXRoLlBJICogdSxcbiAgICAgICAgICAgIGYgPSBNYXRoLnBvdyhNYXRoLmNvcygyICogdiAtIDEpLCAtMSk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IoXG4gICAgICAgICAgICB0aGlzLnJhZGl1cyAqIE1hdGguY29zKHEpICogTWF0aC5zaW4oZiksXG4gICAgICAgICAgICB0aGlzLnJhZGl1cyAqIE1hdGguc2luKHEpICogTWF0aC5zaW4oZiksXG4gICAgICAgICAgICB0aGlzLnJhZGl1cyAqIE1hdGguY29zKGYpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEludGVyc2VjdERhdGEgKHJheTogUmF5KTogYW55IHtcbiAgICAgICAgbGV0IGsgPSBWZWN0b3Iuc3Vic3RyYWN0KHJheS5nZXRPcmlnaW4oKSwgdGhpcy5jZW50ZXIpLFxuICAgICAgICAgICAgYjogbnVtYmVyID0gVmVjdG9yLmRvdChrLCByYXkuZ2V0RGlyZWN0aW9uKCkpLFxuICAgICAgICAgICAgYzogbnVtYmVyID0gVmVjdG9yLmRvdChrLCBrKSAtIHRoaXMucmFkaXVzICoqIDIsXG4gICAgICAgICAgICBkOiBudW1iZXIgPSBiICoqIDIgLSBjLFxuICAgICAgICAgICAgdDE6IG51bWJlcixcbiAgICAgICAgICAgIHQyOiBudW1iZXIsXG4gICAgICAgICAgICBtaW5UOiBudW1iZXIsXG4gICAgICAgICAgICBtYXhUOiBudW1iZXIsXG4gICAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludDogbnVtYmVyLFxuICAgICAgICAgICAgaGl0UG9pbnQ6IFZlY3RvcixcbiAgICAgICAgICAgIGRpc3RhbmNlOiBudW1iZXI7XG5cbiAgICAgICAgaWYgKGIgPiAwIHx8IGQgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZCA+PSAwKSB7XG4gICAgICAgICAgICB0MSA9IC1iICsgTWF0aC5zcXJ0KGQpO1xuICAgICAgICAgICAgdDIgPSAtYiAtIE1hdGguc3FydChkKTtcbiAgICAgICAgICAgIG1pblQgPSBNYXRoLm1pbih0MSwgdDIpO1xuICAgICAgICAgICAgbWF4VCA9IE1hdGgubWF4KHQxLCB0Mik7XG5cbiAgICAgICAgICAgIGlmIChtaW5UID4gUlRNYXRoLkVQU0lMT04pIHtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludCA9IG1pblQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvblBvaW50ID0gbWF4VDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGludGVyc2VjdGlvblBvaW50IDwgUlRNYXRoLkVQU0lMT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBoaXRQb2ludCA9IFZlY3Rvci5hZGQoXG4gICAgICAgICAgICBWZWN0b3Iuc2NhbGUocmF5LmdldERpcmVjdGlvbigpLCBpbnRlcnNlY3Rpb25Qb2ludCksXG4gICAgICAgICAgICByYXkuZ2V0T3JpZ2luKClcbiAgICAgICAgKTtcbiAgICAgICAgZGlzdGFuY2UgPSBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgaGl0UG9pbnQsXG4gICAgICAgICAgICByYXkuZ2V0T3JpZ2luKClcbiAgICAgICAgKS5nZXRMZW5ndGgoKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaGl0UG9pbnQ6IGhpdFBvaW50LFxuICAgICAgICAgICAgbm9ybWFsOiB0aGlzLmdldE5vcm1hbChoaXRQb2ludCksXG4gICAgICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2VcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Tm9ybWFsIChwb2ludDogVmVjdG9yKTogVmVjdG9yIHtcbiAgICAgICAgcmV0dXJuIFZlY3Rvci5ub3JtYWxpemUoXG4gICAgICAgICAgICBWZWN0b3Iuc2NhbGUoXG4gICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChwb2ludCwgdGhpcy5jZW50ZXIpLFxuICAgICAgICAgICAgICAgIDEgLyB0aGlzLnJhZGl1c1xuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRNYXRlcmlhbCAoKTogTWF0ZXJpYWwge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXRlcmlhbDtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0TWF0ZXJpYWwgKG1hdGVyaWFsOiBNYXRlcmlhbCk6IHRoaXMge1xuICAgICAgICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
