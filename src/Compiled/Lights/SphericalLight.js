var __extends=this&&this.__extends||function(t,r){function e(){this.constructor=t}for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)},AbstractLight_1=require("./AbstractLight"),Color_1=require("./../Color/Color"),Material_1=require("./../Material"),RGBColor_1=require("./../Color/RGBColor"),RTMath_1=require("./../RTMath"),Vector_1=require("./../Vector"),SphericalLight=function(t){function r(r,e,o){t.call(this),this.radius=50,this.fadeRadius=2500,this.material=new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(244,244,244)),0).setLambertCoeff(1),this.type="light",this.position=r,this.power=e,o&&(this.radius=o)}return __extends(r,t),r.prototype.getFadeRadius=function(){return this.radius+this.fadeRadius},r.prototype.getPosition=function(){return this.position},r.prototype.getPower=function(){return this.power},r.prototype.getRadius=function(){return this.radius},r.prototype.getRandomPoint=function(){var t=Math.random(),r=Math.random(),e=2*Math.PI*t,o=Math.pow(Math.cos(2*r-1),-1);return new Vector_1.Vector(this.radius*Math.cos(e)*Math.sin(o),this.radius*Math.sin(e)*Math.sin(o),this.radius*Math.cos(o))},r.prototype.getIntersectData=function(t){var r,e,o,i,a,s,n,h=Vector_1.Vector.substract(t.getOrigin(),this.position),c=Vector_1.Vector.dot(h,t.getDirection()),u=Vector_1.Vector.dot(h,h)-Math.pow(this.radius,2),p=Math.pow(c,2)-u;if(!(c>0||0>p||p>=0&&(r=-c+Math.sqrt(p),e=-c-Math.sqrt(p),o=Math.min(r,e),i=Math.max(r,e),a=o>RTMath_1.RTMath.EPSILON?o:i,a<RTMath_1.RTMath.EPSILON)))return s=Vector_1.Vector.add(Vector_1.Vector.scaled(t.getDirection(),a),t.getOrigin()),n=Vector_1.Vector.substract(s,t.getOrigin()).getLength(),{point:s,distance:n}},r.prototype.getNormal=function(t){return Vector_1.Vector.normalized(Vector_1.Vector.scaled(Vector_1.Vector.substract(t,this.position),1/this.radius))},r.prototype.getMaterial=function(){return this.material},r.prototype.getType=function(){return this.type},r.prototype.setMaterial=function(t){return this.material=t,this},r}(AbstractLight_1.AbstractLight);exports.SphericalLight=SphericalLight;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxpZ2h0cy9TcGhlcmljYWxMaWdodC5qcyIsIkxpZ2h0cy9TcGhlcmljYWxMaWdodC50cyJdLCJuYW1lcyI6WyJfX2V4dGVuZHMiLCJ0aGlzIiwiZCIsImIiLCJfXyIsImNvbnN0cnVjdG9yIiwicCIsImhhc093blByb3BlcnR5IiwicHJvdG90eXBlIiwiT2JqZWN0IiwiY3JlYXRlIiwiQWJzdHJhY3RMaWdodF8xIiwicmVxdWlyZSIsIkNvbG9yXzEiLCJNYXRlcmlhbF8xIiwiUkdCQ29sb3JfMSIsIlJUTWF0aF8xIiwiVmVjdG9yXzEiLCJTcGhlcmljYWxMaWdodCIsIl9zdXBlciIsIlNwaGVyaWNhbExpZ2h0LmNvbnN0cnVjdG9yIiwiU3BoZXJpY2FsTGlnaHQuZ2V0RmFkZVJhZGl1cyIsIlNwaGVyaWNhbExpZ2h0LmdldFBvc2l0aW9uIiwiU3BoZXJpY2FsTGlnaHQuZ2V0UG93ZXIiLCJTcGhlcmljYWxMaWdodC5nZXRSYWRpdXMiLCJTcGhlcmljYWxMaWdodC5nZXRSYW5kb21Qb2ludCIsIlNwaGVyaWNhbExpZ2h0LmdldEludGVyc2VjdERhdGEiLCJTcGhlcmljYWxMaWdodC5nZXROb3JtYWwiLCJTcGhlcmljYWxMaWdodC5nZXRNYXRlcmlhbCIsIlNwaGVyaWNhbExpZ2h0LmdldFR5cGUiLCJTcGhlcmljYWxMaWdodC5zZXRNYXRlcmlhbCIsIkFic3RyYWN0TGlnaHQiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFJQSxXQUFhQyxNQUFRQSxLQUFLRCxXQUFjLFNBQVVFLEVBQUdDLEdBRXJELFFBQVNDLEtBQU9ILEtBQUtJLFlBQWNILEVBRG5DLElBQUssR0FBSUksS0FBS0gsR0FBT0EsRUFBRUksZUFBZUQsS0FBSUosRUFBRUksR0FBS0gsRUFBRUcsR0FFbkRKLEdBQUVNLFVBQWtCLE9BQU5MLEVBQWFNLE9BQU9DLE9BQU9QLElBQU1DLEVBQUdJLFVBQVlMLEVBQUVLLFVBQVcsR0FBSUosS0NIbkZPLGdCQUFBQyxRQUE4QixtQkFDOUJD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UEEsU0FBb0JBLEdBR2hCWSxNQUZBQSxNQUFLQSxTQUFXQSxFQUVUQSxNQUVmWixHQXZIb0NQLGdCQUFBb0IsY0FBdkJDLFNBQUFkLGVBQWNBIiwiZmlsZSI6IkxpZ2h0cy9TcGhlcmljYWxMaWdodC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgZnVuY3Rpb24gKGQsIGIpIHtcbiAgICBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTtcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG59O1xudmFyIEFic3RyYWN0TGlnaHRfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0TGlnaHRcIik7XG52YXIgQ29sb3JfMSA9IHJlcXVpcmUoXCIuLy4uL0NvbG9yL0NvbG9yXCIpO1xudmFyIE1hdGVyaWFsXzEgPSByZXF1aXJlKFwiLi8uLi9NYXRlcmlhbFwiKTtcbnZhciBSR0JDb2xvcl8xID0gcmVxdWlyZShcIi4vLi4vQ29sb3IvUkdCQ29sb3JcIik7XG52YXIgUlRNYXRoXzEgPSByZXF1aXJlKFwiLi8uLi9SVE1hdGhcIik7XG52YXIgVmVjdG9yXzEgPSByZXF1aXJlKFwiLi8uLi9WZWN0b3JcIik7XG52YXIgU3BoZXJpY2FsTGlnaHQgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhTcGhlcmljYWxMaWdodCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBTcGhlcmljYWxMaWdodChwb3NpdGlvbiwgcG93ZXIsIHJhZGl1cykge1xuICAgICAgICBfc3VwZXIuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5yYWRpdXMgPSA1MDtcbiAgICAgICAgdGhpcy5mYWRlUmFkaXVzID0gMjUwMDtcbiAgICAgICAgdGhpcy5tYXRlcmlhbCA9IG5ldyBNYXRlcmlhbF8xLk1hdGVyaWFsKG5ldyBDb2xvcl8xLkNvbG9yKG5ldyBSR0JDb2xvcl8xLlJHQkNvbG9yKDI0NCwgMjQ0LCAyNDQpKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpO1xuICAgICAgICB0aGlzLnR5cGUgPSAnbGlnaHQnO1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIHRoaXMucG93ZXIgPSBwb3dlcjtcbiAgICAgICAgaWYgKHJhZGl1cykge1xuICAgICAgICAgICAgdGhpcy5yYWRpdXMgPSByYWRpdXM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldEZhZGVSYWRpdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJhZGl1cyArIHRoaXMuZmFkZVJhZGl1cztcbiAgICB9O1xuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb247XG4gICAgfTtcbiAgICBTcGhlcmljYWxMaWdodC5wcm90b3R5cGUuZ2V0UG93ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvd2VyO1xuICAgIH07XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldFJhZGl1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmFkaXVzO1xuICAgIH07XG4gICAgU3BoZXJpY2FsTGlnaHQucHJvdG90eXBlLmdldFJhbmRvbVBvaW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdSA9IE1hdGgucmFuZG9tKCksIHYgPSBNYXRoLnJhbmRvbSgpLCBxID0gMiAqIE1hdGguUEkgKiB1LCBmID0gTWF0aC5wb3coTWF0aC5jb3MoMiAqIHYgLSAxKSwgLTEpO1xuICAgICAgICByZXR1cm4gbmV3IFZlY3Rvcl8xLlZlY3Rvcih0aGlzLnJhZGl1cyAqIE1hdGguY29zKHEpICogTWF0aC5zaW4oZiksIHRoaXMucmFkaXVzICogTWF0aC5zaW4ocSkgKiBNYXRoLnNpbihmKSwgdGhpcy5yYWRpdXMgKiBNYXRoLmNvcyhmKSk7XG4gICAgfTtcbiAgICBTcGhlcmljYWxMaWdodC5wcm90b3R5cGUuZ2V0SW50ZXJzZWN0RGF0YSA9IGZ1bmN0aW9uIChyYXkpIHtcbiAgICAgICAgdmFyIGsgPSBWZWN0b3JfMS5WZWN0b3Iuc3Vic3RyYWN0KHJheS5nZXRPcmlnaW4oKSwgdGhpcy5wb3NpdGlvbiksIGIgPSBWZWN0b3JfMS5WZWN0b3IuZG90KGssIHJheS5nZXREaXJlY3Rpb24oKSksIGMgPSBWZWN0b3JfMS5WZWN0b3IuZG90KGssIGspIC0gTWF0aC5wb3codGhpcy5yYWRpdXMsIDIpLCBkID0gTWF0aC5wb3coYiwgMikgLSBjLCB0MSwgdDIsIG1pblQsIG1heFQsIGludGVyc2VjdGlvblBvaW50LCBwb2ludCwgZGlzdGFuY2U7XG4gICAgICAgIGlmIChiID4gMCB8fCBkIDwgMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkID49IDApIHtcbiAgICAgICAgICAgIHQxID0gLWIgKyBNYXRoLnNxcnQoZCk7XG4gICAgICAgICAgICB0MiA9IC1iIC0gTWF0aC5zcXJ0KGQpO1xuICAgICAgICAgICAgbWluVCA9IE1hdGgubWluKHQxLCB0Mik7XG4gICAgICAgICAgICBtYXhUID0gTWF0aC5tYXgodDEsIHQyKTtcbiAgICAgICAgICAgIGlmIChtaW5UID4gUlRNYXRoXzEuUlRNYXRoLkVQU0lMT04pIHtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludCA9IG1pblQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludCA9IG1heFQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9uUG9pbnQgPCBSVE1hdGhfMS5SVE1hdGguRVBTSUxPTikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwb2ludCA9IFZlY3Rvcl8xLlZlY3Rvci5hZGQoVmVjdG9yXzEuVmVjdG9yLnNjYWxlZChyYXkuZ2V0RGlyZWN0aW9uKCksIGludGVyc2VjdGlvblBvaW50KSwgcmF5LmdldE9yaWdpbigpKTtcbiAgICAgICAgZGlzdGFuY2UgPSBWZWN0b3JfMS5WZWN0b3Iuc3Vic3RyYWN0KHBvaW50LCByYXkuZ2V0T3JpZ2luKCkpLmdldExlbmd0aCgpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcG9pbnQ6IHBvaW50LFxuICAgICAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBTcGhlcmljYWxMaWdodC5wcm90b3R5cGUuZ2V0Tm9ybWFsID0gZnVuY3Rpb24gKHBvaW50KSB7XG4gICAgICAgIHJldHVybiBWZWN0b3JfMS5WZWN0b3Iubm9ybWFsaXplZChWZWN0b3JfMS5WZWN0b3Iuc2NhbGVkKFZlY3Rvcl8xLlZlY3Rvci5zdWJzdHJhY3QocG9pbnQsIHRoaXMucG9zaXRpb24pLCAxIC8gdGhpcy5yYWRpdXMpKTtcbiAgICB9O1xuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5nZXRNYXRlcmlhbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF0ZXJpYWw7XG4gICAgfTtcbiAgICBTcGhlcmljYWxMaWdodC5wcm90b3R5cGUuZ2V0VHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZTtcbiAgICB9O1xuICAgIFNwaGVyaWNhbExpZ2h0LnByb3RvdHlwZS5zZXRNYXRlcmlhbCA9IGZ1bmN0aW9uIChtYXRlcmlhbCkge1xuICAgICAgICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIFNwaGVyaWNhbExpZ2h0O1xufSkoQWJzdHJhY3RMaWdodF8xLkFic3RyYWN0TGlnaHQpO1xuZXhwb3J0cy5TcGhlcmljYWxMaWdodCA9IFNwaGVyaWNhbExpZ2h0O1xuIiwiaW1wb3J0IHsgQWJzdHJhY3RMaWdodCB9IGZyb20gXCIuL0Fic3RyYWN0TGlnaHRcIjtcbmltcG9ydCB7IENvbG9yIH0gZnJvbSBcIi4vLi4vQ29sb3IvQ29sb3JcIjtcbmltcG9ydCB7IE1hdGVyaWFsIH0gZnJvbSBcIi4vLi4vTWF0ZXJpYWxcIjtcbmltcG9ydCB7IFJheSB9IGZyb20gXCIuLy4uL1JheVwiO1xuaW1wb3J0IHsgUkdCQ29sb3IgfSBmcm9tIFwiLi8uLi9Db2xvci9SR0JDb2xvclwiO1xuaW1wb3J0IHsgUlRNYXRoIH0gZnJvbSBcIi4vLi4vUlRNYXRoXCJcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gXCIuLy4uL1ZlY3RvclwiO1xuXG5leHBvcnQgY2xhc3MgU3BoZXJpY2FsTGlnaHQgZXh0ZW5kcyBBYnN0cmFjdExpZ2h0IHtcbiAgICBwcml2YXRlIHBvc2l0aW9uOiBWZWN0b3I7XG4gICAgcHJpdmF0ZSByYWRpdXM6IG51bWJlciA9IDUwO1xuICAgIHByaXZhdGUgcG93ZXI6IG51bWJlcjtcbiAgICBwcml2YXRlIGZhZGVSYWRpdXM6IG51bWJlciA9IDI1MDA7XG4gICAgcHJpdmF0ZSBtYXRlcmlhbDogTWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNDQsIDI0NCwgMjQ0KSksIDApLnNldExhbWJlcnRDb2VmZigxKTtcbiAgICBwcml2YXRlIHR5cGU6IHN0cmluZyA9ICdsaWdodCc7XG5cbiAgICBjb25zdHJ1Y3RvciAocG9zaXRpb246IFZlY3RvciwgcG93ZXI6IG51bWJlciwgcmFkaXVzPzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICB0aGlzLnBvd2VyID0gcG93ZXI7XG5cbiAgICAgICAgaWYgKHJhZGl1cykge1xuICAgICAgICAgICAgdGhpcy5yYWRpdXMgPSByYWRpdXM7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RmFkZVJhZGl1cyAoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmFkaXVzICsgdGhpcy5mYWRlUmFkaXVzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRQb3NpdGlvbiAoKTogVmVjdG9yIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb247XG4gICAgfVxuXG4gICAgcHVibGljIGdldFBvd2VyICgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5wb3dlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UmFkaXVzICgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5yYWRpdXM7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFJhbmRvbVBvaW50ICgpOiBWZWN0b3Ige1xuICAgICAgICBsZXQgdSA9IE1hdGgucmFuZG9tKCksXG4gICAgICAgICAgICB2ID0gTWF0aC5yYW5kb20oKSxcbiAgICAgICAgICAgIHEgPSAyICogTWF0aC5QSSAqIHUsXG4gICAgICAgICAgICBmID0gTWF0aC5wb3coTWF0aC5jb3MoMiAqIHYgLSAxKSwgLTEpO1xuXG4gICAgICAgIHJldHVybiBuZXcgVmVjdG9yKFxuICAgICAgICAgICAgdGhpcy5yYWRpdXMgKiBNYXRoLmNvcyhxKSAqIE1hdGguc2luKGYpLFxuICAgICAgICAgICAgdGhpcy5yYWRpdXMgKiBNYXRoLnNpbihxKSAqIE1hdGguc2luKGYpLFxuICAgICAgICAgICAgdGhpcy5yYWRpdXMgKiBNYXRoLmNvcyhmKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRJbnRlcnNlY3REYXRhIChyYXk6IFJheSk6IGFueSB7XG4gICAgICAgIGxldCBrID0gVmVjdG9yLnN1YnN0cmFjdChyYXkuZ2V0T3JpZ2luKCksIHRoaXMucG9zaXRpb24pLFxuICAgICAgICAgICAgYjogbnVtYmVyID0gVmVjdG9yLmRvdChrLCByYXkuZ2V0RGlyZWN0aW9uKCkpLFxuICAgICAgICAgICAgYzogbnVtYmVyID0gVmVjdG9yLmRvdChrLCBrKSAtIHRoaXMucmFkaXVzICoqIDIsXG4gICAgICAgICAgICBkOiBudW1iZXIgPSBiICoqIDIgLSBjLFxuICAgICAgICAgICAgdDE6IG51bWJlcixcbiAgICAgICAgICAgIHQyOiBudW1iZXIsXG4gICAgICAgICAgICBtaW5UOiBudW1iZXIsXG4gICAgICAgICAgICBtYXhUOiBudW1iZXIsXG4gICAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludDogbnVtYmVyLFxuICAgICAgICAgICAgcG9pbnQ6IFZlY3RvcixcbiAgICAgICAgICAgIGRpc3RhbmNlOiBudW1iZXI7XG5cbiAgICAgICAgaWYgKGIgPiAwIHx8IGQgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZCA+PSAwKSB7XG4gICAgICAgICAgICB0MSA9IC1iICsgTWF0aC5zcXJ0KGQpO1xuICAgICAgICAgICAgdDIgPSAtYiAtIE1hdGguc3FydChkKTtcbiAgICAgICAgICAgIG1pblQgPSBNYXRoLm1pbih0MSwgdDIpO1xuICAgICAgICAgICAgbWF4VCA9IE1hdGgubWF4KHQxLCB0Mik7XG5cbiAgICAgICAgICAgIGlmIChtaW5UID4gUlRNYXRoLkVQU0lMT04pIHtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludCA9IG1pblQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvblBvaW50ID0gbWF4VDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGludGVyc2VjdGlvblBvaW50IDwgUlRNYXRoLkVQU0lMT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBwb2ludCA9IFZlY3Rvci5hZGQoXG4gICAgICAgICAgICBWZWN0b3Iuc2NhbGVkKHJheS5nZXREaXJlY3Rpb24oKSwgaW50ZXJzZWN0aW9uUG9pbnQpLFxuICAgICAgICAgICAgcmF5LmdldE9yaWdpbigpXG4gICAgICAgICk7XG4gICAgICAgIGRpc3RhbmNlID0gVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgIHBvaW50LFxuICAgICAgICAgICAgcmF5LmdldE9yaWdpbigpXG4gICAgICAgICkuZ2V0TGVuZ3RoKCk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBvaW50LFxuICAgICAgICAgICAgZGlzdGFuY2VcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Tm9ybWFsIChwb2ludDogVmVjdG9yKTogVmVjdG9yIHtcbiAgICAgICAgcmV0dXJuIFZlY3Rvci5ub3JtYWxpemVkKFxuICAgICAgICAgICAgVmVjdG9yLnNjYWxlZChcbiAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KHBvaW50LCB0aGlzLnBvc2l0aW9uKSxcbiAgICAgICAgICAgICAgICAxIC8gdGhpcy5yYWRpdXNcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TWF0ZXJpYWwgKCk6IE1hdGVyaWFsIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF0ZXJpYWw7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFR5cGUgKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnR5cGU7XG4gICAgfVxuXG4gICAgcHVibGljIHNldE1hdGVyaWFsIChtYXRlcmlhbDogTWF0ZXJpYWwpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
