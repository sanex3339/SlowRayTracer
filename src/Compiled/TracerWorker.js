var Camera_1=require("./Camera"),Color_1=require("./Color/Color"),Ray_1=require("./Ray"),RGBColor_1=require("./Color/RGBColor"),Scene_1=require("./Scene"),Sphere_1=require("./Objects/Sphere"),Vector_1=require("./Vector"),SphericalLight_1=require("./Lights/SphericalLight"),Material_1=require("./Material"),Polygon_1=require("./Objects/Polygon"),Tracer=function(){function e(){this.pixelSamples=4,this.shadowSamples=200,this.giSamples=200,this.screenWidth=250,this.screenHeight=250}return e.prototype.getColor=function(e,o){void 0===o&&(o=!0);var r=this.trace(e),t=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0));return null===r.owner?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(t=this.getDiffuseColor(e,r,o),o&&(n=this.getReflectionColor(e,r)),t.add(n))},e.prototype.getDiffuseColor=function(e,o,r){void 0===r&&(r=!0);for(var t,n,l,a,i,c,_,s,w,C,V=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),g=0,d=this.scene.getLights();g<d.length;g++){var h=d[g];if("light"===o.ownerType)return o.owner.getMaterial().getColor();if(c=this.getLightPower(o,h),t=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),a=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),i=Vector_1.Vector.normalized(Vector_1.Vector.substract(o.point,h.getPosition())),s=-Vector_1.Vector.dot(i,o.normal),t=t.add(o.owner.getMaterial().getColor().multiple(h.getMaterial().getColor().scaled(c*s*o.owner.getMaterial().getLambertCoeff()))),r)for(var p=function(e){for(var o;;)if(o=new Vector_1.Vector(Math.random()-.5,Math.random()-.5,Math.random()-.5),!(Vector_1.Vector.dot(o,o)>1))return o=Vector_1.Vector.normalized(o),Vector_1.Vector.dot(o,e)<0&&(o=Vector_1.Vector.inverse(o)),o},R=0;R<this.giSamples;++R){var u=void 0,f=void 0;l=p(o.owner.getNormal(o.point)),u=this.getColor(new Ray_1.Ray(o.point,l),!1),f=Vector_1.Vector.dot(l,o.owner.getNormal(o.point)),n=n.add(o.owner.getMaterial().getColor().divide(Math.PI).multiple(u.scaled(f)))}_=Vector_1.Vector.reflect(i,o.normal),w=-Vector_1.Vector.dot(_,e.getDirection()),w>0&&(C=Math.pow(w,35),a=a.add(o.owner.getMaterial().getColor().multiple(h.getMaterial().getColor().scaled(c*C*o.owner.getMaterial().getPhongCoeff())))),V=V.add(t.add(n.divide(this.giSamples))).add(a)}return V},e.prototype.getReflectionColor=function(e,o){var r,t,n=o.owner.getMaterial().getReflectionValue();return e.setIteration(e.getIteration()-1),0===e.getIteration()||0===n?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(t=Vector_1.Vector.reflect(e.getDirection(),o.normal),r=this.getColor(new Ray_1.Ray(o.point,t,e.getIteration())).scaled(n))},e.prototype.getPerspectiveVector=function(e,o,r,t){var n=this.scene.getCamera();return Vector_1.Vector.normalized(Vector_1.Vector.add(n.getForwardVector(),Vector_1.Vector.add(Vector_1.Vector.scaled(n.getRightVector(),n.recenterX(e)),Vector_1.Vector.scaled(n.getUpVector(),n.recenterY(o)))))},e.prototype.getLightPower=function(e,o){for(var r,t=o.getPower(),n=0,l=0;l<this.shadowSamples;l++){r=o.getRandomPoint();var a=this.trace(new Ray_1.Ray(e.point,Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),r),e.point)));null!==a.point&&a.owner===o&&(n+=(t-Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),r),e.point).getLength()*(t/o.getFadeRadius()))/this.shadowSamples)}return n},e.prototype.trace=function(e){for(var o,r={distance:0,point:null,normal:null,owner:null,ownerType:null},t=this.scene.getObjects().concat(this.scene.getLights()),n=0,l=t;n<l.length;n++){var a=l[n];o=a.getIntersectData(e),o&&o.distance>0&&(null===r.owner||o.distance<r.distance)&&(r.distance=o.distance,r.point=o.point,r.owner=a,r.ownerType=a.getType(),r.normal=r.owner.getNormal(r.point))}return r},e.prototype.render=function(e,o,r,t){var n,l,a,i,c=.5;this.screenWidth=e,this.screenHeight=o,n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0));for(var _=0;_<this.pixelSamples;_++)l=0,this.pixelSamples>1&&(_%2?l+=Math.random()*c:l-=Math.random()*c),a=new Ray_1.Ray(this.scene.getCamera().getPosition(),this.getPerspectiveVector(r+l,t+l,e,o)),n=n.add(this.getColor(a));n=n.divide(this.pixelSamples);for(var s in n)n[s]=Color_1.Color.sRGBEncode(n[s]);i=Color_1.Color.toRGB(n),self.postMessage([r,t,i.red,i.green,i.blue])},e.prototype.setScene=function(e){this.scene=e},e}();onmessage=function(e){var o=e.data;"string"==typeof o&&(o=JSON.parse("["+o+"]"));var r=new Tracer;r.setScene(new Scene_1.Scene({camera:new Camera_1.Camera(new Vector_1.Vector(0,0,-699),new Vector_1.Vector(0,0,1),o[0],o[1]),lights:[new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,640,0),1.2,50).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255))))],objects:[new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(-700,-700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(-700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,700,-700),new Vector_1.Vector(700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(-700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,0,0)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),0).setLambertCoeff(1)),new Sphere_1.Sphere(new Vector_1.Vector(-250,-500,450),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),1)),new Sphere_1.Sphere(new Vector_1.Vector(250,-500,400),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,255,0)),0))]})),r.render(o[0],o[1],o[2],o[3])};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRyYWNlcldvcmtlci50cyJdLCJuYW1lcyI6WyJDYW1lcmFfMSIsInJlcXVpcmUiLCJDb2xvcl8xIiwiUmF5XzEiLCJSR0JDb2xvcl8xIiwiU2NlbmVfMSIsIlNwaGVyZV8xIiwiVmVjdG9yXzEiLCJTcGhlcmljYWxMaWdodF8xIiwiTWF0ZXJpYWxfMSIsIlBvbHlnb25fMSIsIlRyYWNlciIsIlRyYWNlci5jb25zdHJ1Y3RvciIsIlRyYWNlci5nZXRDb2xvciIsIlRyYWNlci5nZXREaWZmdXNlQ29sb3IiLCJUcmFjZXIuZ2V0UmVmbGVjdGlvbkNvbG9yIiwiVHJhY2VyLmdldFBlcnNwZWN0aXZlVmVjdG9yIiwiVHJhY2VyLmdldExpZ2h0UG93ZXIiLCJUcmFjZXIudHJhY2UiLCJUcmFjZXIucmVuZGVyIiwiVHJhY2VyLnNldFNjZW5lIiwib25tZXNzYWdlIiwibWVzc2FnZSIsImRhdGEiLCJKU09OIiwicGFyc2UiLCJ0cmFjZXIiLCJzZXRTY2VuZSIsIlNjZW5lIiwiY2FtZXJhIiwiQ2FtZXJhIiwiVmVjdG9yIiwibGlnaHRzIiwiU3BoZXJpY2FsTGlnaHQiLCJzZXRNYXRlcmlhbCIsIk1hdGVyaWFsIiwiQ29sb3IiLCJSR0JDb2xvciIsIm9iamVjdHMiLCJQb2x5Z29uIiwic2V0TGFtYmVydENvZWZmIiwiU3BoZXJlIiwicmVuZGVyIl0sIm1hcHBpbmdzIjoiQUFHQSxHQUFBQSxVQUFBQyxRQUF1QixZQUN2QkMsUUFBQUQsUUFBc0IsaUJBQ3RCRSxNQUFBRixRQUFvQixTQUNwQkcsV0FBQUgsUUFBeUIsb0JBRXpCSSxRQUFBSixRQUFzQixXQUN0QkssU0FBQUwsUUFBdUIsb0JBQ3ZCTSxTQUFBTixRQUF1QixZQUd2Qk8saUJBQUFQLFFBQStCLDJCQUMvQlEsV0FBQVIsUUFBeUIsY0FDekJTLFVBQUFULFFBQXdCLHFCQUV4QlUsT0FBQSxXQUFBQSxRQUFBQSxLQUVZQyxLQUFBQSxhQUF1QkEsRUFDdkJBLEtBQUFBLGNBQXdCQSxJQUN4QkEsS0FBQUEsVUFB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LE1BQ3RCLEdBQUl4QixVQUFBd0IsT0FBTyxJQUFLLElBQUssT0FDdkJHLFlBQVksR0FBSXpCLFlBQUEwQixTQUFTLEdBQUlqQyxTQUFBa0MsTUFBTSxHQUFJaEMsWUFBQWlDLFNBQVMsRUFBRyxFQUFHLElBQUssR0FBR0csZ0JBQWdCLElBQ2hGLEdBQUlsQyxVQUFBbUMsT0FBTyxHQUFJbEMsVUFBQXdCLE9BQU8sS0FBTSxLQUFNLEtBQU0sS0FDbkNHLFlBQVksR0FBSXpCLFlBQUEwQixTQUFTLEdBQUlqQyxTQUFBa0MsTUFBTSxHQUFJaEMsWUFBQWlDLFNBQVMsRUFBRyxFQUFHLElBQUssSUFDaEUsR0FBSS9CLFVBQUFtQyxPQUFPLEdBQUlsQyxVQUFBd0IsT0FBTyxJQUFLLEtBQU0sS0FBTSxLQUNsQ0csWUFBWSxHQUFJekIsWUFBQTBCLFNBQVMsR0FBSWpDLFNBQUFrQyxNQUFNLEdBQUloQyxZQUFBaUMsU0FBUyxFQUFHLElBQUssSUFBSyxRQUs5RVgsRUFBT2dCLE9BQU9uQixFQUFLLEdBQUlBLEVBQUssR0FBSUEsRUFBSyxHQUFJQSxFQUFLIiwiZmlsZSI6IlRyYWNlcldvcmtlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIG5vLWRlZmF1bHQtbGliPVwidHJ1ZVwiLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJsaWIvbGliLndlYndvcmtlci5kLnRzXCIgLz5cblxuaW1wb3J0IHsgQ2FtZXJhIH0gZnJvbSBcIi4vQ2FtZXJhXCI7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gXCIuL0NvbG9yL0NvbG9yXCI7XG5pbXBvcnQgeyBSYXkgfSBmcm9tIFwiLi9SYXlcIjtcbmltcG9ydCB7IFJHQkNvbG9yIH0gZnJvbSBcIi4vQ29sb3IvUkdCQ29sb3JcIjtcbmltcG9ydCB7IFJUTWF0aCB9IGZyb20gXCIuL1JUTWF0aFwiO1xuaW1wb3J0IHsgU2NlbmUgfSBmcm9tIFwiLi9TY2VuZVwiO1xuaW1wb3J0IHsgU3BoZXJlIH0gZnJvbSBcIi4vT2JqZWN0cy9TcGhlcmVcIjtcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gXCIuL1ZlY3RvclwiO1xuaW1wb3J0IHsgUGxhbmUgfSBmcm9tIFwiLi9PYmplY3RzL1BsYW5lXCI7XG5pbXBvcnQgeyBBYnN0cmFjdExpZ2h0IH0gZnJvbSBcIi4vTGlnaHRzL0Fic3RyYWN0TGlnaHRcIjtcbmltcG9ydCB7IFNwaGVyaWNhbExpZ2h0IH0gZnJvbSBcIi4vTGlnaHRzL1NwaGVyaWNhbExpZ2h0XCI7XG5pbXBvcnQgeyBNYXRlcmlhbCB9IGZyb20gXCIuL01hdGVyaWFsXCI7XG5pbXBvcnQgeyBQb2x5Z29uIH0gZnJvbSBcIi4vT2JqZWN0cy9Qb2x5Z29uXCI7XG5cbmNsYXNzIFRyYWNlciB7XG4gICAgcHJpdmF0ZSBzY2VuZTogU2NlbmU7XG4gICAgcHJpdmF0ZSBwaXhlbFNhbXBsZXM6IG51bWJlciA9IDQ7XG4gICAgcHJpdmF0ZSBzaGFkb3dTYW1wbGVzOiBudW1iZXIgPSAyMDA7XG4gICAgcHJpdmF0ZSBnaVNhbXBsZXM6IG51bWJlciA9IDIwMDtcbiAgICBwcml2YXRlIHNjcmVlbldpZHRoOiBudW1iZXIgPSAyNTA7XG4gICAgcHJpdmF0ZSBzY3JlZW5IZWlnaHQ6IG51bWJlciA9IDI1MDtcblxuICAgIHByaXZhdGUgZ2V0Q29sb3IgKHJheTogUmF5LCByZWN1cmNpdmU6IGJvb2xlYW4gPSB0cnVlKTogQ29sb3Ige1xuICAgICAgICBsZXQgaW50ZXJzZWN0ID0gdGhpcy50cmFjZShyYXkpLFxuICAgICAgICAgICAgZGlmZnVzZUNvbG9yOiBDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpLFxuICAgICAgICAgICAgcmVmbGVjdENvbG9yOiBDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuXG4gICAgICAgIGlmIChpbnRlcnNlY3RbJ293bmVyJ10gPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRpZmZ1c2VDb2xvciA9IHRoaXMuZ2V0RGlmZnVzZUNvbG9yKHJheSwgaW50ZXJzZWN0LCByZWN1cmNpdmUpO1xuXG4gICAgICAgIGlmIChyZWN1cmNpdmUpIHtcbiAgICAgICAgICAgIHJlZmxlY3RDb2xvciA9IHRoaXMuZ2V0UmVmbGVjdGlvbkNvbG9yKHJheSwgaW50ZXJzZWN0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaWZmdXNlQ29sb3IuYWRkKHJlZmxlY3RDb2xvcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREaWZmdXNlQ29sb3IgKHJheTogUmF5LCBpbnRlcnNlY3Q6IGFueSwgcmVjdXJzaXZlOiBib29sZWFuID0gdHJ1ZSk6IENvbG9yIHtcbiAgICAgICAgbGV0IGxhbWJDb2xvcjogQ29sb3IsXG4gICAgICAgICAgICByYWRpYW5jZUNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uOiBWZWN0b3IsXG4gICAgICAgICAgICBwaG9uZ0NvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHBpeGVsQ29sb3I6IENvbG9yID0gbmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSksXG4gICAgICAgICAgICBsaWdodERpcmVjdGlvbjogVmVjdG9yLFxuICAgICAgICAgICAgbGlnaHRQb3dlcjogbnVtYmVyLFxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyOiBWZWN0b3IsXG4gICAgICAgICAgICBsYW1iQ29zOiBudW1iZXIsXG4gICAgICAgICAgICBwaG9uZ0NvczogbnVtYmVyLFxuICAgICAgICAgICAgcGhvbmc6IG51bWJlcjtcblxuICAgICAgICBmb3IgKGxldCBsaWdodCBvZiB0aGlzLnNjZW5lLmdldExpZ2h0cygpKSB7XG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0Wydvd25lclR5cGUnXSA9PT0gJ2xpZ2h0Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcnNlY3RbJ293bmVyJ11cbiAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxpZ2h0UG93ZXIgPSB0aGlzLmdldExpZ2h0UG93ZXIoaW50ZXJzZWN0LCBsaWdodCk7XG5cbiAgICAgICAgICAgIGxhbWJDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgcmFkaWFuY2VDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgcGhvbmdDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24gPSBWZWN0b3Iubm9ybWFsaXplZChcbiAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ3BvaW50J10sXG4gICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldFBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBsYW1iZXJ0XG5cbiAgICAgICAgICAgIGxhbWJDb3MgPSAtVmVjdG9yLmRvdChcbiAgICAgICAgICAgICAgICBsaWdodERpcmVjdGlvbixcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ25vcm1hbCddXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBsYW1iQ29sb3IgPSBsYW1iQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXVxuICAgICAgICAgICAgICAgICAgICAuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAubXVsdGlwbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodFBvd2VyICogbGFtYkNvcyAqIGludGVyc2VjdFsnb3duZXInXS5nZXRNYXRlcmlhbCgpLmdldExhbWJlcnRDb2VmZigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAocmVjdXJzaXZlKSB7XG4gICAgICAgICAgICAgICAgbGV0IHJhbmREaXIgPSAobm9ybWFsOiBWZWN0b3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRpcjogVmVjdG9yO1xuXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXIgPSBuZXcgVmVjdG9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucmFuZG9tKCkgLSAwLjUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5yYW5kb20oKSAtIDAuNSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpIC0gMC41XG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoVmVjdG9yLmRvdChkaXIsIGRpcikgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpciA9IFZlY3Rvci5ub3JtYWxpemVkKGRpcik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChWZWN0b3IuZG90KGRpciwgbm9ybWFsKSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXIgPSBWZWN0b3IuaW52ZXJzZShkaXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGlyO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvKmxldCB1MSA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdTIgPSBNYXRoLnJhbmRvbSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2luX3RoZXRhID0gTWF0aC5zcXJ0KHUxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb3NfdGhldGEgPSBNYXRoLnNxcnQoMSAtIHUxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0ICBwaGkgPSAyICogTWF0aC5QSSAqIHUyO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGlyOiBWZWN0b3IgPSBuZXcgVmVjdG9yKHNpbl90aGV0YSAqIE1hdGguQ29zKHBoaSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29zX3RoZXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbl90aGV0YSAqIE1hdGguU2luKHBoaSkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGFuZ2VudDogVmVjdG9yO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9ybWFsLnggPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbmdlbnQgPSBuZXcgVmVjdG9yKDEsIDAsIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YW5nZW50ID0gVmVjdG9yLm5vcm1hbGl6ZWQobmV3IFZlY3Rvcihub3JtYWwueiwgMCwgLW5vcm1hbC54KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBiaXRhbmdlbnQ6IFZlY3RvciA9IFZlY3Rvci5jcm9zcyh0YW5nZW50LCBub3JtYWwpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYmFzaXNUcmFuc2Zvcm0gPSBuZXcgTWF0cml4KHRhbmdlbnQsIG5vcm1hbCwgYml0YW5nZW50KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZlY3Rvci5ub3JtYWxpemVkKGJhc2lzVHJhbnNmb3JtICogZGlyKTsqL1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5naVNhbXBsZXM7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmFkaWFuY2VJblJhbmRvbURpcmVjdGlvbjogQ29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29zSTogbnVtYmVyO1xuXG4gICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uID0gcmFuZERpcihpbnRlcnNlY3RbJ293bmVyJ10uZ2V0Tm9ybWFsKGludGVyc2VjdFsncG9pbnQnXSkpO1xuICAgICAgICAgICAgICAgICAgICByYWRpYW5jZUluUmFuZG9tRGlyZWN0aW9uID0gdGhpcy5nZXRDb2xvcihcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBSYXkoaW50ZXJzZWN0Wydwb2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmFkaWFuY2VSYW5kb21EaXJlY3Rpb24pLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgY29zSSA9IFZlY3Rvci5kb3QoXG4gICAgICAgICAgICAgICAgICAgICAgICByYWRpYW5jZVJhbmRvbURpcmVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXS5nZXROb3JtYWwoaW50ZXJzZWN0Wydwb2ludCddKVxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlQ29sb3IgPSByYWRpYW5jZUNvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGl2aWRlKE1hdGguUEkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlSW5SYW5kb21EaXJlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGVkKGNvc0kpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gcGhvbmdcblxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyID0gVmVjdG9yLnJlZmxlY3QoXG4gICAgICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydub3JtYWwnXVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHBob25nQ29zID0gLVZlY3Rvci5kb3QocmVmbGVjdFBob25nVmVjdG9yRGlyLCByYXkuZ2V0RGlyZWN0aW9uKCkpO1xuXG4gICAgICAgICAgICBpZiAocGhvbmdDb3MgPiAwKSB7XG4gICAgICAgICAgICAgICAgcGhvbmcgPSBNYXRoLnBvdyhwaG9uZ0NvcywgMzUpO1xuICAgICAgICAgICAgICAgIHBob25nQ29sb3IgPSBwaG9uZ0NvbG9yLmFkZChcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydvd25lciddXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodFBvd2VyICogcGhvbmcgKiBpbnRlcnNlY3RbJ293bmVyJ10uZ2V0TWF0ZXJpYWwoKS5nZXRQaG9uZ0NvZWZmKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBpeGVsQ29sb3IgPSBwaXhlbENvbG9yLmFkZChsYW1iQ29sb3IuYWRkKHJhZGlhbmNlQ29sb3IuZGl2aWRlKHRoaXMuZ2lTYW1wbGVzKSkpLmFkZChwaG9uZ0NvbG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwaXhlbENvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVmbGVjdGlvbkNvbG9yIChyYXk6IFJheSwgaW50ZXJzZWN0OiBhbnkpOiBhbnkge1xuICAgICAgICBsZXQgcmVmbGVjdGlvbkNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJlZmxlY3Rpb25WYWx1ZTogbnVtYmVyID0gaW50ZXJzZWN0Wydvd25lciddLmdldE1hdGVyaWFsKCkuZ2V0UmVmbGVjdGlvblZhbHVlKCksXG4gICAgICAgICAgICByZWZsZWN0ZWRSYXk6IFZlY3RvcjtcblxuICAgICAgICByYXkuc2V0SXRlcmF0aW9uKHJheS5nZXRJdGVyYXRpb24oKSAtIDEpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHJheS5nZXRJdGVyYXRpb24oKSA9PT0gMCB8fFxuICAgICAgICAgICAgcmVmbGVjdGlvblZhbHVlID09PSAwXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVmbGVjdGVkUmF5ID0gVmVjdG9yLnJlZmxlY3QoXG4gICAgICAgICAgICByYXkuZ2V0RGlyZWN0aW9uKCksXG4gICAgICAgICAgICBpbnRlcnNlY3RbJ25vcm1hbCddXG4gICAgICAgICk7XG5cbiAgICAgICAgcmVmbGVjdGlvbkNvbG9yID0gdGhpcy5nZXRDb2xvcihcbiAgICAgICAgICAgIG5ldyBSYXkoaW50ZXJzZWN0Wydwb2ludCddLCByZWZsZWN0ZWRSYXksIHJheS5nZXRJdGVyYXRpb24oKSlcbiAgICAgICAgKS5zY2FsZWQocmVmbGVjdGlvblZhbHVlKTtcblxuICAgICAgICByZXR1cm4gcmVmbGVjdGlvbkNvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UGVyc3BlY3RpdmVWZWN0b3IgKHg6IG51bWJlciwgeTogbnVtYmVyLCBzY3JlZW5XaWR0aDogbnVtYmVyLCBzY3JlZW5IZWlnaHQ6IG51bWJlcikge1xuICAgICAgICBsZXQgY2FtZXJhOiBDYW1lcmEgPSB0aGlzLnNjZW5lLmdldENhbWVyYSgpO1xuXG4gICAgICAgIHJldHVybiBWZWN0b3Iubm9ybWFsaXplZChcbiAgICAgICAgICAgIFZlY3Rvci5hZGQoXG4gICAgICAgICAgICAgICAgY2FtZXJhLmdldEZvcndhcmRWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICBWZWN0b3IuYWRkKFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc2NhbGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLmdldFJpZ2h0VmVjdG9yKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEucmVjZW50ZXJYKHgpXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEuZ2V0VXBWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5yZWNlbnRlclkoeSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldExpZ2h0UG93ZXIgKGludGVyc2VjdDogYW55LCBsaWdodDogQWJzdHJhY3RMaWdodCk6IG51bWJlciB7XG4gICAgICAgIGxldCBsaWdodFBvd2VyID0gbGlnaHQuZ2V0UG93ZXIoKSxcbiAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnQ6IFZlY3RvcixcbiAgICAgICAgICAgIHJlc3VsdFBvd2VyOiBudW1iZXIgPSAwO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaGFkb3dTYW1wbGVzOyBpKyspIHtcbiAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnQgPSBsaWdodC5nZXRSYW5kb21Qb2ludCgpO1xuXG4gICAgICAgICAgICBsZXQgbGlnaHRSYXkgPSB0aGlzLnRyYWNlKFxuICAgICAgICAgICAgICAgIG5ldyBSYXkoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsncG9pbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50XG4gICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydwb2ludCddXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAobGlnaHRSYXlbJ3BvaW50J10gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGxpZ2h0UmF5Wydvd25lciddICE9PSBsaWdodCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXN1bHRQb3dlciArPSAoXG4gICAgICAgICAgICAgICAgbGlnaHRQb3dlciAtXG4gICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ3BvaW50J11cbiAgICAgICAgICAgICAgICAgICAgKS5nZXRMZW5ndGgoKSAqIChsaWdodFBvd2VyIC8gbGlnaHQuZ2V0RmFkZVJhZGl1cygpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkgLyB0aGlzLnNoYWRvd1NhbXBsZXM7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0UG93ZXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmFjZSAocmF5OiBSYXkpOiB7ZGlzdGFuY2U6IG51bWJlciwgcG9pbnQ6IFZlY3Rvciwgb3duZXI6IGFueSwgb3duZXJUeXBlOiBzdHJpbmd9IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBkaXN0YW5jZTogMCxcbiAgICAgICAgICAgICAgICBwb2ludDogbnVsbCxcbiAgICAgICAgICAgICAgICBub3JtYWw6IG51bGwsXG4gICAgICAgICAgICAgICAgb3duZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgb3duZXJUeXBlOiBudWxsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW50ZXJzZWN0RGF0YTogYW55LFxuICAgICAgICAgICAgc2NlbmVPYmplY3RzV2l0aExpZ2h0czogYW55W10gPSB0aGlzLnNjZW5lLmdldE9iamVjdHMoKS5jb25jYXQodGhpcy5zY2VuZS5nZXRMaWdodHMoKSk7XG5cbiAgICAgICAgZm9yIChsZXQgb2JqZWN0IG9mIHNjZW5lT2JqZWN0c1dpdGhMaWdodHMpIHtcbiAgICAgICAgICAgIGludGVyc2VjdERhdGEgPSBvYmplY3QuZ2V0SW50ZXJzZWN0RGF0YShyYXkpO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0RGF0YSAmJlxuICAgICAgICAgICAgICAgIGludGVyc2VjdERhdGFbJ2Rpc3RhbmNlJ10gPiAwICYmXG4gICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRbJ293bmVyJ10gPT09IG51bGwgfHxcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXSA8IHJlc3VsdFsnZGlzdGFuY2UnXVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHJlc3VsdFsnZGlzdGFuY2UnXSA9IGludGVyc2VjdERhdGFbJ2Rpc3RhbmNlJ107XG4gICAgICAgICAgICAgICAgcmVzdWx0Wydwb2ludCddID0gaW50ZXJzZWN0RGF0YVsncG9pbnQnXTtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ293bmVyJ10gPSBvYmplY3Q7XG4gICAgICAgICAgICAgICAgcmVzdWx0Wydvd25lclR5cGUnXSA9IG9iamVjdC5nZXRUeXBlKCk7XG4gICAgICAgICAgICAgICAgcmVzdWx0Wydub3JtYWwnXSA9IHJlc3VsdFsnb3duZXInXS5nZXROb3JtYWwocmVzdWx0Wydwb2ludCddKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlciAoc2NyZWVuV2lkdGg6IG51bWJlciwgc2NyZWVuSGVpZ2h0OiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHJhbmRvTXVsdGlwbGllciA9IDAuNTtcblxuICAgICAgICBsZXQgY29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcmFuZDogbnVtYmVyLFxuICAgICAgICAgICAgcmF5OiBSYXksXG4gICAgICAgICAgICByZ2JDb2xvcjoge1xuICAgICAgICAgICAgICAgIHJlZDogbnVtYmVyLFxuICAgICAgICAgICAgICAgIGdyZWVuOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgYmx1ZTogbnVtYmVyXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuc2NyZWVuV2lkdGggPSBzY3JlZW5XaWR0aDtcbiAgICAgICAgdGhpcy5zY3JlZW5IZWlnaHQgPSBzY3JlZW5IZWlnaHQ7XG5cbiAgICAgICAgY29sb3IgPSBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcblxuICAgICAgICBmb3IgKGxldCBpdGVyID0gMDsgaXRlciA8IHRoaXMucGl4ZWxTYW1wbGVzOyBpdGVyKyspIHtcbiAgICAgICAgICAgIHJhbmQgPSAwO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5waXhlbFNhbXBsZXMgPiAxKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZXIgJSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmQgKz0gTWF0aC5yYW5kb20oKSAqIHJhbmRvTXVsdGlwbGllcjtcbiAgICAgICAgICAgICAgICB9ICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZCAtPSBNYXRoLnJhbmRvbSgpICogcmFuZG9NdWx0aXBsaWVyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmF5ID0gbmV3IFJheShcbiAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLmdldENhbWVyYSgpLmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRQZXJzcGVjdGl2ZVZlY3Rvcih4ICsgcmFuZCwgeSArIHJhbmQsIHNjcmVlbldpZHRoLCBzY3JlZW5IZWlnaHQpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb2xvciA9IGNvbG9yLmFkZCh0aGlzLmdldENvbG9yKHJheSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29sb3IgPSBjb2xvci5kaXZpZGUodGhpcy5waXhlbFNhbXBsZXMpO1xuXG4gICAgICAgIGZvciAobGV0IGNvbXBvbmVudCBpbiBjb2xvcikge1xuICAgICAgICAgICAgY29sb3JbY29tcG9uZW50XSA9IENvbG9yLnNSR0JFbmNvZGUoY29sb3JbY29tcG9uZW50XSk7XG4gICAgICAgIH1cblxuICAgICAgICByZ2JDb2xvciA9IENvbG9yLnRvUkdCKGNvbG9yKTtcblxuICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKFt4LCB5LCByZ2JDb2xvci5yZWQsIHJnYkNvbG9yLmdyZWVuLCByZ2JDb2xvci5ibHVlXSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFNjZW5lIChzY2VuZTogU2NlbmUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xuICAgIH1cbn1cblxub25tZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICB2YXIgZGF0YSA9IG1lc3NhZ2UuZGF0YTtcblxuICAgIGlmICh0eXBlb2YoZGF0YSkgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoJ1snK2RhdGErJ10nKTtcbiAgICB9XG5cbiAgICBsZXQgdHJhY2VyID0gbmV3IFRyYWNlcigpO1xuXG4gICAgdHJhY2VyLnNldFNjZW5lKFxuICAgICAgICBuZXcgU2NlbmUoe1xuICAgICAgICAgICAgY2FtZXJhOiBuZXcgQ2FtZXJhKFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoMCwgMCwgLTY5OSksXG4gICAgICAgICAgICAgICAgbmV3IFZlY3RvcigwLCAwLCAxKSxcbiAgICAgICAgICAgICAgICBkYXRhWzBdLFxuICAgICAgICAgICAgICAgIGRhdGFbMV1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBsaWdodHM6IFtcbiAgICAgICAgICAgICAgICBuZXcgU3BoZXJpY2FsTGlnaHQobmV3IFZlY3RvciAoMCwgNjQwLCAwKSwgMS4yLCA1MClcbiAgICAgICAgICAgICAgICAgICAgLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDI1NSwgMjU1LCAyNTUpKSkpXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgb2JqZWN0czogW1xuICAgICAgICAgICAgICAgIC8vbmV3IFBsYW5lKG5ldyBWZWN0b3IoMCwgMSwgMCksIC00MDApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDExNSwgMTE1LCAxMTUpKSwgMCkpLFxuICAgICAgICAgICAgICAgIC8vIGJvdHRvbSBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIDcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDI1NSwgMjU1LCAyNTUpKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvLyBmcm9udCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjU1LCAyNTUsIDI1NSkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vIHRvcCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCAtNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjU1LCAyNTUsIDI1NSkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vcmlnaHQgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIDcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDI1NSkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vbGVmdCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgLTcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDI1NSwgMCwgMCkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vIGJhY2sgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIC03MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgbmV3IFNwaGVyZShuZXcgVmVjdG9yKC0yNTAsIC01MDAsIDQ1MCksIDIwMClcbiAgICAgICAgICAgICAgICAgICAgLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKSwgMSkpLFxuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmUobmV3IFZlY3RvcigyNTAsIC01MDAsIDQwMCksIDIwMClcbiAgICAgICAgICAgICAgICAgICAgLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDI1NSwgMCkpLCAwKSlcbiAgICAgICAgICAgIF1cbiAgICAgICAgfSlcbiAgICApO1xuXG4gICAgdHJhY2VyLnJlbmRlcihkYXRhWzBdLCBkYXRhWzFdLCBkYXRhWzJdLCBkYXRhWzNdKTtcbn07Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
