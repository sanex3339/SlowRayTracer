var AbstractLight_1=require("./Lights/AbstractLight"),Camera_1=require("./Camera"),Color_1=require("./Color/Color"),IntersectPoint_1=require("./IntersectPoint"),Material_1=require("./Material"),Plane_1=require("./Objects/Plane"),Ray_1=require("./Ray"),RGBColor_1=require("./Color/RGBColor"),Scene_1=require("./Scene"),Sphere_1=require("./Objects/Sphere"),SphericalLight_1=require("./Lights/SphericalLight"),Vector_1=require("./Vector"),Tracer=function(){function e(){this.buffer=[],this.screenWidth=250,this.screenHeight=250;for(var e=0;e<this.screenWidth*this.screenHeight*3;e++)this.buffer.push(Color_1.Color.black)}return e.prototype.cosineSampleHemisphere=function(e){var t,r,o=Math.random(),a=Math.random(),n=Math.sqrt(o),c=2*Math.PI*a;return t=Math.abs(e.getCoordinates().x)<.5?Vector_1.Vector.cross(e,new Vector_1.Vector(1,0,0)):Vector_1.Vector.cross(e,new Vector_1.Vector(0,1,0)),r=Vector_1.Vector.cross(e,t),Vector_1.Vector.add(Vector_1.Vector.scale(e,Math.sqrt(1-o)),Vector_1.Vector.add(Vector_1.Vector.scale(t,n*Math.cos(c)),Vector_1.Vector.scale(r,n*Math.sin(c))))},e.prototype.getColor=function(e){var t=this.trace(e),r=Color_1.Color.black,o=Color_1.Color.black,a=e.getIteration();return e.setIteration(--a),0===a?Color_1.Color.black:t.getIntersect()?(r=this.getDiffuseColor(e,t),o=this.getReflectionColor(e,t),r.add(o)):Color_1.Color.black},e.prototype.getDiffuseColor=function(e,t,r){void 0===r&&(r=!0);for(var o,a,n,c,i,l,s,g,_,h,V=Color_1.Color.black,C=0,w=this.scene.getLights();C<w.length;C++){var f=w[C];if(t.getOwner()instanceof AbstractLight_1.AbstractLight)return t.getOwner().getMaterial().getColor();l=this.getLightPower(t,f),o=Color_1.Color.black,a=Color_1.Color.black,n=Color_1.Color.black,i=Vector_1.Vector.normalize(Vector_1.Vector.substract(t.getHitPoint(),f.getPosition()));var u=void 0;c=this.cosineSampleHemisphere(t.getOwner().getNormal(t.getHitPoint())),u=this.getColor(new Ray_1.Ray(t.getHitPoint(),c,e.getIteration())),n=n.add(u),g=-Vector_1.Vector.dot(i,t.getNormal()),o=o.add(t.getOwner().getMaterial().getColor().multiple(f.getMaterial().getColor().scaled(l*g).add(n.divide(Math.PI)))),s=Vector_1.Vector.reflect(i,t.getNormal()),_=-Vector_1.Vector.dot(s,e.getDirection()),_>0&&(h=Math.pow(_,35),a=a.add(t.getOwner().getMaterial().getColor().multiple(f.getMaterial().getColor().scaled(l*h*t.getOwner().getMaterial().getPhongCoeff())))),V=V.add(o.add(a))}return V},e.prototype.getReflectionColor=function(e,t){var r,o,a=t.getOwner().getMaterial().getReflectionValue();return 0===a?Color_1.Color.black:(o=Vector_1.Vector.reflect(e.getDirection(),t.getNormal()),r=this.getColor(new Ray_1.Ray(t.getHitPoint(),o,e.getIteration())).scaled(a))},e.prototype.getPerspectiveVector=function(e,t){var r=this.scene.getCamera();return Vector_1.Vector.normalize(Vector_1.Vector.add(r.getForwardVector(),Vector_1.Vector.add(Vector_1.Vector.scale(r.getRightVector(),r.recenterX(e)),Vector_1.Vector.scale(r.getUpVector(),r.recenterY(t)))))},e.prototype.getLightPower=function(e,t){var r,o,a=t.getPower(),n=0;return r=t.getRandomPoint(),o=this.trace(new Ray_1.Ray(e.getHitPoint(),Vector_1.Vector.substract(Vector_1.Vector.substract(t.getPosition(),r),e.getHitPoint()))),o.getIntersect()&&o.getOwner()instanceof AbstractLight_1.AbstractLight&&(n+=a-Vector_1.Vector.substract(Vector_1.Vector.substract(t.getPosition(),r),e.getHitPoint()).getLength()*(a/t.getFadeRadius())),n},e.prototype.trace=function(e){for(var t,r=new IntersectPoint_1.IntersectPoint,o=1/0,a=this.scene.getObjects().concat(this.scene.getLights()),n=0,c=a;n<c.length;n++){var i=c[n];t=i.getIntersectData(e),t&&t.distance<o&&(o=t.distance,r.setIntersect(),r.setHitPoint(t.hitPoint),r.setNormal(t.normal),r.setDistanceFromOrigin(t.distance),r.setOwner(i))}return r},e.prototype.render=function(e,t){var r,o,a,n=.5;for(this.screenWidth=e,this.screenHeight=t;;){r=[];for(var c=0;1>c;c++)for(var i=0,l=0;l<this.screenHeight;l++)for(var s=0;s<this.screenWidth;s++){o=0,Math.random()>.5?o+=Math.random()*n:o-=Math.random()*n,a=new Ray_1.Ray(this.scene.getCamera().getPosition(),this.getPerspectiveVector(s+o,l+o)),this.buffer[i]=Color_1.Color.black.add(this.getColor(a));for(var g in this.buffer[i].getColor())this.buffer[i][g]=Color_1.Color.sRGBEncode(this.buffer[i][g]);r.push(this.buffer[i].getColor().red),r.push(this.buffer[i].getColor().green),r.push(this.buffer[i].getColor().blue),i++}for(var i=0;i<this.buffer.length;i++)this.buffer[i].getColor().red=0,this.buffer[i].getColor().green=0,this.buffer[i].getColor().blue=0;self.postMessage(r)}},e.prototype.setScene=function(e){this.scene=e},e}();onmessage=function(e){var t=e.data;"string"==typeof t&&(t=JSON.parse("["+t+"]"));var r=new Tracer;r.setScene(new Scene_1.Scene({camera:new Camera_1.Camera(new Vector_1.Vector(0,0,-699),new Vector_1.Vector(0,0,1),t[0],t[1]),lights:[new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,600,0),1,100).setMaterial(new Material_1.Material(Color_1.Color.white)),new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,0,0),.6,150).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,235,200))))],objects:[new Plane_1.Plane(new Vector_1.Vector(0,1,0),new Vector_1.Vector(0,-700,0)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(191.25,191.25,191.25)),0)),new Plane_1.Plane(new Vector_1.Vector(0,-1,0),new Vector_1.Vector(0,700,0)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(191.25,191.25,191.25)),0)),new Plane_1.Plane(new Vector_1.Vector(-1,0,0),new Vector_1.Vector(700,0,0)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(63.75,63.75,191.25)),0)),new Plane_1.Plane(new Vector_1.Vector(1,0,0),new Vector_1.Vector(-700,0,0)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(191.25,63.75,63.75)),0)),new Plane_1.Plane(new Vector_1.Vector(0,0,-1),new Vector_1.Vector(0,0,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(191.25,191.25,191.25)),0)),new Plane_1.Plane(new Vector_1.Vector(0,0,1),new Vector_1.Vector(0,0,-700)).setMaterial(new Material_1.Material(Color_1.Color.black,0)),new Sphere_1.Sphere(new Vector_1.Vector(-250,-500,450),200).setMaterial(new Material_1.Material(Color_1.Color.black,1)),new Sphere_1.Sphere(new Vector_1.Vector(250,-500,400),200).setMaterial(new Material_1.Material(Color_1.Color.green,0))]})),r.render(t[0],t[1])};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRyYWNlcldvcmtlci50cyJdLCJuYW1lcyI6WyJBYnN0cmFjdExpZ2h0XzEiLCJyZXF1aXJlIiwiQ2FtZXJhXzEiLCJDb2xvcl8xIiwiSW50ZXJzZWN0UG9pbnRfMSIsIk1hdGVyaWFsXzEiLCJQbGFuZV8xIiwiUmF5XzEiLCJSR0JDb2xvcl8xIiwiU2NlbmVfMSIsIlNwaGVyZV8xIiwiU3BoZXJpY2FsTGlnaHRfMSIsIlZlY3Rvcl8xIiwiVHJhY2VyIiwiVHJhY2VyLmNvbnN0cnVjdG9yIiwiVHJhY2VyLmNvc2luZVNhbXBsZUhlbWlzcGhlcmUiLCJUcmFjZXIuZ2V0Q29sb3IiLCJUcmFjZXIuZ2V0RGlmZnVzZUNvbG9yIiwiVHJhY2VyLmdldFJlZmxlY3Rpb25Db2xvciIsIlRyYWNlci5nZXRQZXJzcGVjdGl2ZVZlY3RvciIsIlRyYWNlci5nZXRMaWdodFBvd2VyIiwiVHJhY2VyLnRyYWNlIiwiVHJhY2VyLnJlbmRlciIsIlRyYWNlci5zZXRTY2VuZSIsIm9ubWVzc2FnZSIsIm1lc3NhZ2UiLCJkYXRhIiwiSlNPTiIsInBhcnNlIiwidHJhY2VyIiwic2V0U2NlbmUiLCJTY2VuZSIsImNhbWVyYSIsIkNhbWVyYSIsIlZlY3RvciIsImxpZ2h0cyIsIlNwaGVyaWNhbExpZ2h0Iiwic2V0TWF0ZXJpYWwiLCJNYXRlcmlhbCIsIkNvbG9yIiwid2hpdGUiLCJSR0JDb2xvciIsIm9iamVjdHMiLCJQbGFuZSIsImJsYWNrIiwiU3BoZXJlIiwiZ3JlZW4iLCJyZW5kZXIiXSwibWFwcGluZ3MiOiJBQUdBLEdBQUFBLGlCQUFBQyxRQUE4QiwwQkFFOUJDLFNBQUFELFFBQXVCLFlBQ3ZCRSxRQUFBRixRQUFzQixpQkFDdEJHLGlCQUFBSCxRQUErQixvQkFDL0JJLFdBQUFKLFFBQXlCLGNBQ3pCSyxRQUFBTCxRQUFzQixtQkFFdEJNLE1BQUFOLFFBQW9CLFNBQ3BCTyxXQUFBUCxRQUF5QixvQkFFekJRLFFBQUFSLFFBQXNCLFdBQ3RCUyxTQUFBVCxRQUF1QixvQkFDdkJV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V29ya2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9XCJ0cnVlXCIvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cImxpYi9saWIud2Vid29ya2VyLmQudHNcIiAvPlxuXG5pbXBvcnQgeyBBYnN0cmFjdExpZ2h0IH0gZnJvbSBcIi4vTGlnaHRzL0Fic3RyYWN0TGlnaHRcIjtcbmltcG9ydCB7IEFic3RyYWN0T2JqZWN0IH0gZnJvbSBcIi4vT2JqZWN0cy9BYnN0cmFjdE9iamVjdFwiO1xuaW1wb3J0IHsgQ2FtZXJhIH0gZnJvbSBcIi4vQ2FtZXJhXCI7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gXCIuL0NvbG9yL0NvbG9yXCI7XG5pbXBvcnQgeyBJbnRlcnNlY3RQb2ludCB9IGZyb20gXCIuL0ludGVyc2VjdFBvaW50XCI7XG5pbXBvcnQgeyBNYXRlcmlhbCB9IGZyb20gXCIuL01hdGVyaWFsXCI7XG5pbXBvcnQgeyBQbGFuZSB9IGZyb20gXCIuL09iamVjdHMvUGxhbmVcIjtcbmltcG9ydCB7IFBvbHlnb24gfSBmcm9tIFwiLi9PYmplY3RzL1BvbHlnb25cIjtcbmltcG9ydCB7IFJheSB9IGZyb20gXCIuL1JheVwiO1xuaW1wb3J0IHsgUkdCQ29sb3IgfSBmcm9tIFwiLi9Db2xvci9SR0JDb2xvclwiO1xuaW1wb3J0IHsgUlRNYXRoIH0gZnJvbSBcIi4vUlRNYXRoXCI7XG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XG5pbXBvcnQgeyBTcGhlcmUgfSBmcm9tIFwiLi9PYmplY3RzL1NwaGVyZVwiO1xuaW1wb3J0IHsgU3BoZXJpY2FsTGlnaHQgfSBmcm9tIFwiLi9MaWdodHMvU3BoZXJpY2FsTGlnaHRcIjtcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gXCIuL1ZlY3RvclwiO1xuXG5jbGFzcyBUcmFjZXIge1xuICAgIHByaXZhdGUgYnVmZmVyOiBDb2xvcltdID0gW107XG4gICAgcHJpdmF0ZSBzY2VuZTogU2NlbmU7XG4gICAgcHJpdmF0ZSBzY3JlZW5XaWR0aDogbnVtYmVyID0gMjUwO1xuICAgIHByaXZhdGUgc2NyZWVuSGVpZ2h0OiBudW1iZXIgPSAyNTA7XG5cbiAgICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zY3JlZW5XaWR0aCAqIHRoaXMuc2NyZWVuSGVpZ2h0ICogMzsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmJ1ZmZlci5wdXNoKENvbG9yLmJsYWNrKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY29zaW5lU2FtcGxlSGVtaXNwaGVyZSAobm9ybWFsOiBWZWN0b3IpOiBWZWN0b3Ige1xuICAgICAgICBsZXQgdSA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgIGxldCB2ID0gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgbGV0IHIgPSBNYXRoLnNxcnQodSk7XG4gICAgICAgIGxldCBhbmdsZSA9IDIgKiBNYXRoLlBJICogdjtcblxuICAgICAgICBsZXQgc2RpcixcbiAgICAgICAgICAgIHRkaXI7XG5cbiAgICAgICAgaWYgKE1hdGguYWJzKG5vcm1hbC5nZXRDb29yZGluYXRlcygpWyd4J10pIDwgMC41KSB7XG4gICAgICAgICAgICBzZGlyID0gVmVjdG9yLmNyb3NzKG5vcm1hbCwgbmV3IFZlY3RvcigxLDAsMCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2RpciA9IFZlY3Rvci5jcm9zcyhub3JtYWwsIG5ldyBWZWN0b3IoMCwxLDApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRkaXIgPSBWZWN0b3IuY3Jvc3Mobm9ybWFsLCBzZGlyKTtcblxuICAgICAgICByZXR1cm4gVmVjdG9yLmFkZChcbiAgICAgICAgICAgIFZlY3Rvci5zY2FsZShub3JtYWwsICBNYXRoLnNxcnQoMSAtIHUpKSxcbiAgICAgICAgICAgIFZlY3Rvci5hZGQoXG4gICAgICAgICAgICAgICAgVmVjdG9yLnNjYWxlKHNkaXIsIHIgKiBNYXRoLmNvcyhhbmdsZSkpLFxuICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZSh0ZGlyLCByICogTWF0aC5zaW4oYW5nbGUpKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Q29sb3IgKHJheTogUmF5KTogQ29sb3Ige1xuICAgICAgICBsZXQgaW50ZXJzZWN0aW9uID0gdGhpcy50cmFjZShyYXkpLFxuICAgICAgICAgICAgZGlmZnVzZUNvbG9yOiBDb2xvciA9IENvbG9yLmJsYWNrLFxuICAgICAgICAgICAgcmVmbGVjdENvbG9yOiBDb2xvciA9IENvbG9yLmJsYWNrLFxuICAgICAgICAgICAgcmF5SXRlcmF0aW9uOiBudW1iZXIgPSByYXkuZ2V0SXRlcmF0aW9uKCk7XG5cbiAgICAgICAgcmF5LnNldEl0ZXJhdGlvbigtLXJheUl0ZXJhdGlvbik7XG5cbiAgICAgICAgaWYgKHJheUl0ZXJhdGlvbiA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIENvbG9yLmJsYWNrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpbnRlcnNlY3Rpb24uZ2V0SW50ZXJzZWN0KCkpIHtcbiAgICAgICAgICAgIHJldHVybiBDb2xvci5ibGFjaztcbiAgICAgICAgfVxuXG4gICAgICAgIGRpZmZ1c2VDb2xvciA9IHRoaXMuZ2V0RGlmZnVzZUNvbG9yKHJheSwgaW50ZXJzZWN0aW9uKTtcbiAgICAgICAgcmVmbGVjdENvbG9yID0gdGhpcy5nZXRSZWZsZWN0aW9uQ29sb3IocmF5LCBpbnRlcnNlY3Rpb24pO1xuXG4gICAgICAgIHJldHVybiBkaWZmdXNlQ29sb3IuYWRkKHJlZmxlY3RDb2xvcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREaWZmdXNlQ29sb3IgKHJheTogUmF5LCBpbnRlcnNlY3Q6IGFueSwgcmVjdXJzaXZlOiBib29sZWFuID0gdHJ1ZSk6IENvbG9yIHtcbiAgICAgICAgbGV0IGxhbWJDb2xvcjogQ29sb3IsXG4gICAgICAgICAgICBwaG9uZ0NvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJhZGlhbmNlQ29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcGl4ZWxDb2xvcjogQ29sb3IgPSBDb2xvci5ibGFjayxcbiAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uOiBWZWN0b3IsXG4gICAgICAgICAgICBsaWdodERpcmVjdGlvbjogVmVjdG9yLFxuICAgICAgICAgICAgbGlnaHRQb3dlcjogbnVtYmVyLFxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyOiBWZWN0b3IsXG4gICAgICAgICAgICBsYW1iQ29zOiBudW1iZXIsXG4gICAgICAgICAgICBwaG9uZ0NvczogbnVtYmVyLFxuICAgICAgICAgICAgcGhvbmc6IG51bWJlcjtcblxuICAgICAgICBmb3IgKGxldCBsaWdodCBvZiB0aGlzLnNjZW5lLmdldExpZ2h0cygpKSB7XG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0LmdldE93bmVyKCkgaW5zdGFuY2VvZiBBYnN0cmFjdExpZ2h0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGludGVyc2VjdC5nZXRPd25lcigpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaWdodFBvd2VyID0gdGhpcy5nZXRMaWdodFBvd2VyKGludGVyc2VjdCwgbGlnaHQpO1xuXG4gICAgICAgICAgICBsYW1iQ29sb3IgPSBDb2xvci5ibGFjaztcbiAgICAgICAgICAgIHBob25nQ29sb3IgPSBDb2xvci5ibGFjaztcbiAgICAgICAgICAgIHJhZGlhbmNlQ29sb3IgPSBDb2xvci5ibGFjaztcblxuICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24gPSBWZWN0b3Iubm9ybWFsaXplKFxuICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXRIaXRQb2ludCgpLFxuICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuXG5cbiAgICAgICAgICAgIC8vZ2lcbiAgICAgICAgICAgIGxldCByYWRpYW5jZUluUmFuZG9tRGlyZWN0aW9uOiBDb2xvcjtcblxuICAgICAgICAgICAgcmFkaWFuY2VSYW5kb21EaXJlY3Rpb24gPSB0aGlzLmNvc2luZVNhbXBsZUhlbWlzcGhlcmUoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldE93bmVyKCkuZ2V0Tm9ybWFsKGludGVyc2VjdC5nZXRIaXRQb2ludCgpKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgcmFkaWFuY2VJblJhbmRvbURpcmVjdGlvbiA9IHRoaXMuZ2V0Q29sb3IoXG4gICAgICAgICAgICAgICAgbmV3IFJheShcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldEhpdFBvaW50KCksXG4gICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICByYXkuZ2V0SXRlcmF0aW9uKClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICByYWRpYW5jZUNvbG9yID0gcmFkaWFuY2VDb2xvclxuICAgICAgICAgICAgICAgIC5hZGQocmFkaWFuY2VJblJhbmRvbURpcmVjdGlvbik7XG5cblxuXG4gICAgICAgICAgICAvLyBsYW1iZXJ0XG5cbiAgICAgICAgICAgIGxhbWJDb3MgPSAtVmVjdG9yLmRvdChcbiAgICAgICAgICAgICAgICBsaWdodERpcmVjdGlvbixcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0Tm9ybWFsKClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGxhbWJDb2xvciA9IGxhbWJDb2xvci5hZGQoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0XG4gICAgICAgICAgICAgICAgICAgIC5nZXRPd25lcigpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgIC5tdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UG93ZXIgKiBsYW1iQ29zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGQocmFkaWFuY2VDb2xvci5kaXZpZGUoTWF0aC5QSSkpXG5cbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuXG5cbiAgICAgICAgICAgIC8vIHBob25nXG5cbiAgICAgICAgICAgIHJlZmxlY3RQaG9uZ1ZlY3RvckRpciA9IFZlY3Rvci5yZWZsZWN0KFxuICAgICAgICAgICAgICAgIGxpZ2h0RGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXROb3JtYWwoKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHBob25nQ29zID0gLVZlY3Rvci5kb3QocmVmbGVjdFBob25nVmVjdG9yRGlyLCByYXkuZ2V0RGlyZWN0aW9uKCkpO1xuXG4gICAgICAgICAgICBpZiAocGhvbmdDb3MgPiAwKSB7XG4gICAgICAgICAgICAgICAgcGhvbmcgPSBNYXRoLnBvdyhwaG9uZ0NvcywgMzUpO1xuICAgICAgICAgICAgICAgIHBob25nQ29sb3IgPSBwaG9uZ0NvbG9yLmFkZChcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldE93bmVyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm11bHRpcGxlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNjYWxlZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UG93ZXIgKiBwaG9uZyAqIGludGVyc2VjdC5nZXRPd25lcigpLmdldE1hdGVyaWFsKCkuZ2V0UGhvbmdDb2VmZigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL2FtYmllbnQgb2NjbHVzaW9uXG4gICAgICAgICAgICAvKmxldCBjID0gMDtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFvU2FtcGxlczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGRpciA9IHRoaXMuY29zaW5lU2FtcGxlSGVtaXNwaGVyZShpbnRlcnNlY3QuZ2V0T3duZXIoKS5nZXROb3JtYWwoaW50ZXJzZWN0LmdldEhpdFBvaW50KCkpKTtcblxuICAgICAgICAgICAgICAgIGxldCBhb0ludGVyc2VjdCA9IHRoaXMudHJhY2UoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBSYXkoXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0SGl0UG9pbnQoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpclxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIGlmICghYW9JbnRlcnNlY3QuZ2V0SW50ZXJzZWN0KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGFvSW50ZXJzZWN0LmdldERpc3RhbmNlRnJvbU9yaWdpbigpID4gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGMrKztcbiAgICAgICAgICAgIH0qL1xuXG4gICAgICAgICAgICAvKnBpeGVsQ29sb3IgPSBwaXhlbENvbG9yLmFkZChcbiAgICAgICAgICAgICAgICBsYW1iQ29sb3IubXVsdGlwbGUoQ29sb3Iud2hpdGUuc2NhbGVkKDEgLSAoYyAqIDAuNjcgLyB0aGlzLmFvU2FtcGxlcykpKS5hZGQocGhvbmdDb2xvcilcbiAgICAgICAgICAgICk7Ki9cblxuICAgICAgICAgICAgcGl4ZWxDb2xvciA9IHBpeGVsQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgIGxhbWJDb2xvci5hZGQocGhvbmdDb2xvcilcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcGl4ZWxDb2xvcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFJlZmxlY3Rpb25Db2xvciAocmF5OiBSYXksIGludGVyc2VjdDogYW55KTogYW55IHtcbiAgICAgICAgbGV0IHJlZmxlY3Rpb25Db2xvcjogQ29sb3IsXG4gICAgICAgICAgICByZWZsZWN0aW9uVmFsdWU6IG51bWJlciA9IGludGVyc2VjdC5nZXRPd25lcigpLmdldE1hdGVyaWFsKCkuZ2V0UmVmbGVjdGlvblZhbHVlKCksXG4gICAgICAgICAgICByZWZsZWN0ZWRSYXk6IFZlY3RvcjtcblxuICAgICAgICBpZiAocmVmbGVjdGlvblZhbHVlID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29sb3IuYmxhY2s7XG4gICAgICAgIH1cblxuICAgICAgICByZWZsZWN0ZWRSYXkgPSBWZWN0b3IucmVmbGVjdChcbiAgICAgICAgICAgIHJheS5nZXREaXJlY3Rpb24oKSxcbiAgICAgICAgICAgIGludGVyc2VjdC5nZXROb3JtYWwoKVxuICAgICAgICApO1xuXG4gICAgICAgIHJlZmxlY3Rpb25Db2xvciA9IHRoaXMuZ2V0Q29sb3IoXG4gICAgICAgICAgICBuZXcgUmF5KGludGVyc2VjdC5nZXRIaXRQb2ludCgpLCByZWZsZWN0ZWRSYXksIHJheS5nZXRJdGVyYXRpb24oKSlcbiAgICAgICAgKS5zY2FsZWQocmVmbGVjdGlvblZhbHVlKTtcblxuICAgICAgICByZXR1cm4gcmVmbGVjdGlvbkNvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UGVyc3BlY3RpdmVWZWN0b3IgKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICAgIGxldCBjYW1lcmE6IENhbWVyYSA9IHRoaXMuc2NlbmUuZ2V0Q2FtZXJhKCk7XG5cbiAgICAgICAgcmV0dXJuIFZlY3Rvci5ub3JtYWxpemUoXG4gICAgICAgICAgICBWZWN0b3IuYWRkKFxuICAgICAgICAgICAgICAgIGNhbWVyYS5nZXRGb3J3YXJkVmVjdG9yKCksXG4gICAgICAgICAgICAgICAgVmVjdG9yLmFkZChcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnNjYWxlKFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLmdldFJpZ2h0VmVjdG9yKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEucmVjZW50ZXJYKHgpXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5nZXRVcFZlY3RvcigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLnJlY2VudGVyWSh5KVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TGlnaHRQb3dlciAoaW50ZXJzZWN0OiBhbnksIGxpZ2h0OiBBYnN0cmFjdExpZ2h0KTogbnVtYmVyIHtcbiAgICAgICAgbGV0IGxpZ2h0UG93ZXIgPSBsaWdodC5nZXRQb3dlcigpLFxuICAgICAgICAgICAgbGlnaHRSYW5kb21Qb2ludDogVmVjdG9yLFxuICAgICAgICAgICAgc2hhZG93UmF5OiBJbnRlcnNlY3RQb2ludCxcbiAgICAgICAgICAgIHJlc3VsdFBvd2VyOiBudW1iZXIgPSAwO1xuXG4gICAgICAgIGxpZ2h0UmFuZG9tUG9pbnQgPSBsaWdodC5nZXRSYW5kb21Qb2ludCgpO1xuXG4gICAgICAgIHNoYWRvd1JheSA9IHRoaXMudHJhY2UoXG4gICAgICAgICAgICBuZXcgUmF5KFxuICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXRIaXRQb2ludCgpLFxuICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRSYW5kb21Qb2ludFxuICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0SGl0UG9pbnQoKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgICBzaGFkb3dSYXkuZ2V0SW50ZXJzZWN0KCkgJiZcbiAgICAgICAgICAgIHNoYWRvd1JheS5nZXRPd25lcigpIGluc3RhbmNlb2YgQWJzdHJhY3RMaWdodFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJlc3VsdFBvd2VyICs9IChcbiAgICAgICAgICAgICAgICBsaWdodFBvd2VyIC1cbiAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRSYW5kb21Qb2ludFxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXRIaXRQb2ludCgpXG4gICAgICAgICAgICAgICAgICAgICkuZ2V0TGVuZ3RoKCkgKiAobGlnaHRQb3dlciAvIGxpZ2h0LmdldEZhZGVSYWRpdXMoKSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cblxuICAgICAgICAvKmxpZ2h0UmFuZG9tUG9pbnQgPSB0aGlzLmNvc2luZVNhbXBsZUhlbWlzcGhlcmUoXG4gICAgICAgICAgICBpbnRlcnNlY3QuZ2V0T3duZXIoKS5nZXROb3JtYWwoaW50ZXJzZWN0LmdldEhpdFBvaW50KCkpXG4gICAgICAgICk7XG5cbiAgICAgICAgc2hhZG93UmF5ID0gdGhpcy50cmFjZShcbiAgICAgICAgICAgIG5ldyBSYXkoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldEhpdFBvaW50KCksXG4gICAgICAgICAgICAgICAgbGlnaHRSYW5kb21Qb2ludFxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHNoYWRvd1JheS5nZXRJbnRlcnNlY3QoKSAmJlxuICAgICAgICAgICAgc2hhZG93UmF5LmdldE93bmVyKCkgaW5zdGFuY2VvZiBBYnN0cmFjdExpZ2h0XG4gICAgICAgICkge1xuICAgICAgICAgICAgcmVzdWx0UG93ZXIgPSAoXG4gICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0SGl0UG9pbnQoKVxuICAgICAgICAgICAgICAgICAgICApLmdldExlbmd0aCgpICogKGxpZ2h0UG93ZXIgLyBsaWdodC5nZXRGYWRlUmFkaXVzKCkpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKHJlc3VsdFBvd2VyIDwgMCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdFBvd2VyID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSovXG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdFBvd2VyO1xuICAgIH1cblxuICAgIHByaXZhdGUgdHJhY2UgKHJheTogUmF5KTogSW50ZXJzZWN0UG9pbnQge1xuICAgICAgICBsZXQgaW50ZXJzZWN0aW9uID0gbmV3IEludGVyc2VjdFBvaW50KCksXG4gICAgICAgICAgICBpbnRlcnNlY3REYXRhOiBhbnksXG4gICAgICAgICAgICBtaW5EaXN0YW5jZTogbnVtYmVyID0gSW5maW5pdHksXG4gICAgICAgICAgICBzY2VuZU9iamVjdHM6IEFic3RyYWN0T2JqZWN0W10mQWJzdHJhY3RMaWdodFtdID0gdGhpcy5zY2VuZS5nZXRPYmplY3RzKCkuY29uY2F0KHRoaXMuc2NlbmUuZ2V0TGlnaHRzKCkpO1xuXG4gICAgICAgIGZvciAobGV0IG9iamVjdCBvZiBzY2VuZU9iamVjdHMpIHtcbiAgICAgICAgICAgIGludGVyc2VjdERhdGEgPSBvYmplY3QuZ2V0SW50ZXJzZWN0RGF0YShyYXkpO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0RGF0YSAmJlxuICAgICAgICAgICAgICAgIGludGVyc2VjdERhdGFbJ2Rpc3RhbmNlJ10gPCBtaW5EaXN0YW5jZVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgbWluRGlzdGFuY2UgPSBpbnRlcnNlY3REYXRhWydkaXN0YW5jZSddO1xuXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uLnNldEludGVyc2VjdCgpO1xuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvbi5zZXRIaXRQb2ludChpbnRlcnNlY3REYXRhWydoaXRQb2ludCddKTtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb24uc2V0Tm9ybWFsKGludGVyc2VjdERhdGFbJ25vcm1hbCddKTtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb24uc2V0RGlzdGFuY2VGcm9tT3JpZ2luKGludGVyc2VjdERhdGFbJ2Rpc3RhbmNlJ10pO1xuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvbi5zZXRPd25lcihvYmplY3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGludGVyc2VjdGlvbjtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVuZGVyIChzY3JlZW5XaWR0aDogbnVtYmVyLCBzY3JlZW5IZWlnaHQ6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCByYW5kb011bHRpcGxpZXIgPSAwLjU7XG5cbiAgICAgICAgbGV0IGJ1ZmZlcjogbnVtYmVyW10sXG4gICAgICAgICAgICBjb2xvcjogQ29sb3IsXG4gICAgICAgICAgICByYW5kOiBudW1iZXIsXG4gICAgICAgICAgICByYXk6IFJheTtcblxuICAgICAgICB0aGlzLnNjcmVlbldpZHRoID0gc2NyZWVuV2lkdGg7XG4gICAgICAgIHRoaXMuc2NyZWVuSGVpZ2h0ID0gc2NyZWVuSGVpZ2h0O1xuXG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICBidWZmZXIgPSBbXTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaXRlcmF0aW9uID0gMDsgaXRlcmF0aW9uIDwgMTsgaXRlcmF0aW9uKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgaSA9IDA7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHRoaXMuc2NyZWVuSGVpZ2h0OyB5KyspIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLnNjcmVlbldpZHRoOyB4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmQgPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA+IDAuNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmQgKz0gTWF0aC5yYW5kb20oKSAqIHJhbmRvTXVsdGlwbGllcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmQgLT0gTWF0aC5yYW5kb20oKSAqIHJhbmRvTXVsdGlwbGllcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmF5ID0gbmV3IFJheShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLmdldENhbWVyYSgpLmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRQZXJzcGVjdGl2ZVZlY3Rvcih4ICsgcmFuZCwgeSArIHJhbmQpXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlcltpXSA9IENvbG9yLmJsYWNrLmFkZCh0aGlzLmdldENvbG9yKHJheSkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBjb21wb25lbnQgaW4gdGhpcy5idWZmZXJbaV0uZ2V0Q29sb3IoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyW2ldW2NvbXBvbmVudF0gPSBDb2xvci5zUkdCRW5jb2RlKHRoaXMuYnVmZmVyW2ldW2NvbXBvbmVudF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIucHVzaCh0aGlzLmJ1ZmZlcltpXS5nZXRDb2xvcigpWydyZWQnXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIucHVzaCh0aGlzLmJ1ZmZlcltpXS5nZXRDb2xvcigpWydncmVlbiddKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKHRoaXMuYnVmZmVyW2ldLmdldENvbG9yKClbJ2JsdWUnXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yKGxldCAgaSA9IDA7IGkgPCB0aGlzLmJ1ZmZlci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyW2ldLmdldENvbG9yKClbJ3JlZCddID0gMC4wO1xuICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyW2ldLmdldENvbG9yKClbJ2dyZWVuJ10gPSAwLjA7XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmZXJbaV0uZ2V0Q29sb3IoKVsnYmx1ZSddID0gMC4wO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKGJ1ZmZlcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0U2NlbmUgKHNjZW5lOiBTY2VuZSk6IHZvaWQge1xuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XG4gICAgfVxufVxuXG5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIHZhciBkYXRhID0gbWVzc2FnZS5kYXRhO1xuXG4gICAgaWYgKHR5cGVvZihkYXRhKSA9PSAnc3RyaW5nJykge1xuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZSgnWycrZGF0YSsnXScpO1xuICAgIH1cblxuICAgIGxldCB0cmFjZXIgPSBuZXcgVHJhY2VyKCk7XG5cbiAgICB0cmFjZXIuc2V0U2NlbmUoXG4gICAgICAgIG5ldyBTY2VuZSh7XG4gICAgICAgICAgICBjYW1lcmE6IG5ldyBDYW1lcmEoXG4gICAgICAgICAgICAgICAgbmV3IFZlY3RvcigwLCAwLCAtNjk5KSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDAsIDAsIDEpLFxuICAgICAgICAgICAgICAgIGRhdGFbMF0sXG4gICAgICAgICAgICAgICAgZGF0YVsxXVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGxpZ2h0czogW1xuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmljYWxMaWdodChuZXcgVmVjdG9yICgwLCA2MDAsIDApLCAxLCAxMDApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3Iud2hpdGUpKSxcbiAgICAgICAgICAgICAgICBuZXcgU3BoZXJpY2FsTGlnaHQobmV3IFZlY3RvciAoMCwgMCwgMCksIDAuNiwgMTUwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjU1LCAyMzUsIDIwMCkpKSlcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBvYmplY3RzOiBbXG4gICAgICAgICAgICAgICAgbmV3IFBsYW5lKG5ldyBWZWN0b3IoMCwgMSwgMCksIG5ldyBWZWN0b3IgKDAsIC03MDAsIDApKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLjc1ICogMjU1LCAwLjc1ICogMjU1LCAwLjc1ICogMjU1KSksIDApKSxcbiAgICAgICAgICAgICAgICBuZXcgUGxhbmUobmV3IFZlY3RvcigwLCAtMSwgMCksIG5ldyBWZWN0b3IgKDAsIDcwMCwgMCkpLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAuNzUgKiAyNTUsIDAuNzUgKiAyNTUsIDAuNzUgKiAyNTUpKSwgMCkpLFxuICAgICAgICAgICAgICAgIG5ldyBQbGFuZShuZXcgVmVjdG9yKC0xLCAwLCAwKSwgbmV3IFZlY3RvciAoNzAwLCAwLCAwKSkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMC4yNSAqIDI1NSwgMC4yNSAqIDI1NSwgMC43NSAqIDI1NSkpLCAwKSksXG4gICAgICAgICAgICAgICAgbmV3IFBsYW5lKG5ldyBWZWN0b3IoMSwgMCwgMCksIG5ldyBWZWN0b3IgKC03MDAsIDAsIDApKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLjc1ICogMjU1LCAwLjI1ICogMjU1LCAwLjI1ICogMjU1KSksIDApKSxcbiAgICAgICAgICAgICAgICBuZXcgUGxhbmUobmV3IFZlY3RvcigwLCAwLCAtMSksIG5ldyBWZWN0b3IgKDAsIDAsIDcwMCkpLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAuNzUgKiAyNTUsIDAuNzUgKiAyNTUsIDAuNzUgKiAyNTUpKSwgMCkpLFxuICAgICAgICAgICAgICAgIG5ldyBQbGFuZShuZXcgVmVjdG9yKDAsIDAsIDEpLCBuZXcgVmVjdG9yICgwLCAwLCAtNzAwKSkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLmJsYWNrLCAwKSksXG4gICAgICAgICAgICAgICAgLy8gYm90dG9tIHBsYW5lXG4gICAgICAgICAgICAgICAgLypuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCA3MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3Iud2hpdGUsIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy8gZnJvbnQgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIDcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci53aGl0ZSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvLyB0b3AgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgLTcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci53aGl0ZSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvL3JpZ2h0IHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCA3MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3IuYmx1ZSkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvL2xlZnQgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIC03MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3IucmVkLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vIGJhY2sgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIC03MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3IuYmxhY2ssIDApLnNldExhbWJlcnRDb2VmZigxKSksKi9cbiAgICAgICAgICAgICAgICBuZXcgU3BoZXJlKG5ldyBWZWN0b3IoLTI1MCwgLTUwMCwgNDUwKSwgMjAwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLmJsYWNrLCAxKSksXG4gICAgICAgICAgICAgICAgbmV3IFNwaGVyZShuZXcgVmVjdG9yKDI1MCwgLTUwMCwgNDAwKSwgMjAwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLmdyZWVuLCAwKSlcbiAgICAgICAgICAgIF1cbiAgICAgICAgfSlcbiAgICApO1xuXG4gICAgdHJhY2VyLnJlbmRlcihkYXRhWzBdLCBkYXRhWzFdKTtcbn07Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
