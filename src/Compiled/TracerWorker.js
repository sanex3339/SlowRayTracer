var Camera_1=require("./Camera"),Color_1=require("./Color/Color"),Ray_1=require("./Ray"),RGBColor_1=require("./Color/RGBColor"),Scene_1=require("./Scene"),Sphere_1=require("./Objects/Sphere"),Vector_1=require("./Vector"),SphericalLight_1=require("./Lights/SphericalLight"),Material_1=require("./Material"),Polygon_1=require("./Objects/Polygon"),Tracer=function(){function e(){this.pixelSamples=4,this.shadowSamples=65,this.giSamples=35,this.screenWidth=250,this.screenHeight=250}return e.prototype.getColor=function(e,o){void 0===o&&(o=!0);var r=this.trace(e),t=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0));return null===r.owner?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(t=this.getDiffuseColor(e,r,o),o&&(n=this.getReflectionColor(e,r)),t.add(n))},e.prototype.getDiffuseColor=function(e,o,r){void 0===r&&(r=!0);for(var t,n,a,l,c,i,_,s,w,V,C=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),g=0,h=this.scene.getLights();g<h.length;g++){var d=h[g];if("light"===o.ownerType)return o.owner.getMaterial().getColor();if(i=this.getLightPower(o,d),t=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),l=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),c=Vector_1.Vector.normalized(Vector_1.Vector.substract(o.point,d.getPosition())),s=-Vector_1.Vector.dot(c,o.normal),t=t.add(o.owner.getMaterial().getColor().multiple(d.getMaterial().getColor().scaled(i*s*o.owner.getMaterial().getLambertCoeff()))),r)for(var p=function(e){var o,r,t,n=Math.random(),a=Math.random(),l=Math.sqrt(n),c=Math.sqrt(1-n),i=2*Math.PI*a,_=new Vector_1.Vector(l*Math.cos(i),c,l*Math.sin(i));return t=0==e.getCoordinates().x?new Vector_1.Vector(1,0,0):Vector_1.Vector.normalized(new Vector_1.Vector(e.getCoordinates().z,0,-e.getCoordinates().x)),r=Vector_1.Vector.inverse(Vector_1.Vector.cross(t,e)),o=new Vector_1.Vector(Vector_1.Vector.dot(t,_),Vector_1.Vector.dot(e,_),Vector_1.Vector.dot(r,_)),Vector_1.Vector.normalized(o)},R=0;R<this.giSamples;++R){var M=void 0,u=void 0;a=p(o.owner.getNormal(o.point)),M=this.getColor(new Ray_1.Ray(o.point,a),!1),u=Vector_1.Vector.dot(a,o.owner.getNormal(o.point)),n=n.add(o.owner.getMaterial().getColor().divide(Math.PI).multiple(M.scaled(u)))}_=Vector_1.Vector.reflect(c,o.normal),w=-Vector_1.Vector.dot(_,e.getDirection()),w>0&&(V=Math.pow(w,35),l=l.add(o.owner.getMaterial().getColor().multiple(d.getMaterial().getColor().scaled(i*V*o.owner.getMaterial().getPhongCoeff())))),C=C.add(t.add(n.divide(this.giSamples))).add(l)}return C},e.prototype.getReflectionColor=function(e,o){var r,t,n=e.getIteration(),a=o.owner.getMaterial().getReflectionValue();return e.setIteration(--n),0===n||0===a?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(t=Vector_1.Vector.reflect(e.getDirection(),o.normal),r=this.getColor(new Ray_1.Ray(o.point,t,n)).scaled(a))},e.prototype.getPerspectiveVector=function(e,o){var r=this.scene.getCamera();return Vector_1.Vector.normalized(Vector_1.Vector.add(r.getForwardVector(),Vector_1.Vector.add(Vector_1.Vector.scaled(r.getRightVector(),r.recenterX(e)),Vector_1.Vector.scaled(r.getUpVector(),r.recenterY(o)))))},e.prototype.getLightPower=function(e,o){for(var r,t,n=o.getPower(),a=0,l=0;l<this.shadowSamples;l++)r=o.getRandomPoint(),t=this.trace(new Ray_1.Ray(e.point,Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),r),e.point))),null!==t.point&&t.owner===o&&(a+=(n-Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),r),e.point).getLength()*(n/o.getFadeRadius()))/this.shadowSamples);return a},e.prototype.trace=function(e){for(var o,r={distance:0,point:null,normal:null,owner:null,ownerType:null},t=this.scene.getObjects().concat(this.scene.getLights()),n=0,a=t;n<a.length;n++){var l=a[n];o=l.getIntersectData(e),o&&o.distance>0&&(null===r.owner||o.distance<r.distance)&&(r.distance=o.distance,r.point=o.point,r.owner=l,r.ownerType=l.getType(),r.normal=r.owner.getNormal(r.point))}return r},e.prototype.render=function(e,o,r,t){var n,a,l,c,i=.5;this.screenWidth=e,this.screenHeight=o,n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0));for(var _=0;_<this.pixelSamples;_++)a=0,this.pixelSamples>1&&(_%2?a+=Math.random()*i:a-=Math.random()*i),l=new Ray_1.Ray(this.scene.getCamera().getPosition(),this.getPerspectiveVector(r+a,t+a)),n=n.add(this.getColor(l));n=n.divide(this.pixelSamples);for(var s in n)n[s]=Color_1.Color.sRGBEncode(n[s]);c=Color_1.Color.toRGB(n),self.postMessage([r,t,c.red,c.green,c.blue])},e.prototype.setScene=function(e){this.scene=e},e}();onmessage=function(e){var o=e.data;"string"==typeof o&&(o=JSON.parse("["+o+"]"));var r=new Tracer;r.setScene(new Scene_1.Scene({camera:new Camera_1.Camera(new Vector_1.Vector(0,0,-699),new Vector_1.Vector(0,0,1),o[0],o[1]),lights:[new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,640,0),.7,50).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)))),new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,0,0),.7,150).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,235,200))))],objects:[new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(-700,-700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(-700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,700,-700),new Vector_1.Vector(700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(79,166,242)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(-700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(245,130,130)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),0).setLambertCoeff(1)),new Sphere_1.Sphere(new Vector_1.Vector(-250,-500,450),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),1)),new Sphere_1.Sphere(new Vector_1.Vector(250,-500,400),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,255,0)),0))]})),r.render(o[0],o[1],o[2],o[3])};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRyYWNlcldvcmtlci50cyJdLCJuYW1lcyI6WyJDYW1lcmFfMSIsInJlcXVpcmUiLCJDb2xvcl8xIiwiUmF5XzEiLCJSR0JDb2xvcl8xIiwiU2NlbmVfMSIsIlNwaGVyZV8xIiwiVmVjdG9yXzEiLCJTcGhlcmljYWxMaWdodF8xIiwiTWF0ZXJpYWxfMSIsIlBvbHlnb25fMSIsIlRyYWNlciIsIlRyYWNlci5jb25zdHJ1Y3RvciIsIlRyYWNlci5nZXRDb2xvciIsIlRyYWNlci5nZXREaWZmdXNlQ29sb3IiLCJUcmFjZXIuZ2V0UmVmbGVjdGlvbkNvbG9yIiwiVHJhY2VyLmdldFBlcnNwZWN0aXZlVmVjdG9yIiwiVHJhY2VyLmdldExpZ2h0UG93ZXIiLCJUcmFjZXIudHJhY2UiLCJUcmFjZXIucmVuZGVyIiwiVHJhY2VyLnNldFNjZW5lIiwib25tZXNzYWdlIiwibWVzc2FnZSIsImRhdGEiLCJKU09OIiwicGFyc2UiLCJ0cmFjZXIiLCJzZXRTY2VuZSIsIlNjZW5lIiwiY2FtZXJhIiwiQ2FtZXJhIiwiVmVjdG9yIiwibGlnaHRzIiwiU3BoZXJpY2FsTGlnaHQiLCJzZXRNYXRlcmlhbCIsIk1hdGVyaWFsIiwiQ29sb3IiLCJSR0JDb2xvciIsIm9iamVjdHMiLCJQb2x5Z29uIiwic2V0TGFtYmVydENvZWZmIiwiU3BoZXJlIiwicmVuZGVyIl0sIm1hcHBpbmdzIjoiQUFHQSxHQUFBQSxVQUFBQyxRQUF1QixZQUN2QkMsUUFBQUQsUUFBc0IsaUJBQ3RCRSxNQUFBRixRQUFvQixTQUNwQkcsV0FBQUgsUUFBeUIsb0JBRXpCSSxRQUFBSixRQUFzQixXQUN0QkssU0FBQUwsUUFBdUIsb0JBQ3ZCTSxTQUFBTixRQUF1QixZQUd2Qk8saUJBQUFQLFFBQStCLDJCQUMvQlEsV0FBQVIsUUFBeUIsY0FDekJTLFVBQUFULFFBQXdCLHFCQUV4QlUsT0FBQSxXQUFBQSxRQUFBQSxLQUVZQyxLQUFBQSxhQUF1QkEsRUFDdkJBLEtBQUFBLGNBQXdCQSxHQUN4QkEsS0FBQUEsVUFB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SyxHQUFJQSxFQUFLLEdBQUlBLEVBQUsiLCJmaWxlIjoiVHJhY2VyV29ya2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9XCJ0cnVlXCIvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cImxpYi9saWIud2Vid29ya2VyLmQudHNcIiAvPlxuXG5pbXBvcnQgeyBDYW1lcmEgfSBmcm9tIFwiLi9DYW1lcmFcIjtcbmltcG9ydCB7IENvbG9yIH0gZnJvbSBcIi4vQ29sb3IvQ29sb3JcIjtcbmltcG9ydCB7IFJheSB9IGZyb20gXCIuL1JheVwiO1xuaW1wb3J0IHsgUkdCQ29sb3IgfSBmcm9tIFwiLi9Db2xvci9SR0JDb2xvclwiO1xuaW1wb3J0IHsgUlRNYXRoIH0gZnJvbSBcIi4vUlRNYXRoXCI7XG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XG5pbXBvcnQgeyBTcGhlcmUgfSBmcm9tIFwiLi9PYmplY3RzL1NwaGVyZVwiO1xuaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSBcIi4vVmVjdG9yXCI7XG5pbXBvcnQgeyBQbGFuZSB9IGZyb20gXCIuL09iamVjdHMvUGxhbmVcIjtcbmltcG9ydCB7IEFic3RyYWN0TGlnaHQgfSBmcm9tIFwiLi9MaWdodHMvQWJzdHJhY3RMaWdodFwiO1xuaW1wb3J0IHsgU3BoZXJpY2FsTGlnaHQgfSBmcm9tIFwiLi9MaWdodHMvU3BoZXJpY2FsTGlnaHRcIjtcbmltcG9ydCB7IE1hdGVyaWFsIH0gZnJvbSBcIi4vTWF0ZXJpYWxcIjtcbmltcG9ydCB7IFBvbHlnb24gfSBmcm9tIFwiLi9PYmplY3RzL1BvbHlnb25cIjtcblxuY2xhc3MgVHJhY2VyIHtcbiAgICBwcml2YXRlIHNjZW5lOiBTY2VuZTtcbiAgICBwcml2YXRlIHBpeGVsU2FtcGxlczogbnVtYmVyID0gNDtcbiAgICBwcml2YXRlIHNoYWRvd1NhbXBsZXM6IG51bWJlciA9IDY1O1xuICAgIHByaXZhdGUgZ2lTYW1wbGVzOiBudW1iZXIgPSAzNTtcbiAgICBwcml2YXRlIHNjcmVlbldpZHRoOiBudW1iZXIgPSAyNTA7XG4gICAgcHJpdmF0ZSBzY3JlZW5IZWlnaHQ6IG51bWJlciA9IDI1MDtcblxuICAgIHByaXZhdGUgZ2V0Q29sb3IgKHJheTogUmF5LCByZWN1cmNpdmU6IGJvb2xlYW4gPSB0cnVlKTogQ29sb3Ige1xuICAgICAgICBsZXQgaW50ZXJzZWN0ID0gdGhpcy50cmFjZShyYXkpLFxuICAgICAgICAgICAgZGlmZnVzZUNvbG9yOiBDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpLFxuICAgICAgICAgICAgcmVmbGVjdENvbG9yOiBDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuXG4gICAgICAgIGlmIChpbnRlcnNlY3RbJ293bmVyJ10gPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRpZmZ1c2VDb2xvciA9IHRoaXMuZ2V0RGlmZnVzZUNvbG9yKHJheSwgaW50ZXJzZWN0LCByZWN1cmNpdmUpO1xuXG4gICAgICAgIGlmIChyZWN1cmNpdmUpIHtcbiAgICAgICAgICAgIHJlZmxlY3RDb2xvciA9IHRoaXMuZ2V0UmVmbGVjdGlvbkNvbG9yKHJheSwgaW50ZXJzZWN0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaWZmdXNlQ29sb3IuYWRkKHJlZmxlY3RDb2xvcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREaWZmdXNlQ29sb3IgKHJheTogUmF5LCBpbnRlcnNlY3Q6IGFueSwgcmVjdXJzaXZlOiBib29sZWFuID0gdHJ1ZSk6IENvbG9yIHtcbiAgICAgICAgbGV0IGxhbWJDb2xvcjogQ29sb3IsXG4gICAgICAgICAgICByYWRpYW5jZUNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uOiBWZWN0b3IsXG4gICAgICAgICAgICBwaG9uZ0NvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHBpeGVsQ29sb3I6IENvbG9yID0gbmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSksXG4gICAgICAgICAgICBsaWdodERpcmVjdGlvbjogVmVjdG9yLFxuICAgICAgICAgICAgbGlnaHRQb3dlcjogbnVtYmVyLFxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyOiBWZWN0b3IsXG4gICAgICAgICAgICBsYW1iQ29zOiBudW1iZXIsXG4gICAgICAgICAgICBwaG9uZ0NvczogbnVtYmVyLFxuICAgICAgICAgICAgcGhvbmc6IG51bWJlcjtcblxuICAgICAgICBmb3IgKGxldCBsaWdodCBvZiB0aGlzLnNjZW5lLmdldExpZ2h0cygpKSB7XG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0Wydvd25lclR5cGUnXSA9PT0gJ2xpZ2h0Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcnNlY3RbJ293bmVyJ11cbiAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxpZ2h0UG93ZXIgPSB0aGlzLmdldExpZ2h0UG93ZXIoaW50ZXJzZWN0LCBsaWdodCk7XG5cbiAgICAgICAgICAgIGxhbWJDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgcmFkaWFuY2VDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgcGhvbmdDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24gPSBWZWN0b3Iubm9ybWFsaXplZChcbiAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ3BvaW50J10sXG4gICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldFBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBsYW1iZXJ0XG5cbiAgICAgICAgICAgIGxhbWJDb3MgPSAtVmVjdG9yLmRvdChcbiAgICAgICAgICAgICAgICBsaWdodERpcmVjdGlvbixcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ25vcm1hbCddXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBsYW1iQ29sb3IgPSBsYW1iQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXVxuICAgICAgICAgICAgICAgICAgICAuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAubXVsdGlwbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodFBvd2VyICogbGFtYkNvcyAqIGludGVyc2VjdFsnb3duZXInXS5nZXRNYXRlcmlhbCgpLmdldExhbWJlcnRDb2VmZigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAocmVjdXJzaXZlKSB7XG4gICAgICAgICAgICAgICAgbGV0IHJhbmREaXIgPSAobm9ybWFsOiBWZWN0b3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJhc2lzVHJhbnNmb3JtOiBWZWN0b3IsXG4gICAgICAgICAgICAgICAgICAgICAgICBiaXRhbmdlbnQ6IFZlY3RvcixcbiAgICAgICAgICAgICAgICAgICAgICAgIHUxOiBudW1iZXIgPSBNYXRoLnJhbmRvbSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdTI6IG51bWJlciA9IE1hdGgucmFuZG9tKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW5fdGhldGE6IG51bWJlciA9IE1hdGguc3FydCh1MSksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3NfdGhldGE6IG51bWJlciA9IE1hdGguc3FydCgxIC0gdTEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGhpOiBudW1iZXIgPSAyICogTWF0aC5QSSAqIHUyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlyOiBWZWN0b3IgPSBuZXcgVmVjdG9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbl90aGV0YSAqIE1hdGguY29zKHBoaSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29zX3RoZXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbl90aGV0YSAqIE1hdGguc2luKHBoaSlcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICB0YW5nZW50OiBWZWN0b3I7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vcm1hbC5nZXRDb29yZGluYXRlcygpWyd4J10gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFuZ2VudCA9IG5ldyBWZWN0b3IoMSwgMCwgMCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YW5nZW50ID0gVmVjdG9yLm5vcm1hbGl6ZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9ybWFsLmdldENvb3JkaW5hdGVzKClbJ3onXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLW5vcm1hbC5nZXRDb29yZGluYXRlcygpWyd4J11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYml0YW5nZW50ID0gVmVjdG9yLmludmVyc2UoVmVjdG9yLmNyb3NzKHRhbmdlbnQsIG5vcm1hbCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGJhc2lzVHJhbnNmb3JtID0gbmV3IFZlY3RvcihcbiAgICAgICAgICAgICAgICAgICAgICAgIFZlY3Rvci5kb3QodGFuZ2VudCwgZGlyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFZlY3Rvci5kb3Qobm9ybWFsLCBkaXIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yLmRvdChiaXRhbmdlbnQsIGRpcilcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gVmVjdG9yLm5vcm1hbGl6ZWQoYmFzaXNUcmFuc2Zvcm0pO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZ2lTYW1wbGVzOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJhZGlhbmNlSW5SYW5kb21EaXJlY3Rpb246IENvbG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvc0k6IG51bWJlcjtcblxuICAgICAgICAgICAgICAgICAgICByYWRpYW5jZVJhbmRvbURpcmVjdGlvbiA9IHJhbmREaXIoaW50ZXJzZWN0Wydvd25lciddLmdldE5vcm1hbChpbnRlcnNlY3RbJ3BvaW50J10pKTtcbiAgICAgICAgICAgICAgICAgICAgcmFkaWFuY2VJblJhbmRvbURpcmVjdGlvbiA9IHRoaXMuZ2V0Q29sb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmF5KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsncG9pbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpYW5jZVJhbmRvbURpcmVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIGNvc0kgPSBWZWN0b3IuZG90KFxuICAgICAgICAgICAgICAgICAgICAgICAgcmFkaWFuY2VSYW5kb21EaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ293bmVyJ10uZ2V0Tm9ybWFsKGludGVyc2VjdFsncG9pbnQnXSlcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICByYWRpYW5jZUNvbG9yID0gcmFkaWFuY2VDb2xvclxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ293bmVyJ11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRpdmlkZShNYXRoLlBJKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubXVsdGlwbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpYW5jZUluUmFuZG9tRGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNjYWxlZChjb3NJKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHBob25nXG5cbiAgICAgICAgICAgIHJlZmxlY3RQaG9uZ1ZlY3RvckRpciA9IFZlY3Rvci5yZWZsZWN0KFxuICAgICAgICAgICAgICAgIGxpZ2h0RGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgIGludGVyc2VjdFsnbm9ybWFsJ11cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBwaG9uZ0NvcyA9IC1WZWN0b3IuZG90KHJlZmxlY3RQaG9uZ1ZlY3RvckRpciwgcmF5LmdldERpcmVjdGlvbigpKTtcblxuICAgICAgICAgICAgaWYgKHBob25nQ29zID4gMCkge1xuICAgICAgICAgICAgICAgIHBob25nID0gTWF0aC5wb3cocGhvbmdDb3MsIDM1KTtcbiAgICAgICAgICAgICAgICBwaG9uZ0NvbG9yID0gcGhvbmdDb2xvci5hZGQoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAubXVsdGlwbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRQb3dlciAqIHBob25nICogaW50ZXJzZWN0Wydvd25lciddLmdldE1hdGVyaWFsKCkuZ2V0UGhvbmdDb2VmZigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwaXhlbENvbG9yID0gcGl4ZWxDb2xvci5hZGQoXG4gICAgICAgICAgICAgICAgbGFtYkNvbG9yLmFkZChcbiAgICAgICAgICAgICAgICAgICAgcmFkaWFuY2VDb2xvci5kaXZpZGUodGhpcy5naVNhbXBsZXMpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKS5hZGQocGhvbmdDb2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcGl4ZWxDb2xvcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFJlZmxlY3Rpb25Db2xvciAocmF5OiBSYXksIGludGVyc2VjdDogYW55KTogYW55IHtcbiAgICAgICAgbGV0IHJheUl0ZXJhdGlvbjogbnVtYmVyID0gcmF5LmdldEl0ZXJhdGlvbigpLFxuICAgICAgICAgICAgcmVmbGVjdGlvbkNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJlZmxlY3Rpb25WYWx1ZTogbnVtYmVyID0gaW50ZXJzZWN0Wydvd25lciddLmdldE1hdGVyaWFsKCkuZ2V0UmVmbGVjdGlvblZhbHVlKCksXG4gICAgICAgICAgICByZWZsZWN0ZWRSYXk6IFZlY3RvcjtcblxuICAgICAgICByYXkuc2V0SXRlcmF0aW9uKC0tcmF5SXRlcmF0aW9uKTtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgICByYXlJdGVyYXRpb24gPT09IDAgfHxcbiAgICAgICAgICAgIHJlZmxlY3Rpb25WYWx1ZSA9PT0gMFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZmxlY3RlZFJheSA9IFZlY3Rvci5yZWZsZWN0KFxuICAgICAgICAgICAgcmF5LmdldERpcmVjdGlvbigpLFxuICAgICAgICAgICAgaW50ZXJzZWN0Wydub3JtYWwnXVxuICAgICAgICApO1xuXG4gICAgICAgIHJlZmxlY3Rpb25Db2xvciA9IHRoaXMuZ2V0Q29sb3IoXG4gICAgICAgICAgICBuZXcgUmF5KGludGVyc2VjdFsncG9pbnQnXSwgcmVmbGVjdGVkUmF5LCByYXlJdGVyYXRpb24pXG4gICAgICAgICkuc2NhbGVkKHJlZmxlY3Rpb25WYWx1ZSk7XG5cbiAgICAgICAgcmV0dXJuIHJlZmxlY3Rpb25Db2xvcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFBlcnNwZWN0aXZlVmVjdG9yICh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgICAgICBsZXQgY2FtZXJhOiBDYW1lcmEgPSB0aGlzLnNjZW5lLmdldENhbWVyYSgpO1xuXG4gICAgICAgIHJldHVybiBWZWN0b3Iubm9ybWFsaXplZChcbiAgICAgICAgICAgIFZlY3Rvci5hZGQoXG4gICAgICAgICAgICAgICAgY2FtZXJhLmdldEZvcndhcmRWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICBWZWN0b3IuYWRkKFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc2NhbGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLmdldFJpZ2h0VmVjdG9yKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEucmVjZW50ZXJYKHgpXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEuZ2V0VXBWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5yZWNlbnRlclkoeSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldExpZ2h0UG93ZXIgKGludGVyc2VjdDogYW55LCBsaWdodDogQWJzdHJhY3RMaWdodCk6IG51bWJlciB7XG4gICAgICAgIGxldCBsaWdodFBvd2VyID0gbGlnaHQuZ2V0UG93ZXIoKSxcbiAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnQ6IFZlY3RvcixcbiAgICAgICAgICAgIGxpZ2h0UmF5OiBhbnksXG4gICAgICAgICAgICByZXN1bHRQb3dlcjogbnVtYmVyID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2hhZG93U2FtcGxlczsgaSsrKSB7XG4gICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50ID0gbGlnaHQuZ2V0UmFuZG9tUG9pbnQoKTtcblxuICAgICAgICAgICAgbGlnaHRSYXkgPSB0aGlzLnRyYWNlKFxuICAgICAgICAgICAgICAgIG5ldyBSYXkoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsncG9pbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50XG4gICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydwb2ludCddXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAobGlnaHRSYXlbJ3BvaW50J10gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGxpZ2h0UmF5Wydvd25lciddICE9PSBsaWdodCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXN1bHRQb3dlciArPSAoXG4gICAgICAgICAgICAgICAgbGlnaHRQb3dlciAtXG4gICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ3BvaW50J11cbiAgICAgICAgICAgICAgICAgICAgKS5nZXRMZW5ndGgoKSAqIChsaWdodFBvd2VyIC8gbGlnaHQuZ2V0RmFkZVJhZGl1cygpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkgLyB0aGlzLnNoYWRvd1NhbXBsZXM7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0UG93ZXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmFjZSAocmF5OiBSYXkpOiB7ZGlzdGFuY2U6IG51bWJlciwgcG9pbnQ6IFZlY3Rvciwgb3duZXI6IGFueSwgb3duZXJUeXBlOiBzdHJpbmd9IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBkaXN0YW5jZTogMCxcbiAgICAgICAgICAgICAgICBwb2ludDogbnVsbCxcbiAgICAgICAgICAgICAgICBub3JtYWw6IG51bGwsXG4gICAgICAgICAgICAgICAgb3duZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgb3duZXJUeXBlOiBudWxsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW50ZXJzZWN0RGF0YTogYW55LFxuICAgICAgICAgICAgc2NlbmVPYmplY3RzV2l0aExpZ2h0czogYW55W10gPSB0aGlzLnNjZW5lLmdldE9iamVjdHMoKS5jb25jYXQodGhpcy5zY2VuZS5nZXRMaWdodHMoKSk7XG5cbiAgICAgICAgZm9yIChsZXQgb2JqZWN0IG9mIHNjZW5lT2JqZWN0c1dpdGhMaWdodHMpIHtcbiAgICAgICAgICAgIGludGVyc2VjdERhdGEgPSBvYmplY3QuZ2V0SW50ZXJzZWN0RGF0YShyYXkpO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0RGF0YSAmJlxuICAgICAgICAgICAgICAgIGludGVyc2VjdERhdGFbJ2Rpc3RhbmNlJ10gPiAwICYmXG4gICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRbJ293bmVyJ10gPT09IG51bGwgfHxcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXSA8IHJlc3VsdFsnZGlzdGFuY2UnXVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHJlc3VsdFsnZGlzdGFuY2UnXSA9IGludGVyc2VjdERhdGFbJ2Rpc3RhbmNlJ107XG4gICAgICAgICAgICAgICAgcmVzdWx0Wydwb2ludCddID0gaW50ZXJzZWN0RGF0YVsncG9pbnQnXTtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ293bmVyJ10gPSBvYmplY3Q7XG4gICAgICAgICAgICAgICAgcmVzdWx0Wydvd25lclR5cGUnXSA9IG9iamVjdC5nZXRUeXBlKCk7XG4gICAgICAgICAgICAgICAgcmVzdWx0Wydub3JtYWwnXSA9IHJlc3VsdFsnb3duZXInXS5nZXROb3JtYWwocmVzdWx0Wydwb2ludCddKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlciAoc2NyZWVuV2lkdGg6IG51bWJlciwgc2NyZWVuSGVpZ2h0OiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHJhbmRvTXVsdGlwbGllciA9IDAuNTtcblxuICAgICAgICBsZXQgY29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcmFuZDogbnVtYmVyLFxuICAgICAgICAgICAgcmF5OiBSYXksXG4gICAgICAgICAgICByZ2JDb2xvcjoge1xuICAgICAgICAgICAgICAgIHJlZDogbnVtYmVyLFxuICAgICAgICAgICAgICAgIGdyZWVuOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgYmx1ZTogbnVtYmVyXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuc2NyZWVuV2lkdGggPSBzY3JlZW5XaWR0aDtcbiAgICAgICAgdGhpcy5zY3JlZW5IZWlnaHQgPSBzY3JlZW5IZWlnaHQ7XG5cbiAgICAgICAgY29sb3IgPSBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcblxuICAgICAgICBmb3IgKGxldCBpdGVyID0gMDsgaXRlciA8IHRoaXMucGl4ZWxTYW1wbGVzOyBpdGVyKyspIHtcbiAgICAgICAgICAgIHJhbmQgPSAwO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5waXhlbFNhbXBsZXMgPiAxKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZXIgJSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmQgKz0gTWF0aC5yYW5kb20oKSAqIHJhbmRvTXVsdGlwbGllcjtcbiAgICAgICAgICAgICAgICB9ICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZCAtPSBNYXRoLnJhbmRvbSgpICogcmFuZG9NdWx0aXBsaWVyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmF5ID0gbmV3IFJheShcbiAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLmdldENhbWVyYSgpLmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRQZXJzcGVjdGl2ZVZlY3Rvcih4ICsgcmFuZCwgeSArIHJhbmQpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb2xvciA9IGNvbG9yLmFkZCh0aGlzLmdldENvbG9yKHJheSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29sb3IgPSBjb2xvci5kaXZpZGUodGhpcy5waXhlbFNhbXBsZXMpO1xuXG4gICAgICAgIGZvciAobGV0IGNvbXBvbmVudCBpbiBjb2xvcikge1xuICAgICAgICAgICAgY29sb3JbY29tcG9uZW50XSA9IENvbG9yLnNSR0JFbmNvZGUoY29sb3JbY29tcG9uZW50XSk7XG4gICAgICAgIH1cblxuICAgICAgICByZ2JDb2xvciA9IENvbG9yLnRvUkdCKGNvbG9yKTtcblxuICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKFt4LCB5LCByZ2JDb2xvci5yZWQsIHJnYkNvbG9yLmdyZWVuLCByZ2JDb2xvci5ibHVlXSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFNjZW5lIChzY2VuZTogU2NlbmUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xuICAgIH1cbn1cblxub25tZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICB2YXIgZGF0YSA9IG1lc3NhZ2UuZGF0YTtcblxuICAgIGlmICh0eXBlb2YoZGF0YSkgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoJ1snK2RhdGErJ10nKTtcbiAgICB9XG5cbiAgICBsZXQgdHJhY2VyID0gbmV3IFRyYWNlcigpO1xuXG4gICAgdHJhY2VyLnNldFNjZW5lKFxuICAgICAgICBuZXcgU2NlbmUoe1xuICAgICAgICAgICAgY2FtZXJhOiBuZXcgQ2FtZXJhKFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoMCwgMCwgLTY5OSksXG4gICAgICAgICAgICAgICAgbmV3IFZlY3RvcigwLCAwLCAxKSxcbiAgICAgICAgICAgICAgICBkYXRhWzBdLFxuICAgICAgICAgICAgICAgIGRhdGFbMV1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBsaWdodHM6IFtcbiAgICAgICAgICAgICAgICBuZXcgU3BoZXJpY2FsTGlnaHQobmV3IFZlY3RvciAoMCwgNjQwLCAwKSwgMC43LCA1MClcbiAgICAgICAgICAgICAgICAgICAgLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDI1NSwgMjU1LCAyNTUpKSkpLFxuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmljYWxMaWdodChuZXcgVmVjdG9yICgwLCAwLCAwKSwgMC43LCAxNTApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDIzNSwgMjAwKSkpKVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIG9iamVjdHM6IFtcbiAgICAgICAgICAgICAgICAvL25ldyBQbGFuZShuZXcgVmVjdG9yKDAsIDEsIDApLCAtNDAwKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigxMTUsIDExNSwgMTE1KSksIDApKSxcbiAgICAgICAgICAgICAgICAvLyBib3R0b20gcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCA3MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDI1NSwgMjU1KSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy8gZnJvbnQgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIDcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDI1NSwgMjU1LCAyNTUpKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvLyB0b3AgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDI1NSwgMjU1LCAyNTUpKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvL3JpZ2h0IHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCA3MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcig3OSwgMTY2LCAyNDIpKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvL2xlZnQgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIC03MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNDUsIDEzMCwgMTMwKSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy8gYmFjayBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICBuZXcgU3BoZXJlKG5ldyBWZWN0b3IoLTI1MCwgLTUwMCwgNDUwKSwgMjAwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpLCAxKSksXG4gICAgICAgICAgICAgICAgbmV3IFNwaGVyZShuZXcgVmVjdG9yKDI1MCwgLTUwMCwgNDAwKSwgMjAwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMjU1LCAwKSksIDApKVxuICAgICAgICAgICAgXVxuICAgICAgICB9KVxuICAgICk7XG5cbiAgICB0cmFjZXIucmVuZGVyKGRhdGFbMF0sIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM10pO1xufTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
