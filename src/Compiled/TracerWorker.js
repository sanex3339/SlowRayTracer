var Camera_1=require("./Camera"),Color_1=require("./Color/Color"),Ray_1=require("./Ray"),RGBColor_1=require("./Color/RGBColor"),Scene_1=require("./Scene"),Sphere_1=require("./Objects/Sphere"),Vector_1=require("./Vector"),SphericalLight_1=require("./Lights/SphericalLight"),Material_1=require("./Material"),Polygon_1=require("./Objects/Polygon"),Tracer=function(){function e(){this.raysPerPixel=8,this.screenWidth=250,this.screenHeight=250}return e.prototype.getColor=function(e,o){void 0===o&&(o=!0);var r=this.trace(e),t=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0));return null===r.owner?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(t=this.getDiffuseColor(e,r,o),o&&(n=this.getReflectionColor(e,r)),t.add(n))},e.prototype.getDiffuseColor=function(e,o,r){void 0===r&&(r=!0);for(var t,n,a,l,c,i,_,w,C=50,V=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),s=0,g=this.scene.getLights();s<g.length;s++){var d=g[s];if("light"===o.ownerType)return o.owner.getMaterial().getColor();var h=this.getLightPower(o,d);if(t=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),a=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),l=Vector_1.Vector.normalized(Vector_1.Vector.substract(o.point,d.getPosition())),i=-Vector_1.Vector.dot(l,o.normal),t=t.add(o.owner.getMaterial().getColor().multiple(d.getMaterial().getColor().scaled(h*i*o.owner.getMaterial().getLambertCoeff()))),r)for(var R=function(e){for(;;){var o=new Vector_1.Vector(Math.random()-.5,Math.random()-.5,Math.random()-.5);if(!(Vector_1.Vector.dot(o,o)>1))return o=Vector_1.Vector.normalized(o),Vector_1.Vector.dot(o,e)<0&&(o=Vector_1.Vector.inverse(o)),o}},p=0;C>p;++p){var u=R(o.owner.getNormal(o.point)),f=this.getColor(new Ray_1.Ray(o.point,u),!1),M=Vector_1.Vector.dot(u,o.owner.getNormal(o.point));n=n.add(o.owner.getMaterial().getColor().divide(Math.PI).multiple(f.scaled(M)))}c=Vector_1.Vector.reflect(l,o.normal),_=-Vector_1.Vector.dot(c,e.getDirection()),_>0&&(w=Math.pow(_,35),a=a.add(o.owner.getMaterial().getColor().multiple(d.getMaterial().getColor().scaled(h*w*o.owner.getMaterial().getPhongCoeff())))),V=V.add(t.add(n.divide(C))).add(a)}return V},e.prototype.getReflectionColor=function(e,o){var r,t,n=o.owner.getMaterial().getReflectionValue();return e.setIteration(e.getIteration()-1),0===e.getIteration()||0===n?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(t=Vector_1.Vector.reflect(e.getDirection(),o.normal),r=this.getColor(new Ray_1.Ray(o.point,t,e.getIteration())).scaled(n))},e.prototype.getPerspectiveVector=function(e,o,r,t){var n=this.scene.getCamera();return Vector_1.Vector.normalized(Vector_1.Vector.add(n.getForwardVector(),Vector_1.Vector.add(Vector_1.Vector.scaled(n.getRightVector(),n.recenterX(e)),Vector_1.Vector.scaled(n.getUpVector(),n.recenterY(o)))))},e.prototype.getLightPower=function(e,o){for(var r,t=200,n=o.getPower(),a=0,l=0;t>l;l++){r=o.getRandomPoint();var c=this.trace(new Ray_1.Ray(e.point,Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),r),e.point)));null!==c.point&&c.owner===o&&(a+=(n-Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),r),e.point).getLength()*(n/o.getFadeRadius()))/t)}return a},e.prototype.trace=function(e){for(var o,r={distance:0,point:null,normal:null,owner:null,ownerType:null},t=this.scene.getObjects().concat(this.scene.getLights()),n=0,a=t;n<a.length;n++){var l=a[n];o=l.getIntersectData(e),o&&o.distance>0&&(null===r.owner||o.distance<r.distance)&&(r.distance=o.distance,r.point=o.point,r.owner=l,r.ownerType=l.getType(),r.normal=r.owner.getNormal(r.point))}return r},e.prototype.render=function(e,o,r,t){var n,a,l,c,i=.5;this.screenWidth=e,this.screenHeight=o,n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0));for(var _=0;_<this.raysPerPixel;_++)a=0,this.raysPerPixel>1&&(_%2?a+=Math.random()*i:a-=Math.random()*i),l=new Ray_1.Ray(this.scene.getCamera().getPosition(),this.getPerspectiveVector(r+a,t+a,e,o)),n=n.add(this.getColor(l));n=n.divide(this.raysPerPixel);for(var w in n)n[w]=Color_1.Color.sRGBEncode(n[w]);c=Color_1.Color.toRGB(n),self.postMessage([r,t,c.red,c.green,c.blue])},e.prototype.setScene=function(e){this.scene=e},e}();onmessage=function(e){var o=e.data;"string"==typeof o&&(o=JSON.parse("["+o+"]"));var r=new Tracer;r.setScene(new Scene_1.Scene({camera:new Camera_1.Camera(new Vector_1.Vector(0,0,-699),new Vector_1.Vector(0,0,1),o[0],o[1]),lights:[new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,640,0),1.2,50).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255))))],objects:[new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(-700,-700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(-700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,700,-700),new Vector_1.Vector(700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(-700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,0,0)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),0).setLambertCoeff(1)),new Sphere_1.Sphere(new Vector_1.Vector(-250,-500,450),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),1)),new Sphere_1.Sphere(new Vector_1.Vector(250,-500,400),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,255,0)),0))]})),r.render(o[0],o[1],o[2],o[3])};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRyYWNlcldvcmtlci50cyJdLCJuYW1lcyI6WyJDYW1lcmFfMSIsInJlcXVpcmUiLCJDb2xvcl8xIiwiUmF5XzEiLCJSR0JDb2xvcl8xIiwiU2NlbmVfMSIsIlNwaGVyZV8xIiwiVmVjdG9yXzEiLCJTcGhlcmljYWxMaWdodF8xIiwiTWF0ZXJpYWxfMSIsIlBvbHlnb25fMSIsIlRyYWNlciIsIlRyYWNlci5jb25zdHJ1Y3RvciIsIlRyYWNlci5nZXRDb2xvciIsIlRyYWNlci5nZXREaWZmdXNlQ29sb3IiLCJUcmFjZXIuZ2V0UmVmbGVjdGlvbkNvbG9yIiwiVHJhY2VyLmdldFBlcnNwZWN0aXZlVmVjdG9yIiwiVHJhY2VyLmdldExpZ2h0UG93ZXIiLCJUcmFjZXIudHJhY2UiLCJUcmFjZXIucmVuZGVyIiwiVHJhY2VyLnNldFNjZW5lIiwib25tZXNzYWdlIiwibWVzc2FnZSIsImRhdGEiLCJKU09OIiwicGFyc2UiLCJ0cmFjZXIiLCJzZXRTY2VuZSIsIlNjZW5lIiwiY2FtZXJhIiwiQ2FtZXJhIiwiVmVjdG9yIiwibGlnaHRzIiwiU3BoZXJpY2FsTGlnaHQiLCJzZXRNYXRlcmlhbCIsIk1hdGVyaWFsIiwiQ29sb3IiLCJSR0JDb2xvciIsIm9iamVjdHMiLCJQb2x5Z29uIiwic2V0TGFtYmVydENvZWZmIiwiU3BoZXJlIiwicmVuZGVyIl0sIm1hcHBpbmdzIjoiQUFHQSxHQUFBQSxVQUFBQyxRQUF1QixZQUN2QkMsUUFBQUQsUUFBc0IsaUJBQ3RCRSxNQUFBRixRQUFvQixTQUNwQkcsV0FBQUgsUUFBeUIsb0JBRXpCSSxRQUFBSixRQUFzQixXQUN0QkssU0FBQUwsUUFBdUIsb0JBQ3ZCTSxTQUFBTixRQUF1QixZQUd2Qk8saUJBQUFQLFFBQStCLDJCQUMvQlEsV0FBQVIsUUFBeUIsY0FDekJTLFVBQUFULFFBQXdCLHFCQUV4QlUsT0FBQSxXQUFBQSxRQUFBQSxLQUVZQyxLQUFBQSxhQUF1QkEsRUFDdkJBLEtBQUFBLFlBQXNCQSxJQUN0QkEsS0FBQUEsYUFB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SWpDLFNBQUFrQyxNQUFNLEdBQUloQyxZQUFBaUMsU0FBUyxFQUFHLEVBQUcsSUFBSyxHQUFHRyxnQkFBZ0IsSUFDaEYsR0FBSWxDLFVBQUFtQyxPQUFPLEdBQUlsQyxVQUFBd0IsT0FBTyxLQUFNLEtBQU0sS0FBTSxLQUNuQ0csWUFBWSxHQUFJekIsWUFBQTBCLFNBQVMsR0FBSWpDLFNBQUFrQyxNQUFNLEdBQUloQyxZQUFBaUMsU0FBUyxFQUFHLEVBQUcsSUFBSyxJQUNoRSxHQUFJL0IsVUFBQW1DLE9BQU8sR0FBSWxDLFVBQUF3QixPQUFPLElBQUssS0FBTSxLQUFNLEtBQ2xDRyxZQUFZLEdBQUl6QixZQUFBMEIsU0FBUyxHQUFJakMsU0FBQWtDLE1BQU0sR0FBSWhDLFlBQUFpQyxTQUFTLEVBQUcsSUFBSyxJQUFLLFFBSzlFWCxFQUFPZ0IsT0FBT25CLEVBQUssR0FBSUEsRUFBSyxHQUFJQSxFQUFLLEdBQUlBLEVBQUsiLCJmaWxlIjoiVHJhY2VyV29ya2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9XCJ0cnVlXCIvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cImxpYi9saWIud2Vid29ya2VyLmQudHNcIiAvPlxuXG5pbXBvcnQgeyBDYW1lcmEgfSBmcm9tIFwiLi9DYW1lcmFcIjtcbmltcG9ydCB7IENvbG9yIH0gZnJvbSBcIi4vQ29sb3IvQ29sb3JcIjtcbmltcG9ydCB7IFJheSB9IGZyb20gXCIuL1JheVwiO1xuaW1wb3J0IHsgUkdCQ29sb3IgfSBmcm9tIFwiLi9Db2xvci9SR0JDb2xvclwiO1xuaW1wb3J0IHsgUlRNYXRoIH0gZnJvbSBcIi4vUlRNYXRoXCI7XG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XG5pbXBvcnQgeyBTcGhlcmUgfSBmcm9tIFwiLi9PYmplY3RzL1NwaGVyZVwiO1xuaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSBcIi4vVmVjdG9yXCI7XG5pbXBvcnQgeyBQbGFuZSB9IGZyb20gXCIuL09iamVjdHMvUGxhbmVcIjtcbmltcG9ydCB7IEFic3RyYWN0TGlnaHQgfSBmcm9tIFwiLi9MaWdodHMvQWJzdHJhY3RMaWdodFwiO1xuaW1wb3J0IHsgU3BoZXJpY2FsTGlnaHQgfSBmcm9tIFwiLi9MaWdodHMvU3BoZXJpY2FsTGlnaHRcIjtcbmltcG9ydCB7IE1hdGVyaWFsIH0gZnJvbSBcIi4vTWF0ZXJpYWxcIjtcbmltcG9ydCB7IFBvbHlnb24gfSBmcm9tIFwiLi9PYmplY3RzL1BvbHlnb25cIjtcblxuY2xhc3MgVHJhY2VyIHtcbiAgICBwcml2YXRlIHNjZW5lOiBTY2VuZTtcbiAgICBwcml2YXRlIHJheXNQZXJQaXhlbDogbnVtYmVyID0gODtcbiAgICBwcml2YXRlIHNjcmVlbldpZHRoOiBudW1iZXIgPSAyNTA7XG4gICAgcHJpdmF0ZSBzY3JlZW5IZWlnaHQ6IG51bWJlciA9IDI1MDtcblxuICAgIHByaXZhdGUgZ2V0Q29sb3IgKHJheTogUmF5LCByZWN1cmNpdmU6IGJvb2xlYW4gPSB0cnVlKTogQ29sb3Ige1xuICAgICAgICBsZXQgaW50ZXJzZWN0ID0gdGhpcy50cmFjZShyYXkpLFxuICAgICAgICAgICAgZGlmZnVzZUNvbG9yOiBDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpLFxuICAgICAgICAgICAgcmVmbGVjdENvbG9yOiBDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuXG4gICAgICAgIGlmIChpbnRlcnNlY3RbJ293bmVyJ10gPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRpZmZ1c2VDb2xvciA9IHRoaXMuZ2V0RGlmZnVzZUNvbG9yKHJheSwgaW50ZXJzZWN0LCByZWN1cmNpdmUpO1xuXG4gICAgICAgIGlmIChyZWN1cmNpdmUpIHtcbiAgICAgICAgICAgIHJlZmxlY3RDb2xvciA9IHRoaXMuZ2V0UmVmbGVjdGlvbkNvbG9yKHJheSwgaW50ZXJzZWN0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaWZmdXNlQ29sb3IuYWRkKHJlZmxlY3RDb2xvcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREaWZmdXNlQ29sb3IgKHJheTogUmF5LCBpbnRlcnNlY3Q6IGFueSwgcmVjdXJzaXZlOiBib29sZWFuID0gdHJ1ZSk6IENvbG9yIHtcbiAgICAgICAgY29uc3QgcmFkaWFuY2VTYW1wbGVzID0gNTA7XG4gICAgICAgIFxuICAgICAgICBsZXQgbGFtYkNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJhZGlhbmNlQ29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcGhvbmdDb2xvcjogQ29sb3IsXG4gICAgICAgICAgICBwaXhlbENvbG9yOiBDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpLFxuICAgICAgICAgICAgbGlnaHREaXJlY3Rpb246IFZlY3RvcixcbiAgICAgICAgICAgIHJlZmxlY3RQaG9uZ1ZlY3RvckRpcjogVmVjdG9yLFxuICAgICAgICAgICAgbGFtYkNvczogbnVtYmVyLFxuICAgICAgICAgICAgcGhvbmdDb3M6IG51bWJlcixcbiAgICAgICAgICAgIHBob25nOiBudW1iZXI7XG5cbiAgICAgICAgZm9yIChsZXQgbGlnaHQgb2YgdGhpcy5zY2VuZS5nZXRMaWdodHMoKSkge1xuICAgICAgICAgICAgLy8gaWYgbGlnaHQgLSByZXR1cm4gb25seSBsaWdodCBjb2xvclxuICAgICAgICAgICAgaWYgKGludGVyc2VjdFsnb3duZXJUeXBlJ10gPT09ICdsaWdodCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJzZWN0Wydvd25lciddXG4gICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgbGlnaHRQb3dlciA9IHRoaXMuZ2V0TGlnaHRQb3dlcihpbnRlcnNlY3QsIGxpZ2h0KTtcblxuICAgICAgICAgICAgbGFtYkNvbG9yID0gbmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSk7XG4gICAgICAgICAgICByYWRpYW5jZUNvbG9yID0gbmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSk7XG4gICAgICAgICAgICBwaG9uZ0NvbG9yID0gbmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSk7XG4gICAgICAgICAgICBsaWdodERpcmVjdGlvbiA9IFZlY3Rvci5ub3JtYWxpemVkKFxuICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsncG9pbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0UG9zaXRpb24oKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIGxhbWJlcnRcblxuICAgICAgICAgICAgbGFtYkNvcyA9IC1WZWN0b3IuZG90KFxuICAgICAgICAgICAgICAgIGxpZ2h0RGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgIGludGVyc2VjdFsnbm9ybWFsJ11cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGxhbWJDb2xvciA9IGxhbWJDb2xvci5hZGQoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydvd25lciddXG4gICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgIC5tdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UG93ZXIgKiBsYW1iQ29zICogaW50ZXJzZWN0Wydvd25lciddLmdldE1hdGVyaWFsKCkuZ2V0TGFtYmVydENvZWZmKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChyZWN1cnNpdmUpIHtcbiAgICAgICAgICAgICAgICBsZXQgcmFuZERpciA9IChub3JtYWw6IFZlY3RvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpcjogVmVjdG9yID0gbmV3IFZlY3RvcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpIC0gMC41LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucmFuZG9tKCkgLSAwLjUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5yYW5kb20oKSAtIDAuNVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFZlY3Rvci5kb3QoZGlyLCBkaXIpID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXIgPSBWZWN0b3Iubm9ybWFsaXplZChkaXIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoVmVjdG9yLmRvdChkaXIsIG5vcm1hbCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyID0gVmVjdG9yLmludmVyc2UoZGlyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRpcjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLypsZXQgdTEgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHUyID0gTWF0aC5yYW5kb20oKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNpbl90aGV0YSA9IE1hdGguc3FydCh1MSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29zX3RoZXRhID0gTWF0aC5zcXJ0KDEgLSB1MSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCAgcGhpID0gMiAqIE1hdGguUEkgKiB1MjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpcjogVmVjdG9yID0gbmV3IFZlY3RvcihzaW5fdGhldGEgKiBNYXRoLkNvcyhwaGkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvc190aGV0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW5fdGhldGEgKiBNYXRoLlNpbihwaGkpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRhbmdlbnQ6IFZlY3RvcjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vcm1hbC54ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YW5nZW50ID0gbmV3IFZlY3RvcigxLCAwLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFuZ2VudCA9IFZlY3Rvci5ub3JtYWxpemVkKG5ldyBWZWN0b3Iobm9ybWFsLnosIDAsIC1ub3JtYWwueCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYml0YW5nZW50OiBWZWN0b3IgPSBWZWN0b3IuY3Jvc3ModGFuZ2VudCwgbm9ybWFsKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGJhc2lzVHJhbnNmb3JtID0gbmV3IE1hdHJpeCh0YW5nZW50LCBub3JtYWwsIGJpdGFuZ2VudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBWZWN0b3Iubm9ybWFsaXplZChiYXNpc1RyYW5zZm9ybSAqIGRpcik7Ki9cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJhZGlhbmNlU2FtcGxlczsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBkaXI6IFZlY3RvciA9IHJhbmREaXIoaW50ZXJzZWN0Wydvd25lciddLmdldE5vcm1hbChpbnRlcnNlY3RbJ3BvaW50J10pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlSW5UaGF0RGlyOiBDb2xvciA9IHRoaXMuZ2V0Q29sb3IobmV3IFJheShpbnRlcnNlY3RbJ3BvaW50J10sIGRpciksIGZhbHNlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvc0k6IG51bWJlciA9IFZlY3Rvci5kb3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXS5nZXROb3JtYWwoaW50ZXJzZWN0Wydwb2ludCddKVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICByYWRpYW5jZUNvbG9yID0gcmFkaWFuY2VDb2xvclxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ293bmVyJ11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRpdmlkZShNYXRoLlBJKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubXVsdGlwbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpYW5jZUluVGhhdERpclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZWQoY29zSSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBwaG9uZ1xuXG4gICAgICAgICAgICByZWZsZWN0UGhvbmdWZWN0b3JEaXIgPSBWZWN0b3IucmVmbGVjdChcbiAgICAgICAgICAgICAgICBsaWdodERpcmVjdGlvbixcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ25vcm1hbCddXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcGhvbmdDb3MgPSAtVmVjdG9yLmRvdChyZWZsZWN0UGhvbmdWZWN0b3JEaXIsIHJheS5nZXREaXJlY3Rpb24oKSk7XG5cbiAgICAgICAgICAgIGlmIChwaG9uZ0NvcyA+IDApIHtcbiAgICAgICAgICAgICAgICBwaG9uZyA9IE1hdGgucG93KHBob25nQ29zLCAzNSk7XG4gICAgICAgICAgICAgICAgcGhvbmdDb2xvciA9IHBob25nQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ293bmVyJ11cbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm11bHRpcGxlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNjYWxlZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UG93ZXIgKiBwaG9uZyAqIGludGVyc2VjdFsnb3duZXInXS5nZXRNYXRlcmlhbCgpLmdldFBob25nQ29lZmYoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGl4ZWxDb2xvciA9IHBpeGVsQ29sb3IuYWRkKGxhbWJDb2xvci5hZGQocmFkaWFuY2VDb2xvci5kaXZpZGUocmFkaWFuY2VTYW1wbGVzKSkpLmFkZChwaG9uZ0NvbG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwaXhlbENvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVmbGVjdGlvbkNvbG9yIChyYXk6IFJheSwgaW50ZXJzZWN0OiBhbnkpOiBhbnkge1xuICAgICAgICBsZXQgcmVmbGVjdGlvbkNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJlZmxlY3Rpb25WYWx1ZTogbnVtYmVyID0gaW50ZXJzZWN0Wydvd25lciddLmdldE1hdGVyaWFsKCkuZ2V0UmVmbGVjdGlvblZhbHVlKCksXG4gICAgICAgICAgICByZWZsZWN0ZWRSYXk6IFZlY3RvcjtcblxuICAgICAgICByYXkuc2V0SXRlcmF0aW9uKHJheS5nZXRJdGVyYXRpb24oKSAtIDEpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHJheS5nZXRJdGVyYXRpb24oKSA9PT0gMCB8fFxuICAgICAgICAgICAgcmVmbGVjdGlvblZhbHVlID09PSAwXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVmbGVjdGVkUmF5ID0gVmVjdG9yLnJlZmxlY3QoXG4gICAgICAgICAgICByYXkuZ2V0RGlyZWN0aW9uKCksXG4gICAgICAgICAgICBpbnRlcnNlY3RbJ25vcm1hbCddXG4gICAgICAgICk7XG5cbiAgICAgICAgcmVmbGVjdGlvbkNvbG9yID0gdGhpcy5nZXRDb2xvcihcbiAgICAgICAgICAgIG5ldyBSYXkoaW50ZXJzZWN0Wydwb2ludCddLCByZWZsZWN0ZWRSYXksIHJheS5nZXRJdGVyYXRpb24oKSlcbiAgICAgICAgKS5zY2FsZWQocmVmbGVjdGlvblZhbHVlKTtcblxuICAgICAgICByZXR1cm4gcmVmbGVjdGlvbkNvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UGVyc3BlY3RpdmVWZWN0b3IgKHg6IG51bWJlciwgeTogbnVtYmVyLCBzY3JlZW5XaWR0aDogbnVtYmVyLCBzY3JlZW5IZWlnaHQ6IG51bWJlcikge1xuICAgICAgICBsZXQgY2FtZXJhOiBDYW1lcmEgPSB0aGlzLnNjZW5lLmdldENhbWVyYSgpO1xuXG4gICAgICAgIHJldHVybiBWZWN0b3Iubm9ybWFsaXplZChcbiAgICAgICAgICAgIFZlY3Rvci5hZGQoXG4gICAgICAgICAgICAgICAgY2FtZXJhLmdldEZvcndhcmRWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICBWZWN0b3IuYWRkKFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc2NhbGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLmdldFJpZ2h0VmVjdG9yKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEucmVjZW50ZXJYKHgpXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEuZ2V0VXBWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5yZWNlbnRlclkoeSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldExpZ2h0UG93ZXIgKGludGVyc2VjdDogYW55LCBsaWdodDogQWJzdHJhY3RMaWdodCk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IHNhbXBsaW5nID0gMjAwO1xuXG4gICAgICAgIGxldCBsaWdodFBvd2VyID0gbGlnaHQuZ2V0UG93ZXIoKSxcbiAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnQ6IFZlY3RvcixcbiAgICAgICAgICAgIHJlc3VsdFBvd2VyID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNhbXBsaW5nOyBpKyspIHtcbiAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnQgPSBsaWdodC5nZXRSYW5kb21Qb2ludCgpO1xuXG4gICAgICAgICAgICBsZXQgbGlnaHRSYXkgPSB0aGlzLnRyYWNlKFxuICAgICAgICAgICAgICAgIG5ldyBSYXkoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsncG9pbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50XG4gICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydwb2ludCddXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAobGlnaHRSYXlbJ3BvaW50J10gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGxpZ2h0UmF5Wydvd25lciddICE9PSBsaWdodCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXN1bHRQb3dlciArPSAoXG4gICAgICAgICAgICAgICAgbGlnaHRQb3dlciAtXG4gICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ3BvaW50J11cbiAgICAgICAgICAgICAgICAgICAgKS5nZXRMZW5ndGgoKSAqIChsaWdodFBvd2VyIC8gbGlnaHQuZ2V0RmFkZVJhZGl1cygpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkgLyBzYW1wbGluZztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRQb3dlcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyYWNlIChyYXk6IFJheSk6IHtkaXN0YW5jZTogbnVtYmVyLCBwb2ludDogVmVjdG9yLCBvd25lcjogYW55LCBvd25lclR5cGU6IHN0cmluZ30ge1xuICAgICAgICBsZXQgcmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIGRpc3RhbmNlOiAwLFxuICAgICAgICAgICAgICAgIHBvaW50OiBudWxsLFxuICAgICAgICAgICAgICAgIG5vcm1hbDogbnVsbCxcbiAgICAgICAgICAgICAgICBvd25lcjogbnVsbCxcbiAgICAgICAgICAgICAgICBvd25lclR5cGU6IG51bGxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnRlcnNlY3REYXRhOiBhbnksXG4gICAgICAgICAgICBzY2VuZU9iamVjdHNXaXRoTGlnaHRzOiBhbnlbXSA9IHRoaXMuc2NlbmUuZ2V0T2JqZWN0cygpLmNvbmNhdCh0aGlzLnNjZW5lLmdldExpZ2h0cygpKTtcblxuICAgICAgICBmb3IgKGxldCBvYmplY3Qgb2Ygc2NlbmVPYmplY3RzV2l0aExpZ2h0cykge1xuICAgICAgICAgICAgaW50ZXJzZWN0RGF0YSA9IG9iamVjdC5nZXRJbnRlcnNlY3REYXRhKHJheSk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3REYXRhICYmXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXSA+IDAgJiZcbiAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFsnb3duZXInXSA9PT0gbnVsbCB8fFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3REYXRhWydkaXN0YW5jZSddIDwgcmVzdWx0WydkaXN0YW5jZSddXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0WydkaXN0YW5jZSddID0gaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXTtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ3BvaW50J10gPSBpbnRlcnNlY3REYXRhWydwb2ludCddO1xuICAgICAgICAgICAgICAgIHJlc3VsdFsnb3duZXInXSA9IG9iamVjdDtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ293bmVyVHlwZSddID0gb2JqZWN0LmdldFR5cGUoKTtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ25vcm1hbCddID0gcmVzdWx0Wydvd25lciddLmdldE5vcm1hbChyZXN1bHRbJ3BvaW50J10pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVuZGVyIChzY3JlZW5XaWR0aDogbnVtYmVyLCBzY3JlZW5IZWlnaHQ6IG51bWJlciwgeDogbnVtYmVyLCB5OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmFuZG9NdWx0aXBsaWVyID0gMC41O1xuXG4gICAgICAgIGxldCBjb2xvcjogQ29sb3IsXG4gICAgICAgICAgICByYW5kOiBudW1iZXIsXG4gICAgICAgICAgICByYXk6IFJheSxcbiAgICAgICAgICAgIHJnYkNvbG9yOiB7XG4gICAgICAgICAgICAgICAgcmVkOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgZ3JlZW46IG51bWJlcixcbiAgICAgICAgICAgICAgICBibHVlOiBudW1iZXJcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5zY3JlZW5XaWR0aCA9IHNjcmVlbldpZHRoO1xuICAgICAgICB0aGlzLnNjcmVlbkhlaWdodCA9IHNjcmVlbkhlaWdodDtcblxuICAgICAgICBjb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuXG4gICAgICAgIGZvciAobGV0IGl0ZXIgPSAwOyBpdGVyIDwgdGhpcy5yYXlzUGVyUGl4ZWw7IGl0ZXIrKykge1xuICAgICAgICAgICAgcmFuZCA9IDA7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnJheXNQZXJQaXhlbCA+IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlciAlIDIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZCArPSBNYXRoLnJhbmRvbSgpICogcmFuZG9NdWx0aXBsaWVyO1xuICAgICAgICAgICAgICAgIH0gIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByYW5kIC09IE1hdGgucmFuZG9tKCkgKiByYW5kb011bHRpcGxpZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByYXkgPSBuZXcgUmF5KFxuICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuZ2V0Q2FtZXJhKCkuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICB0aGlzLmdldFBlcnNwZWN0aXZlVmVjdG9yKHggKyByYW5kLCB5ICsgcmFuZCwgc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbG9yID0gY29sb3IuYWRkKHRoaXMuZ2V0Q29sb3IocmF5KSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb2xvciA9IGNvbG9yLmRpdmlkZSh0aGlzLnJheXNQZXJQaXhlbCk7XG5cbiAgICAgICAgZm9yIChsZXQgY29tcG9uZW50IGluIGNvbG9yKSB7XG4gICAgICAgICAgICBjb2xvcltjb21wb25lbnRdID0gQ29sb3Iuc1JHQkVuY29kZShjb2xvcltjb21wb25lbnRdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJnYkNvbG9yID0gQ29sb3IudG9SR0IoY29sb3IpO1xuXG4gICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoW3gsIHksIHJnYkNvbG9yLnJlZCwgcmdiQ29sb3IuZ3JlZW4sIHJnYkNvbG9yLmJsdWVdKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0U2NlbmUgKHNjZW5lOiBTY2VuZSk6IHZvaWQge1xuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XG4gICAgfVxufVxuXG5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIHZhciBkYXRhID0gbWVzc2FnZS5kYXRhO1xuXG4gICAgaWYgKHR5cGVvZihkYXRhKSA9PSAnc3RyaW5nJykge1xuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZSgnWycrZGF0YSsnXScpO1xuICAgIH1cblxuICAgIGxldCB0cmFjZXIgPSBuZXcgVHJhY2VyKCk7XG5cbiAgICB0cmFjZXIuc2V0U2NlbmUoXG4gICAgICAgIG5ldyBTY2VuZSh7XG4gICAgICAgICAgICBjYW1lcmE6IG5ldyBDYW1lcmEoXG4gICAgICAgICAgICAgICAgbmV3IFZlY3RvcigwLCAwLCAtNjk5KSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDAsIDAsIDEpLFxuICAgICAgICAgICAgICAgIGRhdGFbMF0sXG4gICAgICAgICAgICAgICAgZGF0YVsxXVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGxpZ2h0czogW1xuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmljYWxMaWdodChuZXcgVmVjdG9yICgwLCA2NDAsIDApLCAxLjIsIDUwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjU1LCAyNTUsIDI1NSkpKSlcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBvYmplY3RzOiBbXG4gICAgICAgICAgICAgICAgLy9uZXcgUGxhbmUobmV3IFZlY3RvcigwLCAxLCAwKSwgLTQwMCkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMTE1LCAxMTUsIDExNSkpLCAwKSksXG4gICAgICAgICAgICAgICAgLy8gYm90dG9tIHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjU1LCAyNTUsIDI1NSkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vIGZyb250IHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDI1NSwgMjU1KSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy8gdG9wIHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIC03MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDI1NSwgMjU1KSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy9yaWdodCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMjU1KSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy9sZWZ0IHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjU1LCAwLCAwKSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy8gYmFjayBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICBuZXcgU3BoZXJlKG5ldyBWZWN0b3IoLTI1MCwgLTUwMCwgNDUwKSwgMjAwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpLCAxKSksXG4gICAgICAgICAgICAgICAgbmV3IFNwaGVyZShuZXcgVmVjdG9yKDI1MCwgLTUwMCwgNDAwKSwgMjAwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMjU1LCAwKSksIDApKVxuICAgICAgICAgICAgXVxuICAgICAgICB9KVxuICAgICk7XG5cbiAgICB0cmFjZXIucmVuZGVyKGRhdGFbMF0sIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM10pO1xufTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
