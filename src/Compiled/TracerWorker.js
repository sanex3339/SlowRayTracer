var AbstractLight_1=require("./Lights/AbstractLight"),Camera_1=require("./Camera"),Color_1=require("./Color/Color"),IntersectPoint_1=require("./IntersectPoint"),Material_1=require("./Material"),Polygon_1=require("./Objects/Polygon"),Ray_1=require("./Ray"),RGBColor_1=require("./Color/RGBColor"),Scene_1=require("./Scene"),Sphere_1=require("./Objects/Sphere"),SphericalLight_1=require("./Lights/SphericalLight"),Vector_1=require("./Vector"),Tracer=function(){function e(){this.pixelSamples=4,this.shadowSamples=50,this.giSamples=50,this.aoSamples=50,this.screenWidth=250,this.screenHeight=250}return e.prototype.cosineSampleHemisphere=function(e){var t,r,o=Math.random(),a=Math.random(),c=Math.sqrt(o),i=2*Math.PI*a;return t=Math.abs(e.getCoordinates().x)<.5?Vector_1.Vector.cross(e,new Vector_1.Vector(1,0,0)):Vector_1.Vector.cross(e,new Vector_1.Vector(0,1,0)),r=Vector_1.Vector.cross(e,t),Vector_1.Vector.add(Vector_1.Vector.scale(e,Math.sqrt(1-o)),Vector_1.Vector.add(Vector_1.Vector.scale(t,c*Math.cos(i)),Vector_1.Vector.scale(r,c*Math.sin(i))))},e.prototype.getColor=function(e,t){void 0===t&&(t=!0);var r=this.trace(e),o=Color_1.Color.black,a=Color_1.Color.black;return r.getIntersect()?(o=this.getDiffuseColor(e,r,t),t&&(a=this.getReflectionColor(e,r)),o.add(a)):Color_1.Color.black},e.prototype.getDiffuseColor=function(e,t,r){void 0===r&&(r=!0);for(var o,a,c,i,n,l,s,g,_,V,h=Color_1.Color.black,w=0,C=this.scene.getLights();w<C.length;w++){var p=C[w];if(t.getOwner()instanceof AbstractLight_1.AbstractLight)return t.getOwner().getMaterial().getColor();if(l=this.getLightPower(t,p),o=Color_1.Color.black,a=Color_1.Color.black,c=Color_1.Color.black,n=Vector_1.Vector.normalize(Vector_1.Vector.substract(t.getHitPoint(),p.getPosition())),r)for(var d=0;d<this.giSamples;d++){var m=void 0;i=this.cosineSampleHemisphere(t.getOwner().getNormal(t.getHitPoint())),m=this.getColor(new Ray_1.Ray(t.getHitPoint(),i),!1),c=c.add(m)}c=c.divide(this.giSamples),g=-Vector_1.Vector.dot(n,t.getNormal()),o=o.add(t.getOwner().getMaterial().getColor().add(c).multiple(p.getMaterial().getColor().scaled(l*g*t.getOwner().getMaterial().getLambertCoeff()))),s=Vector_1.Vector.reflect(n,t.getNormal()),_=-Vector_1.Vector.dot(s,e.getDirection()),_>0&&(V=Math.pow(_,35),a=a.add(t.getOwner().getMaterial().getColor().multiple(p.getMaterial().getColor().scaled(l*V*t.getOwner().getMaterial().getPhongCoeff()))));for(var M=0,d=0;d<this.aoSamples;d++){var f=this.cosineSampleHemisphere(t.getOwner().getNormal(t.getHitPoint())),u=this.trace(new Ray_1.Ray(t.getHitPoint(),f));u.getIntersect()&&(u.getDistanceFromOrigin()>200||M++)}h=h.add(o.multiple(Color_1.Color.white.scaled(1-.67*M/this.aoSamples)).add(a))}return h},e.prototype.getReflectionColor=function(e,t){var r,o,a=e.getIteration(),c=t.getOwner().getMaterial().getReflectionValue();return e.setIteration(--a),0===a||0===c?Color_1.Color.black:(o=Vector_1.Vector.reflect(e.getDirection(),t.getNormal()),r=this.getColor(new Ray_1.Ray(t.getHitPoint(),o,a)).scaled(c))},e.prototype.getPerspectiveVector=function(e,t){var r=this.scene.getCamera();return Vector_1.Vector.normalize(Vector_1.Vector.add(r.getForwardVector(),Vector_1.Vector.add(Vector_1.Vector.scale(r.getRightVector(),r.recenterX(e)),Vector_1.Vector.scale(r.getUpVector(),r.recenterY(t)))))},e.prototype.getLightPower=function(e,t){for(var r,o,a=t.getPower(),c=0,i=0;i<this.shadowSamples;i++)r=t.getRandomPoint(),o=this.trace(new Ray_1.Ray(e.getHitPoint(),Vector_1.Vector.substract(Vector_1.Vector.substract(t.getPosition(),r),e.getHitPoint()))),o.getIntersect()&&o.getOwner()instanceof AbstractLight_1.AbstractLight&&(c+=(a-Vector_1.Vector.substract(Vector_1.Vector.substract(t.getPosition(),r),e.getHitPoint()).getLength()*(a/t.getFadeRadius()))/this.shadowSamples);return c},e.prototype.trace=function(e){for(var t,r=new IntersectPoint_1.IntersectPoint,o=1/0,a=this.scene.getObjects().concat(this.scene.getLights()),c=0,i=a;c<i.length;c++){var n=i[c];t=n.getIntersectData(e),t&&t.distance<o&&(o=t.distance,r.setIntersect(),r.setHitPoint(t.hitPoint),r.setNormal(t.normal),r.setDistanceFromOrigin(t.distance),r.setOwner(n))}return r},e.prototype.render=function(e,t,r,o){var a,c,i,n=.5,l=Color_1.Color.black;this.screenWidth=e,this.screenHeight=t;for(var s=0;s<this.pixelSamples;s++)a=0,this.pixelSamples>1&&(s%2?a+=Math.random()*n:a-=Math.random()*n),c=new Ray_1.Ray(this.scene.getCamera().getPosition(),this.getPerspectiveVector(r+a,o+a)),l=l.add(this.getColor(c));l=l.divide(this.pixelSamples);for(var g in l)l[g]=Color_1.Color.sRGBEncode(l[g]);i=Color_1.Color.toRGB(l),self.postMessage([r,o,i.red,i.green,i.blue])},e.prototype.setScene=function(e){this.scene=e},e}();onmessage=function(e){var t=e.data;"string"==typeof t&&(t=JSON.parse("["+t+"]"));var r=new Tracer;r.setScene(new Scene_1.Scene({camera:new Camera_1.Camera(new Vector_1.Vector(0,0,-699),new Vector_1.Vector(0,0,1),t[0],t[1]),lights:[new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,600,0),.6,100).setMaterial(new Material_1.Material(Color_1.Color.white)),new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,0,0),.6,150).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,235,200))))],objects:[new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(-700,-700,700)).setMaterial(new Material_1.Material(Color_1.Color.white,0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(-700,700,700)).setMaterial(new Material_1.Material(Color_1.Color.white,0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(700,700,-700),new Vector_1.Vector(-700,700,-700)).setMaterial(new Material_1.Material(Color_1.Color.white,0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,700,-700),new Vector_1.Vector(700,700,700)).setMaterial(new Material_1.Material(Color_1.Color.blue).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(-700,700,-700)).setMaterial(new Material_1.Material(Color_1.Color.red,0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(Color_1.Color.black,0).setLambertCoeff(1)),new Sphere_1.Sphere(new Vector_1.Vector(-250,-500,450),200).setMaterial(new Material_1.Material(Color_1.Color.black,1)),new Sphere_1.Sphere(new Vector_1.Vector(250,-500,400),200).setMaterial(new Material_1.Material(Color_1.Color.green,0))]})),r.render(t[0],t[1],t[2],t[3])};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRyYWNlcldvcmtlci50cyJdLCJuYW1lcyI6WyJBYnN0cmFjdExpZ2h0XzEiLCJyZXF1aXJlIiwiQ2FtZXJhXzEiLCJDb2xvcl8xIiwiSW50ZXJzZWN0UG9pbnRfMSIsIk1hdGVyaWFsXzEiLCJQb2x5Z29uXzEiLCJSYXlfMSIsIlJHQkNvbG9yXzEiLCJTY2VuZV8xIiwiU3BoZXJlXzEiLCJTcGhlcmljYWxMaWdodF8xIiwiVmVjdG9yXzEiLCJUcmFjZXIiLCJUcmFjZXIuY29uc3RydWN0b3IiLCJUcmFjZXIuY29zaW5lU2FtcGxlSGVtaXNwaGVyZSIsIlRyYWNlci5nZXRDb2xvciIsIlRyYWNlci5nZXREaWZmdXNlQ29sb3IiLCJUcmFjZXIuZ2V0UmVmbGVjdGlvbkNvbG9yIiwiVHJhY2VyLmdldFBlcnNwZWN0aXZlVmVjdG9yIiwiVHJhY2VyLmdldExpZ2h0UG93ZXIiLCJUcmFjZXIudHJhY2UiLCJUcmFjZXIucmVuZGVyIiwiVHJhY2VyLnNldFNjZW5lIiwib25tZXNzYWdlIiwibWVzc2FnZSIsImRhdGEiLCJKU09OIiwicGFyc2UiLCJ0cmFjZXIiLCJzZXRTY2VuZSIsIlNjZW5lIiwiY2FtZXJhIiwiQ2FtZXJhIiwiVmVjdG9yIiwibGlnaHRzIiwiU3BoZXJpY2FsTGlnaHQiLCJzZXRNYXRlcmlhbCIsIk1hdGVyaWFsIiwiQ29sb3IiLCJ3aGl0ZSIsIlJHQkNvbG9yIiwib2JqZWN0cyIsIlBvbHlnb24iLCJzZXRMYW1iZXJ0Q29lZmYiLCJibHVlIiwicmVkIiwiYmxhY2siLCJTcGhlcmUiLCJncmVlbiIsInJlbmRlciJdLCJtYXBwaW5ncyI6IkFBR0EsR0FBQUEsaUJBQUFDLFFBQThCLDBCQUU5QkMsU0FBQUQsUUFBdUIsWUFDdkJFLFFBQUFGLFFBQXNCLGlCQUN0QkcsaUJBQUFILFFBQStCLG9CQUMvQkksV0FBQUosUUFBeUIsY0FFekJLLFVBQUFMLFFBQXdCLHFCQUN4Qk0sTUFBQU4sUUFBb0IsU0FDcEJPLFdBQUFQLFFBQXlCLG9CQUV6QlEsUUFB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TUFDdEIsR0FBSXRCLFVBQUFzQixPQUFPLEtBQU0sS0FBTSxNQUN2QixHQUFJdEIsVUFBQXNCLE9BQU8sS0FBTSxJQUFLLE1BQ3RCLEdBQUl0QixVQUFBc0IsT0FBTyxJQUFLLElBQUssT0FDdkJHLFlBQVksR0FBSWhDLFlBQUFpQyxTQUFTbkMsUUFBQW9DLE1BQU1RLE1BQU8sR0FBR0gsZ0JBQWdCLElBQzNELEdBQUlsQyxVQUFBc0MsT0FBTyxHQUFJcEMsVUFBQXNCLE9BQU8sS0FBTSxLQUFNLEtBQU0sS0FDbkNHLFlBQVksR0FBSWhDLFlBQUFpQyxTQUFTbkMsUUFBQW9DLE1BQU1RLE1BQU8sSUFDM0MsR0FBSXJDLFVBQUFzQyxPQUFPLEdBQUlwQyxVQUFBc0IsT0FBTyxJQUFLLEtBQU0sS0FBTSxLQUNsQ0csWUFBWSxHQUFJaEMsWUFBQWlDLFNBQVNuQyxRQUFBb0MsTUFBTVUsTUFBTyxRQUt2RHBCLEVBQU9xQixPQUFPeEIsRUFBSyxHQUFJQSxFQUFLLEdBQUlBLEVBQUssR0FBSUEsRUFBSyIsImZpbGUiOiJUcmFjZXJXb3JrZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBuby1kZWZhdWx0LWxpYj1cInRydWVcIi8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwibGliL2xpYi53ZWJ3b3JrZXIuZC50c1wiIC8+XG5cbmltcG9ydCB7IEFic3RyYWN0TGlnaHQgfSBmcm9tIFwiLi9MaWdodHMvQWJzdHJhY3RMaWdodFwiO1xuaW1wb3J0IHsgQWJzdHJhY3RPYmplY3QgfSBmcm9tIFwiLi9PYmplY3RzL0Fic3RyYWN0T2JqZWN0XCI7XG5pbXBvcnQgeyBDYW1lcmEgfSBmcm9tIFwiLi9DYW1lcmFcIjtcbmltcG9ydCB7IENvbG9yIH0gZnJvbSBcIi4vQ29sb3IvQ29sb3JcIjtcbmltcG9ydCB7IEludGVyc2VjdFBvaW50IH0gZnJvbSBcIi4vSW50ZXJzZWN0UG9pbnRcIjtcbmltcG9ydCB7IE1hdGVyaWFsIH0gZnJvbSBcIi4vTWF0ZXJpYWxcIjtcbmltcG9ydCB7IFBsYW5lIH0gZnJvbSBcIi4vT2JqZWN0cy9QbGFuZVwiO1xuaW1wb3J0IHsgUG9seWdvbiB9IGZyb20gXCIuL09iamVjdHMvUG9seWdvblwiO1xuaW1wb3J0IHsgUmF5IH0gZnJvbSBcIi4vUmF5XCI7XG5pbXBvcnQgeyBSR0JDb2xvciB9IGZyb20gXCIuL0NvbG9yL1JHQkNvbG9yXCI7XG5pbXBvcnQgeyBSVE1hdGggfSBmcm9tIFwiLi9SVE1hdGhcIjtcbmltcG9ydCB7IFNjZW5lIH0gZnJvbSBcIi4vU2NlbmVcIjtcbmltcG9ydCB7IFNwaGVyZSB9IGZyb20gXCIuL09iamVjdHMvU3BoZXJlXCI7XG5pbXBvcnQgeyBTcGhlcmljYWxMaWdodCB9IGZyb20gXCIuL0xpZ2h0cy9TcGhlcmljYWxMaWdodFwiO1xuaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSBcIi4vVmVjdG9yXCI7XG5cbmNsYXNzIFRyYWNlciB7XG4gICAgcHJpdmF0ZSBzY2VuZTogU2NlbmU7XG4gICAgcHJpdmF0ZSBwaXhlbFNhbXBsZXM6IG51bWJlciA9IDQ7XG4gICAgcHJpdmF0ZSBzaGFkb3dTYW1wbGVzOiBudW1iZXIgPSA1MDtcbiAgICBwcml2YXRlIGdpU2FtcGxlczogbnVtYmVyID0gNTA7XG4gICAgcHJpdmF0ZSBhb1NhbXBsZXM6IG51bWJlciA9IDUwO1xuICAgIHByaXZhdGUgc2NyZWVuV2lkdGg6IG51bWJlciA9IDI1MDtcbiAgICBwcml2YXRlIHNjcmVlbkhlaWdodDogbnVtYmVyID0gMjUwO1xuXG4gICAgcHJpdmF0ZSBjb3NpbmVTYW1wbGVIZW1pc3BoZXJlIChub3JtYWw6IFZlY3Rvcik6IFZlY3RvciB7XG4gICAgICAgIGxldCB1ID0gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgbGV0IHYgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgICBsZXQgciA9IE1hdGguc3FydCh1KTtcbiAgICAgICAgbGV0IGFuZ2xlID0gMiAqIE1hdGguUEkgKiB2O1xuXG4gICAgICAgIGxldCBzZGlyLFxuICAgICAgICAgICAgdGRpcjtcblxuICAgICAgICBpZiAoTWF0aC5hYnMobm9ybWFsLmdldENvb3JkaW5hdGVzKClbJ3gnXSkgPCAwLjUpIHtcbiAgICAgICAgICAgIHNkaXIgPSBWZWN0b3IuY3Jvc3Mobm9ybWFsLCBuZXcgVmVjdG9yKDEsMCwwKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZGlyID0gVmVjdG9yLmNyb3NzKG5vcm1hbCwgbmV3IFZlY3RvcigwLDEsMCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGRpciA9IFZlY3Rvci5jcm9zcyhub3JtYWwsIHNkaXIpO1xuXG4gICAgICAgIHJldHVybiBWZWN0b3IuYWRkKFxuICAgICAgICAgICAgVmVjdG9yLnNjYWxlKG5vcm1hbCwgIE1hdGguc3FydCgxIC0gdSkpLFxuICAgICAgICAgICAgVmVjdG9yLmFkZChcbiAgICAgICAgICAgICAgICBWZWN0b3Iuc2NhbGUoc2RpciwgciAqIE1hdGguY29zKGFuZ2xlKSksXG4gICAgICAgICAgICAgICAgVmVjdG9yLnNjYWxlKHRkaXIsIHIgKiBNYXRoLnNpbihhbmdsZSkpXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDb2xvciAocmF5OiBSYXksIHJlY3VyY2l2ZTogYm9vbGVhbiA9IHRydWUpOiBDb2xvciB7XG4gICAgICAgIGxldCBpbnRlcnNlY3Rpb24gPSB0aGlzLnRyYWNlKHJheSksXG4gICAgICAgICAgICBkaWZmdXNlQ29sb3I6IENvbG9yID0gQ29sb3IuYmxhY2ssXG4gICAgICAgICAgICByZWZsZWN0Q29sb3I6IENvbG9yID0gQ29sb3IuYmxhY2s7XG5cbiAgICAgICAgaWYgKCFpbnRlcnNlY3Rpb24uZ2V0SW50ZXJzZWN0KCkpIHtcbiAgICAgICAgICAgIHJldHVybiBDb2xvci5ibGFjaztcbiAgICAgICAgfVxuXG4gICAgICAgIGRpZmZ1c2VDb2xvciA9IHRoaXMuZ2V0RGlmZnVzZUNvbG9yKHJheSwgaW50ZXJzZWN0aW9uLCByZWN1cmNpdmUpO1xuXG4gICAgICAgIGlmIChyZWN1cmNpdmUpIHtcbiAgICAgICAgICAgIHJlZmxlY3RDb2xvciA9IHRoaXMuZ2V0UmVmbGVjdGlvbkNvbG9yKHJheSwgaW50ZXJzZWN0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaWZmdXNlQ29sb3IuYWRkKHJlZmxlY3RDb2xvcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREaWZmdXNlQ29sb3IgKHJheTogUmF5LCBpbnRlcnNlY3Q6IGFueSwgcmVjdXJzaXZlOiBib29sZWFuID0gdHJ1ZSk6IENvbG9yIHtcbiAgICAgICAgbGV0IGxhbWJDb2xvcjogQ29sb3IsXG4gICAgICAgICAgICBwaG9uZ0NvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJhZGlhbmNlQ29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcGl4ZWxDb2xvcjogQ29sb3IgPSBDb2xvci5ibGFjayxcbiAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uOiBWZWN0b3IsXG4gICAgICAgICAgICBsaWdodERpcmVjdGlvbjogVmVjdG9yLFxuICAgICAgICAgICAgbGlnaHRQb3dlcjogbnVtYmVyLFxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyOiBWZWN0b3IsXG4gICAgICAgICAgICBsYW1iQ29zOiBudW1iZXIsXG4gICAgICAgICAgICBwaG9uZ0NvczogbnVtYmVyLFxuICAgICAgICAgICAgcGhvbmc6IG51bWJlcjtcblxuICAgICAgICBmb3IgKGxldCBsaWdodCBvZiB0aGlzLnNjZW5lLmdldExpZ2h0cygpKSB7XG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0LmdldE93bmVyKCkgaW5zdGFuY2VvZiBBYnN0cmFjdExpZ2h0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGludGVyc2VjdC5nZXRPd25lcigpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaWdodFBvd2VyID0gdGhpcy5nZXRMaWdodFBvd2VyKGludGVyc2VjdCwgbGlnaHQpO1xuXG4gICAgICAgICAgICBsYW1iQ29sb3IgPSBDb2xvci5ibGFjaztcbiAgICAgICAgICAgIHBob25nQ29sb3IgPSBDb2xvci5ibGFjaztcbiAgICAgICAgICAgIHJhZGlhbmNlQ29sb3IgPSBDb2xvci5ibGFjaztcblxuICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24gPSBWZWN0b3Iubm9ybWFsaXplKFxuICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXRIaXRQb2ludCgpLFxuICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy9naVxuICAgICAgICAgICAgaWYgKHJlY3Vyc2l2ZSkge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5naVNhbXBsZXM7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmFkaWFuY2VJblJhbmRvbURpcmVjdGlvbjogQ29sb3I7XG5cbiAgICAgICAgICAgICAgICAgICAgcmFkaWFuY2VSYW5kb21EaXJlY3Rpb24gPSB0aGlzLmNvc2luZVNhbXBsZUhlbWlzcGhlcmUoXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0T3duZXIoKS5nZXROb3JtYWwoaW50ZXJzZWN0LmdldEhpdFBvaW50KCkpXG4gICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmFkaWFuY2VJblJhbmRvbURpcmVjdGlvbiA9IHRoaXMuZ2V0Q29sb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmF5KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXRIaXRQb2ludCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICByYWRpYW5jZUNvbG9yID0gcmFkaWFuY2VDb2xvclxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZChyYWRpYW5jZUluUmFuZG9tRGlyZWN0aW9uKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmFkaWFuY2VDb2xvciA9IHJhZGlhbmNlQ29sb3IuZGl2aWRlKHRoaXMuZ2lTYW1wbGVzKTtcblxuICAgICAgICAgICAgLy8gbGFtYmVydFxuXG4gICAgICAgICAgICBsYW1iQ29zID0gLVZlY3Rvci5kb3QoXG4gICAgICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldE5vcm1hbCgpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBsYW1iQ29sb3IgPSBsYW1iQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgIGludGVyc2VjdFxuICAgICAgICAgICAgICAgICAgICAuZ2V0T3duZXIoKVxuICAgICAgICAgICAgICAgICAgICAuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAuYWRkKHJhZGlhbmNlQ29sb3IpXG4gICAgICAgICAgICAgICAgICAgIC5tdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UG93ZXIgKiBsYW1iQ29zICogaW50ZXJzZWN0LmdldE93bmVyKCkuZ2V0TWF0ZXJpYWwoKS5nZXRMYW1iZXJ0Q29lZmYoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gcGhvbmdcblxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyID0gVmVjdG9yLnJlZmxlY3QoXG4gICAgICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldE5vcm1hbCgpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcGhvbmdDb3MgPSAtVmVjdG9yLmRvdChyZWZsZWN0UGhvbmdWZWN0b3JEaXIsIHJheS5nZXREaXJlY3Rpb24oKSk7XG5cbiAgICAgICAgICAgIGlmIChwaG9uZ0NvcyA+IDApIHtcbiAgICAgICAgICAgICAgICBwaG9uZyA9IE1hdGgucG93KHBob25nQ29zLCAzNSk7XG4gICAgICAgICAgICAgICAgcGhvbmdDb2xvciA9IHBob25nQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0T3duZXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAubXVsdGlwbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRQb3dlciAqIHBob25nICogaW50ZXJzZWN0LmdldE93bmVyKCkuZ2V0TWF0ZXJpYWwoKS5nZXRQaG9uZ0NvZWZmKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vYW1iaWVudCBvY2NsdXNpb25cbiAgICAgICAgICAgIGxldCBjID0gMDtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFvU2FtcGxlczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGRpciA9IHRoaXMuY29zaW5lU2FtcGxlSGVtaXNwaGVyZShpbnRlcnNlY3QuZ2V0T3duZXIoKS5nZXROb3JtYWwoaW50ZXJzZWN0LmdldEhpdFBvaW50KCkpKTtcblxuICAgICAgICAgICAgICAgIGxldCBhb0ludGVyc2VjdCA9IHRoaXMudHJhY2UoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBSYXkoXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0SGl0UG9pbnQoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpclxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIGlmICghYW9JbnRlcnNlY3QuZ2V0SW50ZXJzZWN0KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGFvSW50ZXJzZWN0LmdldERpc3RhbmNlRnJvbU9yaWdpbigpID4gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGMrKztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGl4ZWxDb2xvciA9IHBpeGVsQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgIGxhbWJDb2xvci5tdWx0aXBsZShDb2xvci53aGl0ZS5zY2FsZWQoMSAtIChjICogMC42NyAvIHRoaXMuYW9TYW1wbGVzKSkpLmFkZChwaG9uZ0NvbG9yKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwaXhlbENvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVmbGVjdGlvbkNvbG9yIChyYXk6IFJheSwgaW50ZXJzZWN0OiBhbnkpOiBhbnkge1xuICAgICAgICBsZXQgcmF5SXRlcmF0aW9uOiBudW1iZXIgPSByYXkuZ2V0SXRlcmF0aW9uKCksXG4gICAgICAgICAgICByZWZsZWN0aW9uQ29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcmVmbGVjdGlvblZhbHVlOiBudW1iZXIgPSBpbnRlcnNlY3QuZ2V0T3duZXIoKS5nZXRNYXRlcmlhbCgpLmdldFJlZmxlY3Rpb25WYWx1ZSgpLFxuICAgICAgICAgICAgcmVmbGVjdGVkUmF5OiBWZWN0b3I7XG5cbiAgICAgICAgcmF5LnNldEl0ZXJhdGlvbigtLXJheUl0ZXJhdGlvbik7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgcmF5SXRlcmF0aW9uID09PSAwIHx8XG4gICAgICAgICAgICByZWZsZWN0aW9uVmFsdWUgPT09IDBcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29sb3IuYmxhY2s7XG4gICAgICAgIH1cblxuICAgICAgICByZWZsZWN0ZWRSYXkgPSBWZWN0b3IucmVmbGVjdChcbiAgICAgICAgICAgIHJheS5nZXREaXJlY3Rpb24oKSxcbiAgICAgICAgICAgIGludGVyc2VjdC5nZXROb3JtYWwoKVxuICAgICAgICApO1xuXG4gICAgICAgIHJlZmxlY3Rpb25Db2xvciA9IHRoaXMuZ2V0Q29sb3IoXG4gICAgICAgICAgICBuZXcgUmF5KGludGVyc2VjdC5nZXRIaXRQb2ludCgpLCByZWZsZWN0ZWRSYXksIHJheUl0ZXJhdGlvbilcbiAgICAgICAgKS5zY2FsZWQocmVmbGVjdGlvblZhbHVlKTtcblxuICAgICAgICByZXR1cm4gcmVmbGVjdGlvbkNvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UGVyc3BlY3RpdmVWZWN0b3IgKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICAgIGxldCBjYW1lcmE6IENhbWVyYSA9IHRoaXMuc2NlbmUuZ2V0Q2FtZXJhKCk7XG5cbiAgICAgICAgcmV0dXJuIFZlY3Rvci5ub3JtYWxpemUoXG4gICAgICAgICAgICBWZWN0b3IuYWRkKFxuICAgICAgICAgICAgICAgIGNhbWVyYS5nZXRGb3J3YXJkVmVjdG9yKCksXG4gICAgICAgICAgICAgICAgVmVjdG9yLmFkZChcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnNjYWxlKFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLmdldFJpZ2h0VmVjdG9yKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEucmVjZW50ZXJYKHgpXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5nZXRVcFZlY3RvcigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLnJlY2VudGVyWSh5KVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TGlnaHRQb3dlciAoaW50ZXJzZWN0OiBhbnksIGxpZ2h0OiBBYnN0cmFjdExpZ2h0KTogbnVtYmVyIHtcbiAgICAgICAgbGV0IGxpZ2h0UG93ZXIgPSBsaWdodC5nZXRQb3dlcigpLFxuICAgICAgICAgICAgbGlnaHRSYW5kb21Qb2ludDogVmVjdG9yLFxuICAgICAgICAgICAgc2hhZG93UmF5OiBJbnRlcnNlY3RQb2ludCxcbiAgICAgICAgICAgIHJlc3VsdFBvd2VyOiBudW1iZXIgPSAwO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaGFkb3dTYW1wbGVzOyBpKyspIHtcbiAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnQgPSBsaWdodC5nZXRSYW5kb21Qb2ludCgpO1xuXG4gICAgICAgICAgICBzaGFkb3dSYXkgPSB0aGlzLnRyYWNlKFxuICAgICAgICAgICAgICAgIG5ldyBSYXkoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXRIaXRQb2ludCgpLFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0SGl0UG9pbnQoKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKCFzaGFkb3dSYXkuZ2V0SW50ZXJzZWN0KCkpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCEoc2hhZG93UmF5LmdldE93bmVyKCkgaW5zdGFuY2VvZiBBYnN0cmFjdExpZ2h0KSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXN1bHRQb3dlciArPSAoXG4gICAgICAgICAgICAgICAgbGlnaHRQb3dlciAtXG4gICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0SGl0UG9pbnQoKVxuICAgICAgICAgICAgICAgICAgICApLmdldExlbmd0aCgpICogKGxpZ2h0UG93ZXIgLyBsaWdodC5nZXRGYWRlUmFkaXVzKCkpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSAvIHRoaXMuc2hhZG93U2FtcGxlcztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRQb3dlcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyYWNlIChyYXk6IFJheSk6IEludGVyc2VjdFBvaW50IHtcbiAgICAgICAgbGV0IGludGVyc2VjdGlvbiA9IG5ldyBJbnRlcnNlY3RQb2ludCgpLFxuICAgICAgICAgICAgaW50ZXJzZWN0RGF0YTogYW55LFxuICAgICAgICAgICAgbWluRGlzdGFuY2U6IG51bWJlciA9IEluZmluaXR5LFxuICAgICAgICAgICAgc2NlbmVPYmplY3RzOiBBYnN0cmFjdE9iamVjdFtdJkFic3RyYWN0TGlnaHRbXSA9IHRoaXMuc2NlbmUuZ2V0T2JqZWN0cygpLmNvbmNhdCh0aGlzLnNjZW5lLmdldExpZ2h0cygpKTtcblxuICAgICAgICBmb3IgKGxldCBvYmplY3Qgb2Ygc2NlbmVPYmplY3RzKSB7XG4gICAgICAgICAgICBpbnRlcnNlY3REYXRhID0gb2JqZWN0LmdldEludGVyc2VjdERhdGEocmF5KTtcblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGludGVyc2VjdERhdGEgJiZcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3REYXRhWydkaXN0YW5jZSddIDwgbWluRGlzdGFuY2VcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIG1pbkRpc3RhbmNlID0gaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXTtcblxuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvbi5zZXRJbnRlcnNlY3QoKTtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb24uc2V0SGl0UG9pbnQoaW50ZXJzZWN0RGF0YVsnaGl0UG9pbnQnXSk7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uLnNldE5vcm1hbChpbnRlcnNlY3REYXRhWydub3JtYWwnXSk7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uLnNldERpc3RhbmNlRnJvbU9yaWdpbihpbnRlcnNlY3REYXRhWydkaXN0YW5jZSddKTtcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb24uc2V0T3duZXIob2JqZWN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpbnRlcnNlY3Rpb247XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlciAoc2NyZWVuV2lkdGg6IG51bWJlciwgc2NyZWVuSGVpZ2h0OiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHJhbmRvTXVsdGlwbGllciA9IDAuNTtcblxuICAgICAgICBsZXQgY29sb3I6IENvbG9yID0gQ29sb3IuYmxhY2ssXG4gICAgICAgICAgICByYW5kOiBudW1iZXIsXG4gICAgICAgICAgICByYXk6IFJheSxcbiAgICAgICAgICAgIHJnYkNvbG9yOiB7XG4gICAgICAgICAgICAgICAgcmVkOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgZ3JlZW46IG51bWJlcixcbiAgICAgICAgICAgICAgICBibHVlOiBudW1iZXJcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5zY3JlZW5XaWR0aCA9IHNjcmVlbldpZHRoO1xuICAgICAgICB0aGlzLnNjcmVlbkhlaWdodCA9IHNjcmVlbkhlaWdodDtcblxuICAgICAgICBmb3IgKGxldCBzYW1wbGUgPSAwOyBzYW1wbGUgPCB0aGlzLnBpeGVsU2FtcGxlczsgc2FtcGxlKyspIHtcbiAgICAgICAgICAgIHJhbmQgPSAwO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5waXhlbFNhbXBsZXMgPiAxKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNhbXBsZSAlIDIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZCArPSBNYXRoLnJhbmRvbSgpICogcmFuZG9NdWx0aXBsaWVyO1xuICAgICAgICAgICAgICAgIH0gIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByYW5kIC09IE1hdGgucmFuZG9tKCkgKiByYW5kb011bHRpcGxpZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByYXkgPSBuZXcgUmF5KFxuICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuZ2V0Q2FtZXJhKCkuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICB0aGlzLmdldFBlcnNwZWN0aXZlVmVjdG9yKHggKyByYW5kLCB5ICsgcmFuZClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbG9yID0gY29sb3IuYWRkKHRoaXMuZ2V0Q29sb3IocmF5KSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb2xvciA9IGNvbG9yLmRpdmlkZSh0aGlzLnBpeGVsU2FtcGxlcyk7XG5cbiAgICAgICAgZm9yIChsZXQgY29tcG9uZW50IGluIGNvbG9yKSB7XG4gICAgICAgICAgICBjb2xvcltjb21wb25lbnRdID0gQ29sb3Iuc1JHQkVuY29kZShjb2xvcltjb21wb25lbnRdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJnYkNvbG9yID0gQ29sb3IudG9SR0IoY29sb3IpO1xuXG4gICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoW3gsIHksIHJnYkNvbG9yLnJlZCwgcmdiQ29sb3IuZ3JlZW4sIHJnYkNvbG9yLmJsdWVdKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0U2NlbmUgKHNjZW5lOiBTY2VuZSk6IHZvaWQge1xuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XG4gICAgfVxufVxuXG5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIHZhciBkYXRhID0gbWVzc2FnZS5kYXRhO1xuXG4gICAgaWYgKHR5cGVvZihkYXRhKSA9PSAnc3RyaW5nJykge1xuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZSgnWycrZGF0YSsnXScpO1xuICAgIH1cblxuICAgIGxldCB0cmFjZXIgPSBuZXcgVHJhY2VyKCk7XG5cbiAgICB0cmFjZXIuc2V0U2NlbmUoXG4gICAgICAgIG5ldyBTY2VuZSh7XG4gICAgICAgICAgICBjYW1lcmE6IG5ldyBDYW1lcmEoXG4gICAgICAgICAgICAgICAgbmV3IFZlY3RvcigwLCAwLCAtNjk5KSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDAsIDAsIDEpLFxuICAgICAgICAgICAgICAgIGRhdGFbMF0sXG4gICAgICAgICAgICAgICAgZGF0YVsxXVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGxpZ2h0czogW1xuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmljYWxMaWdodChuZXcgVmVjdG9yICgwLCA2MDAsIDApLCAwLjYsIDEwMClcbiAgICAgICAgICAgICAgICAgICAgLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci53aGl0ZSkpLFxuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmljYWxMaWdodChuZXcgVmVjdG9yICgwLCAwLCAwKSwgMC42LCAxNTApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDIzNSwgMjAwKSkpKVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIG9iamVjdHM6IFtcbiAgICAgICAgICAgICAgICAvLyBuZXcgUGxhbmUobmV3IFZlY3RvcigwLCAxLCAwKSwgbmV3IFZlY3RvciAoMCwgLTQwMCwgMCkpLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci5ncmF5LCAwKSksXG4gICAgICAgICAgICAgICAgLy8gYm90dG9tIHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLndoaXRlLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vIGZyb250IHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3Iud2hpdGUsIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy8gdG9wIHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIC03MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3Iud2hpdGUsIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy9yaWdodCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLmJsdWUpLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy9sZWZ0IHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLnJlZCwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvLyBiYWNrIHBsYW5lXG4gICAgICAgICAgICAgICAgbmV3IFBvbHlnb24oXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCAtNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLmJsYWNrLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmUobmV3IFZlY3RvcigtMjUwLCAtNTAwLCA0NTApLCAyMDApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3IuYmxhY2ssIDEpKSxcbiAgICAgICAgICAgICAgICBuZXcgU3BoZXJlKG5ldyBWZWN0b3IoMjUwLCAtNTAwLCA0MDApLCAyMDApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3IuZ3JlZW4sIDApKVxuICAgICAgICAgICAgXVxuICAgICAgICB9KVxuICAgICk7XG5cbiAgICB0cmFjZXIucmVuZGVyKGRhdGFbMF0sIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM10pO1xufTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
