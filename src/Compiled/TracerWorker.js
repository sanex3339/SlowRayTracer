var Camera_1=require("./Camera"),Color_1=require("./Color/Color"),Ray_1=require("./Ray"),RGBColor_1=require("./Color/RGBColor"),Scene_1=require("./Scene"),Sphere_1=require("./Objects/Sphere"),Vector_1=require("./Vector"),SphericalLight_1=require("./Lights/SphericalLight"),Material_1=require("./Material"),Polygon_1=require("./Objects/Polygon"),Tracer=function(){function e(){this.pixelSamples=1,this.shadowSamples=10,this.giSamples=35,this.screenWidth=250,this.screenHeight=250}return e.prototype.cosineSampleHemisphere=function(e){var o,r,t=Math.random(),n=Math.random(),a=Math.sqrt(t),l=2*Math.PI*n;return o=Math.abs(e.getCoordinates().x)<.5?Vector_1.Vector.cross(e,new Vector_1.Vector(1,0,0)):Vector_1.Vector.cross(e,new Vector_1.Vector(0,1,0)),r=Vector_1.Vector.cross(e,o),Vector_1.Vector.add(Vector_1.Vector.scaled(e,Math.sqrt(1-t)),Vector_1.Vector.add(Vector_1.Vector.scaled(o,a*Math.cos(l)),Vector_1.Vector.scaled(r,a*Math.sin(l))))},e.prototype.getColor=function(e,o){void 0===o&&(o=!0);var r,t=this.trace(e),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0));return null===t.owner?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(r=this.getDiffuseColor(e,t,o),o&&(n=this.getReflectionColor(e,t)),r.add(n))},e.prototype.getDiffuseColor=function(e,o,r){void 0===r&&(r=!0);for(var t,n,a,l,c,i,s,_,V,w,C=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),g=0,h=this.scene.getLights();g<h.length;g++){var p=h[g];if("light"===o.ownerType)return o.owner.getMaterial().getColor();if(i=this.getLightPower(o,p),t=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),l=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),c=Vector_1.Vector.normalized(Vector_1.Vector.substract(o.point,p.getPosition())),r)for(var d=0;d<this.giSamples;d++){var R=void 0;a=this.cosineSampleHemisphere(o.owner.getNormal(o.point)),R=this.getColor(new Ray_1.Ray(o.point,a),!1),n=n.add(R)}n=n.divide(this.giSamples),_=-Vector_1.Vector.dot(c,o.normal),t=t.add(o.owner.getMaterial().getColor().add(n).multiple(p.getMaterial().getColor().scaled(i*_*o.owner.getMaterial().getLambertCoeff()))),s=Vector_1.Vector.reflect(c,o.normal),V=-Vector_1.Vector.dot(s,e.getDirection()),V>0&&(w=Math.pow(V,35),l=l.add(o.owner.getMaterial().getColor().multiple(p.getMaterial().getColor().scaled(i*w*o.owner.getMaterial().getPhongCoeff())))),C=C.add(t.add(l))}return C},e.prototype.getReflectionColor=function(e,o){var r,t,n=e.getIteration(),a=o.owner.getMaterial().getReflectionValue();return e.setIteration(--n),0===n||0===a?new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)):(t=Vector_1.Vector.reflect(e.getDirection(),o.normal),r=this.getColor(new Ray_1.Ray(o.point,t,n)).scaled(a))},e.prototype.getPerspectiveVector=function(e,o){var r=this.scene.getCamera();return Vector_1.Vector.normalized(Vector_1.Vector.add(r.getForwardVector(),Vector_1.Vector.add(Vector_1.Vector.scaled(r.getRightVector(),r.recenterX(e)),Vector_1.Vector.scaled(r.getUpVector(),r.recenterY(o)))))},e.prototype.getLightPower=function(e,o){for(var r,t,n=o.getPower(),a=0,l=0;l<this.shadowSamples;l++)r=o.getRandomPoint(),t=this.trace(new Ray_1.Ray(e.point,Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),r),e.point))),null!==t.point&&t.owner===o&&(a+=(n-Vector_1.Vector.substract(Vector_1.Vector.substract(o.getPosition(),r),e.point).getLength()*(n/o.getFadeRadius()))/this.shadowSamples);return a},e.prototype.trace=function(e){for(var o,r={distance:0,point:null,normal:null,owner:null,ownerType:null},t=this.scene.getObjects().concat(this.scene.getLights()),n=0,a=t;n<a.length;n++){var l=a[n];o=l.getIntersectData(e),o&&o.distance>0&&(null===r.owner||o.distance<r.distance)&&(r.distance=o.distance,r.point=o.point,r.owner=l,r.ownerType=l.getType(),r.normal=r.owner.getNormal(r.point))}return r},e.prototype.render=function(e,o,r,t){var n,a,l,c,i=.5;this.screenWidth=e,this.screenHeight=o,n=new Color_1.Color(new RGBColor_1.RGBColor(0,0,0));for(var s=0;s<this.pixelSamples;s++)a=0,this.pixelSamples>1&&(s%2?a+=Math.random()*i:a-=Math.random()*i),l=new Ray_1.Ray(this.scene.getCamera().getPosition(),this.getPerspectiveVector(r+a,t+a)),n=n.add(this.getColor(l));n=n.divide(this.pixelSamples);for(var _ in n)n[_]=Color_1.Color.sRGBEncode(n[_]);c=Color_1.Color.toRGB(n),self.postMessage([r,t,c.red,c.green,c.blue])},e.prototype.setScene=function(e){this.scene=e},e}();onmessage=function(e){var o=e.data;"string"==typeof o&&(o=JSON.parse("["+o+"]"));var r=new Tracer;r.setScene(new Scene_1.Scene({camera:new Camera_1.Camera(new Vector_1.Vector(0,0,-699),new Vector_1.Vector(0,0,1),o[0],o[1]),lights:[new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,0,0),.7,150).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,235,200))))],objects:[new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(-700,-700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(79,166,242)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(-700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(700,700,700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(245,130,130)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,700),new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(700,700,-700),new Vector_1.Vector(700,700,700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,-700,700),new Vector_1.Vector(-700,700,700),new Vector_1.Vector(-700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,255,255)),0).setLambertCoeff(1)),new Polygon_1.Polygon(new Vector_1.Vector(700,-700,-700),new Vector_1.Vector(-700,-700,-700),new Vector_1.Vector(-700,700,-700),new Vector_1.Vector(700,700,-700)).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),0).setLambertCoeff(1)),new Sphere_1.Sphere(new Vector_1.Vector(-250,-500,450),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,0,0)),1)),new Sphere_1.Sphere(new Vector_1.Vector(250,-500,400),200).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(0,255,0)),0))]})),r.render(o[0],o[1],o[2],o[3])};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRyYWNlcldvcmtlci50cyJdLCJuYW1lcyI6WyJDYW1lcmFfMSIsInJlcXVpcmUiLCJDb2xvcl8xIiwiUmF5XzEiLCJSR0JDb2xvcl8xIiwiU2NlbmVfMSIsIlNwaGVyZV8xIiwiVmVjdG9yXzEiLCJTcGhlcmljYWxMaWdodF8xIiwiTWF0ZXJpYWxfMSIsIlBvbHlnb25fMSIsIlRyYWNlciIsIlRyYWNlci5jb25zdHJ1Y3RvciIsIlRyYWNlci5jb3NpbmVTYW1wbGVIZW1pc3BoZXJlIiwiVHJhY2VyLmdldENvbG9yIiwiVHJhY2VyLmdldERpZmZ1c2VDb2xvciIsIlRyYWNlci5nZXRSZWZsZWN0aW9uQ29sb3IiLCJUcmFjZXIuZ2V0UGVyc3BlY3RpdmVWZWN0b3IiLCJUcmFjZXIuZ2V0TGlnaHRQb3dlciIsIlRyYWNlci50cmFjZSIsIlRyYWNlci5yZW5kZXIiLCJUcmFjZXIuc2V0U2NlbmUiLCJvbm1lc3NhZ2UiLCJtZXNzYWdlIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsInRyYWNlciIsInNldFNjZW5lIiwiU2NlbmUiLCJjYW1lcmEiLCJDYW1lcmEiLCJWZWN0b3IiLCJsaWdodHMiLCJTcGhlcmljYWxMaWdodCIsInNldE1hdGVyaWFsIiwiTWF0ZXJpYWwiLCJDb2xvciIsIlJHQkNvbG9yIiwib2JqZWN0cyIsIlBvbHlnb24iLCJzZXRMYW1iZXJ0Q29lZmYiLCJTcGhlcmUiLCJyZW5kZXIiXSwibWFwcGluZ3MiOiJBQUdBLEdBQUFBLFVBQUFDLFFBQXVCLFlBQ3ZCQyxRQUFBRCxRQUFzQixpQkFDdEJFLE1BQUFGLFFBQW9CLFNBQ3BCRyxXQUFBSCxRQUF5QixvQkFFekJJLFFBQUFKLFFBQXNCLFdBQ3RCSyxTQUFBTCxRQUF1QixvQkFDdkJNLFNBQUFOLFFBQXVCLFlBR3ZCTyxpQkFBQVAsUUFBK0IsMkJBQy9CUSxXQUFBUixRQUF5QixjQUN6QlMsVUFBQVQsUUFBd0IscUJBRXhCVSxPQUFBLFdBQUFBLFFBQUFBLEtBRVlDLEtBQUFBLGFBQXVCQSxFQUN2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eUIsT0FBTyxJQUFLLEtBQU0sTUFDdEIsR0FBSXpCLFVBQUF5QixPQUFPLEtBQU0sS0FBTSxNQUN2QixHQUFJekIsVUFBQXlCLE9BQU8sS0FBTSxJQUFLLE1BQ3RCLEdBQUl6QixVQUFBeUIsT0FBTyxJQUFLLElBQUssT0FDdkJHLFlBQVksR0FBSTFCLFlBQUEyQixTQUFTLEdBQUlsQyxTQUFBbUMsTUFBTSxHQUFJakMsWUFBQWtDLFNBQVMsRUFBRyxFQUFHLElBQUssR0FBR0csZ0JBQWdCLElBQ2hGLEdBQUluQyxVQUFBb0MsT0FBTyxHQUFJbkMsVUFBQXlCLE9BQU8sS0FBTSxLQUFNLEtBQU0sS0FDbkNHLFlBQVksR0FBSTFCLFlBQUEyQixTQUFTLEdBQUlsQyxTQUFBbUMsTUFBTSxHQUFJakMsWUFBQWtDLFNBQVMsRUFBRyxFQUFHLElBQUssSUFDaEUsR0FBSWhDLFVBQUFvQyxPQUFPLEdBQUluQyxVQUFBeUIsT0FBTyxJQUFLLEtBQU0sS0FBTSxLQUNsQ0csWUFBWSxHQUFJMUIsWUFBQTJCLFNBQVMsR0FBSWxDLFNBQUFtQyxNQUFNLEdBQUlqQyxZQUFBa0MsU0FBUyxFQUFHLElBQUssSUFBSyxRQUs5RVgsRUFBT2dCLE9BQU9uQixFQUFLLEdBQUlBLEVBQUssR0FBSUEsRUFBSyxHQUFJQSxFQUFLIiwiZmlsZSI6IlRyYWNlcldvcmtlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIG5vLWRlZmF1bHQtbGliPVwidHJ1ZVwiLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJsaWIvbGliLndlYndvcmtlci5kLnRzXCIgLz5cblxuaW1wb3J0IHsgQ2FtZXJhIH0gZnJvbSBcIi4vQ2FtZXJhXCI7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gXCIuL0NvbG9yL0NvbG9yXCI7XG5pbXBvcnQgeyBSYXkgfSBmcm9tIFwiLi9SYXlcIjtcbmltcG9ydCB7IFJHQkNvbG9yIH0gZnJvbSBcIi4vQ29sb3IvUkdCQ29sb3JcIjtcbmltcG9ydCB7IFJUTWF0aCB9IGZyb20gXCIuL1JUTWF0aFwiO1xuaW1wb3J0IHsgU2NlbmUgfSBmcm9tIFwiLi9TY2VuZVwiO1xuaW1wb3J0IHsgU3BoZXJlIH0gZnJvbSBcIi4vT2JqZWN0cy9TcGhlcmVcIjtcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gXCIuL1ZlY3RvclwiO1xuaW1wb3J0IHsgUGxhbmUgfSBmcm9tIFwiLi9PYmplY3RzL1BsYW5lXCI7XG5pbXBvcnQgeyBBYnN0cmFjdExpZ2h0IH0gZnJvbSBcIi4vTGlnaHRzL0Fic3RyYWN0TGlnaHRcIjtcbmltcG9ydCB7IFNwaGVyaWNhbExpZ2h0IH0gZnJvbSBcIi4vTGlnaHRzL1NwaGVyaWNhbExpZ2h0XCI7XG5pbXBvcnQgeyBNYXRlcmlhbCB9IGZyb20gXCIuL01hdGVyaWFsXCI7XG5pbXBvcnQgeyBQb2x5Z29uIH0gZnJvbSBcIi4vT2JqZWN0cy9Qb2x5Z29uXCI7XG5cbmNsYXNzIFRyYWNlciB7XG4gICAgcHJpdmF0ZSBzY2VuZTogU2NlbmU7XG4gICAgcHJpdmF0ZSBwaXhlbFNhbXBsZXM6IG51bWJlciA9IDE7XG4gICAgcHJpdmF0ZSBzaGFkb3dTYW1wbGVzOiBudW1iZXIgPSAxMDtcbiAgICBwcml2YXRlIGdpU2FtcGxlczogbnVtYmVyID0gMzU7XG4gICAgcHJpdmF0ZSBzY3JlZW5XaWR0aDogbnVtYmVyID0gMjUwO1xuICAgIHByaXZhdGUgc2NyZWVuSGVpZ2h0OiBudW1iZXIgPSAyNTA7XG5cbiAgICBwcml2YXRlIGNvc2luZVNhbXBsZUhlbWlzcGhlcmUgKG5vcm1hbDogVmVjdG9yKTogVmVjdG9yIHtcbiAgICAgICAgbGV0IHUgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgICBsZXQgdiA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgIGxldCByID0gTWF0aC5zcXJ0KHUpO1xuICAgICAgICBsZXQgYW5nbGUgPSAyICogTWF0aC5QSSAqIHY7XG5cbiAgICAgICAgbGV0IHNkaXIsXG4gICAgICAgICAgICB0ZGlyO1xuXG4gICAgICAgIGlmIChNYXRoLmFicyhub3JtYWwuZ2V0Q29vcmRpbmF0ZXMoKVsneCddKSA8IDAuNSkge1xuICAgICAgICAgICAgc2RpciA9IFZlY3Rvci5jcm9zcyhub3JtYWwsIG5ldyBWZWN0b3IoMSwwLDApKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNkaXIgPSBWZWN0b3IuY3Jvc3Mobm9ybWFsLCBuZXcgVmVjdG9yKDAsMSwwKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0ZGlyID0gVmVjdG9yLmNyb3NzKG5vcm1hbCwgc2Rpcik7XG5cbiAgICAgICAgcmV0dXJuIFZlY3Rvci5hZGQoXG4gICAgICAgICAgICBWZWN0b3Iuc2NhbGVkKG5vcm1hbCwgIE1hdGguc3FydCgxIC0gdSkpLFxuICAgICAgICAgICAgVmVjdG9yLmFkZChcbiAgICAgICAgICAgICAgICBWZWN0b3Iuc2NhbGVkKHNkaXIsIHIgKiBNYXRoLmNvcyhhbmdsZSkpLFxuICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZWQodGRpciwgciAqIE1hdGguc2luKGFuZ2xlKSlcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcblxuICAgICAgICAvKmxldCBiYXNpc1RyYW5zZm9ybTogVmVjdG9yLFxuICAgICAgICAgICAgYml0YW5nZW50OiBWZWN0b3IsXG4gICAgICAgICAgICB1MTogbnVtYmVyID0gTWF0aC5yYW5kb20oKSxcbiAgICAgICAgICAgIHUyOiBudW1iZXIgPSBNYXRoLnJhbmRvbSgpLFxuICAgICAgICAgICAgc2luX3RoZXRhOiBudW1iZXIgPSBNYXRoLnNxcnQodTEpLFxuICAgICAgICAgICAgY29zX3RoZXRhOiBudW1iZXIgPSBNYXRoLnNxcnQoMSAtIHUxKSxcbiAgICAgICAgICAgIHRoZXRhOiBudW1iZXIgPSAyICogTWF0aC5QSSAqIHUyLFxuICAgICAgICAgICAgZGlyOiBWZWN0b3IgPSBuZXcgVmVjdG9yKFxuICAgICAgICAgICAgICAgIHNpbl90aGV0YSAqIE1hdGguY29zKHRoZXRhKSxcbiAgICAgICAgICAgICAgICBzaW5fdGhldGEgKiBNYXRoLnNpbih0aGV0YSksXG4gICAgICAgICAgICAgICAgTWF0aC5zcXJ0KE1hdGgubWF4KDAsIDEgLSB1MSkpXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgdGFuZ2VudDogVmVjdG9yO1xuXG4gICAgICAgIGlmIChub3JtYWwuZ2V0Q29vcmRpbmF0ZXMoKVsneCddID09IDApIHtcbiAgICAgICAgICAgIHRhbmdlbnQgPSBuZXcgVmVjdG9yKDEsIDAsIDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFuZ2VudCA9IFZlY3Rvci5ub3JtYWxpemVkKFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoXG4gICAgICAgICAgICAgICAgICAgIG5vcm1hbC5nZXRDb29yZGluYXRlcygpWyd6J10sXG4gICAgICAgICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgICAgICAgIC1ub3JtYWwuZ2V0Q29vcmRpbmF0ZXMoKVsneCddXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJpdGFuZ2VudCA9IFZlY3Rvci5jcm9zcyh0YW5nZW50LCBub3JtYWwpO1xuXG4gICAgICAgIGJhc2lzVHJhbnNmb3JtID0gbmV3IFZlY3RvcihcbiAgICAgICAgICAgIFZlY3Rvci5kb3QodGFuZ2VudCwgZGlyKSxcbiAgICAgICAgICAgIFZlY3Rvci5kb3Qobm9ybWFsLCBkaXIpLFxuICAgICAgICAgICAgVmVjdG9yLmRvdChiaXRhbmdlbnQsIGRpcilcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gVmVjdG9yLm5vcm1hbGl6ZWQoYmFzaXNUcmFuc2Zvcm0pOyovXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDb2xvciAocmF5OiBSYXksIHJlY3VyY2l2ZTogYm9vbGVhbiA9IHRydWUpOiBDb2xvciB7XG4gICAgICAgIGxldCBpbnRlcnNlY3QgPSB0aGlzLnRyYWNlKHJheSksXG4gICAgICAgICAgICBkaWZmdXNlQ29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcmVmbGVjdENvbG9yOiBDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuXG4gICAgICAgIGlmIChpbnRlcnNlY3RbJ293bmVyJ10gPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRpZmZ1c2VDb2xvciA9IHRoaXMuZ2V0RGlmZnVzZUNvbG9yKHJheSwgaW50ZXJzZWN0LCByZWN1cmNpdmUpO1xuXG4gICAgICAgIGlmIChyZWN1cmNpdmUpIHtcbiAgICAgICAgICAgIHJlZmxlY3RDb2xvciA9IHRoaXMuZ2V0UmVmbGVjdGlvbkNvbG9yKHJheSwgaW50ZXJzZWN0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaWZmdXNlQ29sb3IuYWRkKHJlZmxlY3RDb2xvcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREaWZmdXNlQ29sb3IgKHJheTogUmF5LCBpbnRlcnNlY3Q6IGFueSwgcmVjdXJzaXZlOiBib29sZWFuID0gdHJ1ZSk6IENvbG9yIHtcbiAgICAgICAgbGV0IGxhbWJDb2xvcjogQ29sb3IsXG4gICAgICAgICAgICByYWRpYW5jZUNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uOiBWZWN0b3IsXG4gICAgICAgICAgICBwaG9uZ0NvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHBpeGVsQ29sb3I6IENvbG9yID0gbmV3IENvbG9yKG5ldyBSR0JDb2xvcigwLCAwLCAwKSksXG4gICAgICAgICAgICBsaWdodERpcmVjdGlvbjogVmVjdG9yLFxuICAgICAgICAgICAgbGlnaHRQb3dlcjogbnVtYmVyLFxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyOiBWZWN0b3IsXG4gICAgICAgICAgICBsYW1iQ29zOiBudW1iZXIsXG4gICAgICAgICAgICBwaG9uZ0NvczogbnVtYmVyLFxuICAgICAgICAgICAgcGhvbmc6IG51bWJlcjtcblxuICAgICAgICBmb3IgKGxldCBsaWdodCBvZiB0aGlzLnNjZW5lLmdldExpZ2h0cygpKSB7XG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0Wydvd25lclR5cGUnXSA9PT0gJ2xpZ2h0Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcnNlY3RbJ293bmVyJ11cbiAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgLmdldENvbG9yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxpZ2h0UG93ZXIgPSB0aGlzLmdldExpZ2h0UG93ZXIoaW50ZXJzZWN0LCBsaWdodCk7XG5cbiAgICAgICAgICAgIGxhbWJDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgcmFkaWFuY2VDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgcGhvbmdDb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24gPSBWZWN0b3Iubm9ybWFsaXplZChcbiAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ3BvaW50J10sXG4gICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldFBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvL2dpXG4gICAgICAgICAgICBpZiAocmVjdXJzaXZlKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmdpU2FtcGxlczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCByYWRpYW5jZUluUmFuZG9tRGlyZWN0aW9uOiBDb2xvcjtcblxuICAgICAgICAgICAgICAgICAgICByYWRpYW5jZVJhbmRvbURpcmVjdGlvbiA9IHRoaXMuY29zaW5lU2FtcGxlSGVtaXNwaGVyZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXS5nZXROb3JtYWwoaW50ZXJzZWN0Wydwb2ludCddKVxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlSW5SYW5kb21EaXJlY3Rpb24gPSB0aGlzLmdldENvbG9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFJheShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ3BvaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaWFuY2VSYW5kb21EaXJlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlQ29sb3IgPSByYWRpYW5jZUNvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkKHJhZGlhbmNlSW5SYW5kb21EaXJlY3Rpb24pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByYWRpYW5jZUNvbG9yID0gcmFkaWFuY2VDb2xvci5kaXZpZGUodGhpcy5naVNhbXBsZXMpO1xuXG4gICAgICAgICAgICAvLyBsYW1iZXJ0XG5cbiAgICAgICAgICAgIGxhbWJDb3MgPSAtVmVjdG9yLmRvdChcbiAgICAgICAgICAgICAgICBsaWdodERpcmVjdGlvbixcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ25vcm1hbCddXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBsYW1iQ29sb3IgPSBsYW1iQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXVxuICAgICAgICAgICAgICAgICAgICAuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAuYWRkKHJhZGlhbmNlQ29sb3IpXG4gICAgICAgICAgICAgICAgICAgIC5tdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UG93ZXIgKiBsYW1iQ29zICogaW50ZXJzZWN0Wydvd25lciddLmdldE1hdGVyaWFsKCkuZ2V0TGFtYmVydENvZWZmKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIHBob25nXG5cbiAgICAgICAgICAgIHJlZmxlY3RQaG9uZ1ZlY3RvckRpciA9IFZlY3Rvci5yZWZsZWN0KFxuICAgICAgICAgICAgICAgIGxpZ2h0RGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgIGludGVyc2VjdFsnbm9ybWFsJ11cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBwaG9uZ0NvcyA9IC1WZWN0b3IuZG90KHJlZmxlY3RQaG9uZ1ZlY3RvckRpciwgcmF5LmdldERpcmVjdGlvbigpKTtcblxuICAgICAgICAgICAgaWYgKHBob25nQ29zID4gMCkge1xuICAgICAgICAgICAgICAgIHBob25nID0gTWF0aC5wb3cocGhvbmdDb3MsIDM1KTtcbiAgICAgICAgICAgICAgICBwaG9uZ0NvbG9yID0gcGhvbmdDb2xvci5hZGQoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsnb3duZXInXVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAubXVsdGlwbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRQb3dlciAqIHBob25nICogaW50ZXJzZWN0Wydvd25lciddLmdldE1hdGVyaWFsKCkuZ2V0UGhvbmdDb2VmZigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwaXhlbENvbG9yID0gcGl4ZWxDb2xvci5hZGQoXG4gICAgICAgICAgICAgICAgbGFtYkNvbG9yLmFkZChwaG9uZ0NvbG9yKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwaXhlbENvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVmbGVjdGlvbkNvbG9yIChyYXk6IFJheSwgaW50ZXJzZWN0OiBhbnkpOiBhbnkge1xuICAgICAgICBsZXQgcmF5SXRlcmF0aW9uOiBudW1iZXIgPSByYXkuZ2V0SXRlcmF0aW9uKCksXG4gICAgICAgICAgICByZWZsZWN0aW9uQ29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcmVmbGVjdGlvblZhbHVlOiBudW1iZXIgPSBpbnRlcnNlY3RbJ293bmVyJ10uZ2V0TWF0ZXJpYWwoKS5nZXRSZWZsZWN0aW9uVmFsdWUoKSxcbiAgICAgICAgICAgIHJlZmxlY3RlZFJheTogVmVjdG9yO1xuXG4gICAgICAgIHJheS5zZXRJdGVyYXRpb24oLS1yYXlJdGVyYXRpb24pO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHJheUl0ZXJhdGlvbiA9PT0gMCB8fFxuICAgICAgICAgICAgcmVmbGVjdGlvblZhbHVlID09PSAwXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVmbGVjdGVkUmF5ID0gVmVjdG9yLnJlZmxlY3QoXG4gICAgICAgICAgICByYXkuZ2V0RGlyZWN0aW9uKCksXG4gICAgICAgICAgICBpbnRlcnNlY3RbJ25vcm1hbCddXG4gICAgICAgICk7XG5cbiAgICAgICAgcmVmbGVjdGlvbkNvbG9yID0gdGhpcy5nZXRDb2xvcihcbiAgICAgICAgICAgIG5ldyBSYXkoaW50ZXJzZWN0Wydwb2ludCddLCByZWZsZWN0ZWRSYXksIHJheUl0ZXJhdGlvbilcbiAgICAgICAgKS5zY2FsZWQocmVmbGVjdGlvblZhbHVlKTtcblxuICAgICAgICByZXR1cm4gcmVmbGVjdGlvbkNvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UGVyc3BlY3RpdmVWZWN0b3IgKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICAgIGxldCBjYW1lcmE6IENhbWVyYSA9IHRoaXMuc2NlbmUuZ2V0Q2FtZXJhKCk7XG5cbiAgICAgICAgcmV0dXJuIFZlY3Rvci5ub3JtYWxpemVkKFxuICAgICAgICAgICAgVmVjdG9yLmFkZChcbiAgICAgICAgICAgICAgICBjYW1lcmEuZ2V0Rm9yd2FyZFZlY3RvcigpLFxuICAgICAgICAgICAgICAgIFZlY3Rvci5hZGQoXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEuZ2V0UmlnaHRWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5yZWNlbnRlclgoeClcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnNjYWxlZChcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5nZXRVcFZlY3RvcigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLnJlY2VudGVyWSh5KVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TGlnaHRQb3dlciAoaW50ZXJzZWN0OiBhbnksIGxpZ2h0OiBBYnN0cmFjdExpZ2h0KTogbnVtYmVyIHtcbiAgICAgICAgbGV0IGxpZ2h0UG93ZXIgPSBsaWdodC5nZXRQb3dlcigpLFxuICAgICAgICAgICAgbGlnaHRSYW5kb21Qb2ludDogVmVjdG9yLFxuICAgICAgICAgICAgbGlnaHRSYXk6IGFueSxcbiAgICAgICAgICAgIHJlc3VsdFBvd2VyOiBudW1iZXIgPSAwO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaGFkb3dTYW1wbGVzOyBpKyspIHtcbiAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnQgPSBsaWdodC5nZXRSYW5kb21Qb2ludCgpO1xuXG4gICAgICAgICAgICBsaWdodFJheSA9IHRoaXMudHJhY2UoXG4gICAgICAgICAgICAgICAgbmV3IFJheShcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0Wydwb2ludCddLFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0UmFuZG9tUG9pbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RbJ3BvaW50J11cbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChsaWdodFJheVsncG9pbnQnXSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobGlnaHRSYXlbJ293bmVyJ10gIT09IGxpZ2h0KSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlc3VsdFBvd2VyICs9IChcbiAgICAgICAgICAgICAgICBsaWdodFBvd2VyIC1cbiAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc3Vic3RyYWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRSYW5kb21Qb2ludFxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdFsncG9pbnQnXVxuICAgICAgICAgICAgICAgICAgICApLmdldExlbmd0aCgpICogKGxpZ2h0UG93ZXIgLyBsaWdodC5nZXRGYWRlUmFkaXVzKCkpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSAvIHRoaXMuc2hhZG93U2FtcGxlcztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRQb3dlcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyYWNlIChyYXk6IFJheSk6IHtkaXN0YW5jZTogbnVtYmVyLCBwb2ludDogVmVjdG9yLCBvd25lcjogYW55LCBvd25lclR5cGU6IHN0cmluZ30ge1xuICAgICAgICBsZXQgcmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIGRpc3RhbmNlOiAwLFxuICAgICAgICAgICAgICAgIHBvaW50OiBudWxsLFxuICAgICAgICAgICAgICAgIG5vcm1hbDogbnVsbCxcbiAgICAgICAgICAgICAgICBvd25lcjogbnVsbCxcbiAgICAgICAgICAgICAgICBvd25lclR5cGU6IG51bGxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnRlcnNlY3REYXRhOiBhbnksXG4gICAgICAgICAgICBzY2VuZU9iamVjdHNXaXRoTGlnaHRzOiBhbnlbXSA9IHRoaXMuc2NlbmUuZ2V0T2JqZWN0cygpLmNvbmNhdCh0aGlzLnNjZW5lLmdldExpZ2h0cygpKTtcblxuICAgICAgICBmb3IgKGxldCBvYmplY3Qgb2Ygc2NlbmVPYmplY3RzV2l0aExpZ2h0cykge1xuICAgICAgICAgICAgaW50ZXJzZWN0RGF0YSA9IG9iamVjdC5nZXRJbnRlcnNlY3REYXRhKHJheSk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3REYXRhICYmXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXSA+IDAgJiZcbiAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFsnb3duZXInXSA9PT0gbnVsbCB8fFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3REYXRhWydkaXN0YW5jZSddIDwgcmVzdWx0WydkaXN0YW5jZSddXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0WydkaXN0YW5jZSddID0gaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXTtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ3BvaW50J10gPSBpbnRlcnNlY3REYXRhWydwb2ludCddO1xuICAgICAgICAgICAgICAgIHJlc3VsdFsnb3duZXInXSA9IG9iamVjdDtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ293bmVyVHlwZSddID0gb2JqZWN0LmdldFR5cGUoKTtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ25vcm1hbCddID0gcmVzdWx0Wydvd25lciddLmdldE5vcm1hbChyZXN1bHRbJ3BvaW50J10pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVuZGVyIChzY3JlZW5XaWR0aDogbnVtYmVyLCBzY3JlZW5IZWlnaHQ6IG51bWJlciwgeDogbnVtYmVyLCB5OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmFuZG9NdWx0aXBsaWVyID0gMC41O1xuXG4gICAgICAgIGxldCBjb2xvcjogQ29sb3IsXG4gICAgICAgICAgICByYW5kOiBudW1iZXIsXG4gICAgICAgICAgICByYXk6IFJheSxcbiAgICAgICAgICAgIHJnYkNvbG9yOiB7XG4gICAgICAgICAgICAgICAgcmVkOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgZ3JlZW46IG51bWJlcixcbiAgICAgICAgICAgICAgICBibHVlOiBudW1iZXJcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5zY3JlZW5XaWR0aCA9IHNjcmVlbldpZHRoO1xuICAgICAgICB0aGlzLnNjcmVlbkhlaWdodCA9IHNjcmVlbkhlaWdodDtcblxuICAgICAgICBjb2xvciA9IG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpO1xuXG4gICAgICAgIGZvciAobGV0IGl0ZXIgPSAwOyBpdGVyIDwgdGhpcy5waXhlbFNhbXBsZXM7IGl0ZXIrKykge1xuICAgICAgICAgICAgcmFuZCA9IDA7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnBpeGVsU2FtcGxlcyA+IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlciAlIDIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZCArPSBNYXRoLnJhbmRvbSgpICogcmFuZG9NdWx0aXBsaWVyO1xuICAgICAgICAgICAgICAgIH0gIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByYW5kIC09IE1hdGgucmFuZG9tKCkgKiByYW5kb011bHRpcGxpZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByYXkgPSBuZXcgUmF5KFxuICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuZ2V0Q2FtZXJhKCkuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICB0aGlzLmdldFBlcnNwZWN0aXZlVmVjdG9yKHggKyByYW5kLCB5ICsgcmFuZClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbG9yID0gY29sb3IuYWRkKHRoaXMuZ2V0Q29sb3IocmF5KSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb2xvciA9IGNvbG9yLmRpdmlkZSh0aGlzLnBpeGVsU2FtcGxlcyk7XG5cbiAgICAgICAgZm9yIChsZXQgY29tcG9uZW50IGluIGNvbG9yKSB7XG4gICAgICAgICAgICBjb2xvcltjb21wb25lbnRdID0gQ29sb3Iuc1JHQkVuY29kZShjb2xvcltjb21wb25lbnRdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJnYkNvbG9yID0gQ29sb3IudG9SR0IoY29sb3IpO1xuXG4gICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoW3gsIHksIHJnYkNvbG9yLnJlZCwgcmdiQ29sb3IuZ3JlZW4sIHJnYkNvbG9yLmJsdWVdKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0U2NlbmUgKHNjZW5lOiBTY2VuZSk6IHZvaWQge1xuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XG4gICAgfVxufVxuXG5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIHZhciBkYXRhID0gbWVzc2FnZS5kYXRhO1xuXG4gICAgaWYgKHR5cGVvZihkYXRhKSA9PSAnc3RyaW5nJykge1xuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZSgnWycrZGF0YSsnXScpO1xuICAgIH1cblxuICAgIGxldCB0cmFjZXIgPSBuZXcgVHJhY2VyKCk7XG5cbiAgICB0cmFjZXIuc2V0U2NlbmUoXG4gICAgICAgIG5ldyBTY2VuZSh7XG4gICAgICAgICAgICBjYW1lcmE6IG5ldyBDYW1lcmEoXG4gICAgICAgICAgICAgICAgbmV3IFZlY3RvcigwLCAwLCAtNjk5KSxcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDAsIDAsIDEpLFxuICAgICAgICAgICAgICAgIGRhdGFbMF0sXG4gICAgICAgICAgICAgICAgZGF0YVsxXVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGxpZ2h0czogW1xuICAgICAgICAgICAgICAgIC8qbmV3IFNwaGVyaWNhbExpZ2h0KG5ldyBWZWN0b3IgKDAsIDY0MCwgMCksIDAuNywgNTApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDI1NSwgMjU1KSkpKSwqL1xuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmljYWxMaWdodChuZXcgVmVjdG9yICgwLCAwLCAwKSwgMC43LCAxNTApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDIzNSwgMjAwKSkpKVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIG9iamVjdHM6IFtcbiAgICAgICAgICAgICAgICAvL25ldyBQbGFuZShuZXcgVmVjdG9yKDAsIDEsIDApLCAtNDAwKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigxMTUsIDExNSwgMTE1KSksIDApKSxcbiAgICAgICAgICAgICAgICAvLyBib3R0b20gcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCA3MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcig3OSwgMTY2LCAyNDIpKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvLyBmcm9udCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjU1LCAyNTUsIDI1NSkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vIHRvcCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCAtNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMjQ1LCAxMzAsIDEzMCkpLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vcmlnaHQgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIDcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDI1NSwgMjU1LCAyNTUpKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvL2xlZnQgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvcigtNzAwLCA3MDAsIC03MDApXG4gICAgICAgICAgICAgICAgKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDI1NSwgMjU1KSksIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy8gYmFjayBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChuZXcgQ29sb3IobmV3IFJHQkNvbG9yKDAsIDAsIDApKSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICBuZXcgU3BoZXJlKG5ldyBWZWN0b3IoLTI1MCwgLTUwMCwgNDUwKSwgMjAwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMCwgMCkpLCAxKSksXG4gICAgICAgICAgICAgICAgbmV3IFNwaGVyZShuZXcgVmVjdG9yKDI1MCwgLTUwMCwgNDAwKSwgMjAwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKG5ldyBDb2xvcihuZXcgUkdCQ29sb3IoMCwgMjU1LCAwKSksIDApKVxuICAgICAgICAgICAgXVxuICAgICAgICB9KVxuICAgICk7XG5cbiAgICB0cmFjZXIucmVuZGVyKGRhdGFbMF0sIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM10pO1xufTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
