var AbstractLight_1=require("./Lights/AbstractLight"),Camera_1=require("./Camera"),Color_1=require("./Color/Color"),IntersectPoint_1=require("./IntersectPoint"),Material_1=require("./Material"),Plane_1=require("./Objects/Plane"),Ray_1=require("./Ray"),RGBColor_1=require("./Color/RGBColor"),Scene_1=require("./Scene"),Sphere_1=require("./Objects/Sphere"),SphericalLight_1=require("./Lights/SphericalLight"),Vector_1=require("./Vector"),Tracer=function(){function e(){this.buffer=[],this.screenWidth=250,this.screenHeight=250;for(var e=0;e<this.screenWidth*this.screenHeight*3;e++)this.buffer.push(Color_1.Color.black)}return e.prototype.cosineSampleHemisphere=function(e){var t,r,o=Math.random(),a=Math.random(),i=Math.sqrt(o),c=2*Math.PI*a;return t=Math.abs(e.getCoordinates().x)<.5?Vector_1.Vector.cross(e,new Vector_1.Vector(1,0,0)):Vector_1.Vector.cross(e,new Vector_1.Vector(0,1,0)),r=Vector_1.Vector.cross(e,t),Vector_1.Vector.add(Vector_1.Vector.scale(e,Math.sqrt(1-o)),Vector_1.Vector.add(Vector_1.Vector.scale(t,i*Math.cos(c)),Vector_1.Vector.scale(r,i*Math.sin(c))))},e.prototype.getColor=function(e){var t=this.trace(e),r=Color_1.Color.black,o=Color_1.Color.black,a=e.getIteration();return e.setIteration(--a),0===a?Color_1.Color.black:t.getIntersect()?(r=this.getDiffuseColor(e,t),o=this.getReflectionColor(e,t),r.add(o)):Color_1.Color.black},e.prototype.getDiffuseColor=function(e,t,r){void 0===r&&(r=!0);for(var o,a,i,c,n,l,s,g,_,h,V=Color_1.Color.black,C=0,w=this.scene.getLights();C<w.length;C++){var f=w[C];if(t.getOwner()instanceof AbstractLight_1.AbstractLight)return t.getOwner().getMaterial().getColor();l=this.getLightPower(t,f),o=Color_1.Color.black,a=Color_1.Color.black,i=Color_1.Color.black,n=Vector_1.Vector.normalize(Vector_1.Vector.substract(t.getHitPoint(),f.getPosition()));var u=void 0;c=this.cosineSampleHemisphere(t.getOwner().getNormal(t.getHitPoint())),u=this.getColor(new Ray_1.Ray(t.getHitPoint(),c,e.getIteration())),i=i.add(u),g=-Vector_1.Vector.dot(n,t.getNormal()),o=o.add(t.getOwner().getMaterial().getColor().add(i).multiple(f.getMaterial().getColor().scaled(l*g*t.getOwner().getMaterial().getLambertCoeff()))),s=Vector_1.Vector.reflect(n,t.getNormal()),_=-Vector_1.Vector.dot(s,e.getDirection()),_>0&&(h=Math.pow(_,35),a=a.add(t.getOwner().getMaterial().getColor().multiple(f.getMaterial().getColor().scaled(l*h*t.getOwner().getMaterial().getPhongCoeff())))),V=V.add(o.add(a))}return V},e.prototype.getReflectionColor=function(e,t){var r,o,a=t.getOwner().getMaterial().getReflectionValue();return 0===a?Color_1.Color.black:(o=Vector_1.Vector.reflect(e.getDirection(),t.getNormal()),r=this.getColor(new Ray_1.Ray(t.getHitPoint(),o,e.getIteration())).scaled(a))},e.prototype.getPerspectiveVector=function(e,t){var r=this.scene.getCamera();return Vector_1.Vector.normalize(Vector_1.Vector.add(r.getForwardVector(),Vector_1.Vector.add(Vector_1.Vector.scale(r.getRightVector(),r.recenterX(e)),Vector_1.Vector.scale(r.getUpVector(),r.recenterY(t)))))},e.prototype.getLightPower=function(e,t){var r,o,a=t.getPower(),i=0;return r=t.getRandomPoint(),o=this.trace(new Ray_1.Ray(e.getHitPoint(),Vector_1.Vector.substract(Vector_1.Vector.substract(t.getPosition(),r),e.getHitPoint()))),o.getIntersect()&&o.getOwner()instanceof AbstractLight_1.AbstractLight&&(i+=a-Vector_1.Vector.substract(Vector_1.Vector.substract(t.getPosition(),r),e.getHitPoint()).getLength()*(a/t.getFadeRadius())),i},e.prototype.trace=function(e){for(var t,r=new IntersectPoint_1.IntersectPoint,o=1/0,a=this.scene.getObjects().concat(this.scene.getLights()),i=0,c=a;i<c.length;i++){var n=c[i];t=n.getIntersectData(e),t&&t.distance<o&&(o=t.distance,r.setIntersect(),r.setHitPoint(t.hitPoint),r.setNormal(t.normal),r.setDistanceFromOrigin(t.distance),r.setOwner(n))}return r},e.prototype.render=function(e,t){var r,o,a,i=.5;for(this.screenWidth=e,this.screenHeight=t;;){r=[];for(var c=0;1>c;c++)for(var n=0,l=0;l<this.screenHeight;l++)for(var s=0;s<this.screenWidth;s++){o=0,Math.random()>.5?o+=Math.random()*i:o-=Math.random()*i,a=new Ray_1.Ray(this.scene.getCamera().getPosition(),this.getPerspectiveVector(s+o,l+o)),this.buffer[n]=Color_1.Color.black.add(this.getColor(a));for(var g in this.buffer[n].getColor())this.buffer[n][g]=Color_1.Color.sRGBEncode(this.buffer[n][g]);r.push(this.buffer[n].getColor().red),r.push(this.buffer[n].getColor().green),r.push(this.buffer[n].getColor().blue),n++}for(var n=0;n<this.buffer.length;n++)this.buffer[n].getColor().red=0,this.buffer[n].getColor().green=0,this.buffer[n].getColor().blue=0;self.postMessage(r)}},e.prototype.setScene=function(e){this.scene=e},e}();onmessage=function(e){var t=e.data;"string"==typeof t&&(t=JSON.parse("["+t+"]"));var r=new Tracer;r.setScene(new Scene_1.Scene({camera:new Camera_1.Camera(new Vector_1.Vector(0,0,-699),new Vector_1.Vector(0,0,1),t[0],t[1]),lights:[new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,600,0),1,100).setMaterial(new Material_1.Material(Color_1.Color.white)),new SphericalLight_1.SphericalLight(new Vector_1.Vector(0,0,0),.6,150).setMaterial(new Material_1.Material(new Color_1.Color(new RGBColor_1.RGBColor(255,235,200))))],objects:[new Plane_1.Plane(new Vector_1.Vector(0,1,0),new Vector_1.Vector(0,-700,0)).setMaterial(new Material_1.Material(Color_1.Color.white,0)),new Plane_1.Plane(new Vector_1.Vector(0,-1,0),new Vector_1.Vector(0,700,0)).setMaterial(new Material_1.Material(Color_1.Color.white,0)),new Plane_1.Plane(new Vector_1.Vector(-1,0,0),new Vector_1.Vector(700,0,0)).setMaterial(new Material_1.Material(Color_1.Color.blue,0)),new Plane_1.Plane(new Vector_1.Vector(1,0,0),new Vector_1.Vector(-700,0,0)).setMaterial(new Material_1.Material(Color_1.Color.red,0)),new Plane_1.Plane(new Vector_1.Vector(0,0,-1),new Vector_1.Vector(0,0,700)).setMaterial(new Material_1.Material(Color_1.Color.white,0)),new Plane_1.Plane(new Vector_1.Vector(0,0,1),new Vector_1.Vector(0,0,-700)).setMaterial(new Material_1.Material(Color_1.Color.black,0)),new Sphere_1.Sphere(new Vector_1.Vector(-250,-500,450),200).setMaterial(new Material_1.Material(Color_1.Color.black,1)),new Sphere_1.Sphere(new Vector_1.Vector(250,-500,400),200).setMaterial(new Material_1.Material(Color_1.Color.green,0))]})),r.render(t[0],t[1])};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRyYWNlcldvcmtlci50cyJdLCJuYW1lcyI6WyJBYnN0cmFjdExpZ2h0XzEiLCJyZXF1aXJlIiwiQ2FtZXJhXzEiLCJDb2xvcl8xIiwiSW50ZXJzZWN0UG9pbnRfMSIsIk1hdGVyaWFsXzEiLCJQbGFuZV8xIiwiUmF5XzEiLCJSR0JDb2xvcl8xIiwiU2NlbmVfMSIsIlNwaGVyZV8xIiwiU3BoZXJpY2FsTGlnaHRfMSIsIlZlY3Rvcl8xIiwiVHJhY2VyIiwiVHJhY2VyLmNvbnN0cnVjdG9yIiwiVHJhY2VyLmNvc2luZVNhbXBsZUhlbWlzcGhlcmUiLCJUcmFjZXIuZ2V0Q29sb3IiLCJUcmFjZXIuZ2V0RGlmZnVzZUNvbG9yIiwiVHJhY2VyLmdldFJlZmxlY3Rpb25Db2xvciIsIlRyYWNlci5nZXRQZXJzcGVjdGl2ZVZlY3RvciIsIlRyYWNlci5nZXRMaWdodFBvd2VyIiwiVHJhY2VyLnRyYWNlIiwiVHJhY2VyLnJlbmRlciIsIlRyYWNlci5zZXRTY2VuZSIsIm9ubWVzc2FnZSIsIm1lc3NhZ2UiLCJkYXRhIiwiSlNPTiIsInBhcnNlIiwidHJhY2VyIiwic2V0U2NlbmUiLCJTY2VuZSIsImNhbWVyYSIsIkNhbWVyYSIsIlZlY3RvciIsImxpZ2h0cyIsIlNwaGVyaWNhbExpZ2h0Iiwic2V0TWF0ZXJpYWwiLCJNYXRlcmlhbCIsIkNvbG9yIiwid2hpdGUiLCJSR0JDb2xvciIsIm9iamVjdHMiLCJQbGFuZSIsImJsdWUiLCJyZWQiLCJibGFjayIsIlNwaGVyZSIsImdyZWVuIiwicmVuZGVyIl0sIm1hcHBpbmdzIjoiQUFHQSxHQUFBQSxpQkFBQUMsUUFBOEIsMEJBRTlCQyxTQUFBRCxRQUF1QixZQUN2QkUsUUFBQUYsUUFBc0IsaUJBQ3RCRyxpQkFBQUgsUUFBK0Isb0JBQy9CSSxXQUFBSixRQUF5QixjQUN6QkssUUFBQUwsUUFBc0IsbUJBRXRCTSxNQUFBTixRQUFvQixTQUNwQk8sV0FBQVAsUUFBeUIsb0JBRXpCUSxRQUFBUixRQUFzQixXQUN0QlMsU0FBQVQs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T0FBUSxJQUFLLEVBQUcsSUFBSUcsWUFBWSxHQUFJaEMsWUFBQWlDLFNBQVNuQyxRQUFBb0MsTUFBTUssS0FBTSxJQUM3RixHQUFJdEMsU0FBQXFDLE1BQU0sR0FBSS9CLFVBQUFzQixPQUFPLEVBQUcsRUFBRyxHQUFJLEdBQUl0QixVQUFBc0IsT0FBUSxLQUFNLEVBQUcsSUFBSUcsWUFBWSxHQUFJaEMsWUFBQWlDLFNBQVNuQyxRQUFBb0MsTUFBTU0sSUFBSyxJQUM1RixHQUFJdkMsU0FBQXFDLE1BQU0sR0FBSS9CLFVBQUFzQixPQUFPLEVBQUcsRUFBRyxJQUFLLEdBQUl0QixVQUFBc0IsT0FBUSxFQUFHLEVBQUcsTUFBTUcsWUFBWSxHQUFJaEMsWUFBQWlDLFNBQVNuQyxRQUFBb0MsTUFBTUMsTUFBTyxJQUM5RixHQUFJbEMsU0FBQXFDLE1BQU0sR0FBSS9CLFVBQUFzQixPQUFPLEVBQUcsRUFBRyxHQUFJLEdBQUl0QixVQUFBc0IsT0FBUSxFQUFHLEVBQUcsT0FBT0csWUFBWSxHQUFJaEMsWUFBQWlDLFNBQVNuQyxRQUFBb0MsTUFBTU8sTUFBTyxJQTJDOUYsR0FBSXBDLFVBQUFxQyxPQUFPLEdBQUluQyxVQUFBc0IsT0FBTyxLQUFNLEtBQU0sS0FBTSxLQUNuQ0csWUFBWSxHQUFJaEMsWUFBQWlDLFNBQVNuQyxRQUFBb0MsTUFBTU8sTUFBTyxJQUMzQyxHQUFJcEMsVUFBQXFDLE9BQU8sR0FBSW5DLFVBQUFzQixPQUFPLElBQUssS0FBTSxLQUFNLEtBQ2xDRyxZQUFZLEdBQUloQyxZQUFBaUMsU0FBU25DLFFBQUFvQyxNQUFNUyxNQUFPLFFBS3ZEbkIsRUFBT29CLE9BQU92QixFQUFLLEdBQUlBLEVBQUsiLCJmaWxlIjoiVHJhY2VyV29ya2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9XCJ0cnVlXCIvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cImxpYi9saWIud2Vid29ya2VyLmQudHNcIiAvPlxuXG5pbXBvcnQgeyBBYnN0cmFjdExpZ2h0IH0gZnJvbSBcIi4vTGlnaHRzL0Fic3RyYWN0TGlnaHRcIjtcbmltcG9ydCB7IEFic3RyYWN0T2JqZWN0IH0gZnJvbSBcIi4vT2JqZWN0cy9BYnN0cmFjdE9iamVjdFwiO1xuaW1wb3J0IHsgQ2FtZXJhIH0gZnJvbSBcIi4vQ2FtZXJhXCI7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gXCIuL0NvbG9yL0NvbG9yXCI7XG5pbXBvcnQgeyBJbnRlcnNlY3RQb2ludCB9IGZyb20gXCIuL0ludGVyc2VjdFBvaW50XCI7XG5pbXBvcnQgeyBNYXRlcmlhbCB9IGZyb20gXCIuL01hdGVyaWFsXCI7XG5pbXBvcnQgeyBQbGFuZSB9IGZyb20gXCIuL09iamVjdHMvUGxhbmVcIjtcbmltcG9ydCB7IFBvbHlnb24gfSBmcm9tIFwiLi9PYmplY3RzL1BvbHlnb25cIjtcbmltcG9ydCB7IFJheSB9IGZyb20gXCIuL1JheVwiO1xuaW1wb3J0IHsgUkdCQ29sb3IgfSBmcm9tIFwiLi9Db2xvci9SR0JDb2xvclwiO1xuaW1wb3J0IHsgUlRNYXRoIH0gZnJvbSBcIi4vUlRNYXRoXCI7XG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XG5pbXBvcnQgeyBTcGhlcmUgfSBmcm9tIFwiLi9PYmplY3RzL1NwaGVyZVwiO1xuaW1wb3J0IHsgU3BoZXJpY2FsTGlnaHQgfSBmcm9tIFwiLi9MaWdodHMvU3BoZXJpY2FsTGlnaHRcIjtcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gXCIuL1ZlY3RvclwiO1xuXG5jbGFzcyBUcmFjZXIge1xuICAgIHByaXZhdGUgYnVmZmVyOiBDb2xvcltdID0gW107XG4gICAgcHJpdmF0ZSBzY2VuZTogU2NlbmU7XG4gICAgcHJpdmF0ZSBzY3JlZW5XaWR0aDogbnVtYmVyID0gMjUwO1xuICAgIHByaXZhdGUgc2NyZWVuSGVpZ2h0OiBudW1iZXIgPSAyNTA7XG5cbiAgICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zY3JlZW5XaWR0aCAqIHRoaXMuc2NyZWVuSGVpZ2h0ICogMzsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmJ1ZmZlci5wdXNoKENvbG9yLmJsYWNrKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY29zaW5lU2FtcGxlSGVtaXNwaGVyZSAobm9ybWFsOiBWZWN0b3IpOiBWZWN0b3Ige1xuICAgICAgICBsZXQgdSA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgIGxldCB2ID0gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgbGV0IHIgPSBNYXRoLnNxcnQodSk7XG4gICAgICAgIGxldCBhbmdsZSA9IDIgKiBNYXRoLlBJICogdjtcblxuICAgICAgICBsZXQgc2RpcixcbiAgICAgICAgICAgIHRkaXI7XG5cbiAgICAgICAgaWYgKE1hdGguYWJzKG5vcm1hbC5nZXRDb29yZGluYXRlcygpWyd4J10pIDwgMC41KSB7XG4gICAgICAgICAgICBzZGlyID0gVmVjdG9yLmNyb3NzKG5vcm1hbCwgbmV3IFZlY3RvcigxLDAsMCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2RpciA9IFZlY3Rvci5jcm9zcyhub3JtYWwsIG5ldyBWZWN0b3IoMCwxLDApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRkaXIgPSBWZWN0b3IuY3Jvc3Mobm9ybWFsLCBzZGlyKTtcblxuICAgICAgICByZXR1cm4gVmVjdG9yLmFkZChcbiAgICAgICAgICAgIFZlY3Rvci5zY2FsZShub3JtYWwsICBNYXRoLnNxcnQoMSAtIHUpKSxcbiAgICAgICAgICAgIFZlY3Rvci5hZGQoXG4gICAgICAgICAgICAgICAgVmVjdG9yLnNjYWxlKHNkaXIsIHIgKiBNYXRoLmNvcyhhbmdsZSkpLFxuICAgICAgICAgICAgICAgIFZlY3Rvci5zY2FsZSh0ZGlyLCByICogTWF0aC5zaW4oYW5nbGUpKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Q29sb3IgKHJheTogUmF5KTogQ29sb3Ige1xuICAgICAgICBsZXQgaW50ZXJzZWN0aW9uID0gdGhpcy50cmFjZShyYXkpLFxuICAgICAgICAgICAgZGlmZnVzZUNvbG9yOiBDb2xvciA9IENvbG9yLmJsYWNrLFxuICAgICAgICAgICAgcmVmbGVjdENvbG9yOiBDb2xvciA9IENvbG9yLmJsYWNrLFxuICAgICAgICAgICAgcmF5SXRlcmF0aW9uOiBudW1iZXIgPSByYXkuZ2V0SXRlcmF0aW9uKCk7XG5cbiAgICAgICAgcmF5LnNldEl0ZXJhdGlvbigtLXJheUl0ZXJhdGlvbik7XG5cbiAgICAgICAgaWYgKHJheUl0ZXJhdGlvbiA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIENvbG9yLmJsYWNrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpbnRlcnNlY3Rpb24uZ2V0SW50ZXJzZWN0KCkpIHtcbiAgICAgICAgICAgIHJldHVybiBDb2xvci5ibGFjaztcbiAgICAgICAgfVxuXG4gICAgICAgIGRpZmZ1c2VDb2xvciA9IHRoaXMuZ2V0RGlmZnVzZUNvbG9yKHJheSwgaW50ZXJzZWN0aW9uKTtcbiAgICAgICAgcmVmbGVjdENvbG9yID0gdGhpcy5nZXRSZWZsZWN0aW9uQ29sb3IocmF5LCBpbnRlcnNlY3Rpb24pO1xuXG4gICAgICAgIHJldHVybiBkaWZmdXNlQ29sb3IuYWRkKHJlZmxlY3RDb2xvcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREaWZmdXNlQ29sb3IgKHJheTogUmF5LCBpbnRlcnNlY3Q6IGFueSwgcmVjdXJzaXZlOiBib29sZWFuID0gdHJ1ZSk6IENvbG9yIHtcbiAgICAgICAgbGV0IGxhbWJDb2xvcjogQ29sb3IsXG4gICAgICAgICAgICBwaG9uZ0NvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJhZGlhbmNlQ29sb3I6IENvbG9yLFxuICAgICAgICAgICAgcGl4ZWxDb2xvcjogQ29sb3IgPSBDb2xvci5ibGFjayxcbiAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uOiBWZWN0b3IsXG4gICAgICAgICAgICBsaWdodERpcmVjdGlvbjogVmVjdG9yLFxuICAgICAgICAgICAgbGlnaHRQb3dlcjogbnVtYmVyLFxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyOiBWZWN0b3IsXG4gICAgICAgICAgICBsYW1iQ29zOiBudW1iZXIsXG4gICAgICAgICAgICBwaG9uZ0NvczogbnVtYmVyLFxuICAgICAgICAgICAgcGhvbmc6IG51bWJlcjtcblxuICAgICAgICBmb3IgKGxldCBsaWdodCBvZiB0aGlzLnNjZW5lLmdldExpZ2h0cygpKSB7XG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0LmdldE93bmVyKCkgaW5zdGFuY2VvZiBBYnN0cmFjdExpZ2h0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGludGVyc2VjdC5nZXRPd25lcigpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaWdodFBvd2VyID0gdGhpcy5nZXRMaWdodFBvd2VyKGludGVyc2VjdCwgbGlnaHQpO1xuXG4gICAgICAgICAgICBsYW1iQ29sb3IgPSBDb2xvci5ibGFjaztcbiAgICAgICAgICAgIHBob25nQ29sb3IgPSBDb2xvci5ibGFjaztcbiAgICAgICAgICAgIHJhZGlhbmNlQ29sb3IgPSBDb2xvci5ibGFjaztcblxuICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24gPSBWZWN0b3Iubm9ybWFsaXplKFxuICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXRIaXRQb2ludCgpLFxuICAgICAgICAgICAgICAgICAgICBsaWdodC5nZXRQb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuXG5cbiAgICAgICAgICAgIC8vZ2lcbiAgICAgICAgICAgIGxldCByYWRpYW5jZUluUmFuZG9tRGlyZWN0aW9uOiBDb2xvcjtcblxuICAgICAgICAgICAgcmFkaWFuY2VSYW5kb21EaXJlY3Rpb24gPSB0aGlzLmNvc2luZVNhbXBsZUhlbWlzcGhlcmUoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldE93bmVyKCkuZ2V0Tm9ybWFsKGludGVyc2VjdC5nZXRIaXRQb2ludCgpKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgcmFkaWFuY2VJblJhbmRvbURpcmVjdGlvbiA9IHRoaXMuZ2V0Q29sb3IoXG4gICAgICAgICAgICAgICAgbmV3IFJheShcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldEhpdFBvaW50KCksXG4gICAgICAgICAgICAgICAgICAgIHJhZGlhbmNlUmFuZG9tRGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICByYXkuZ2V0SXRlcmF0aW9uKClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICByYWRpYW5jZUNvbG9yID0gcmFkaWFuY2VDb2xvclxuICAgICAgICAgICAgICAgIC5hZGQocmFkaWFuY2VJblJhbmRvbURpcmVjdGlvbik7XG5cblxuXG4gICAgICAgICAgICAvLyBsYW1iZXJ0XG5cbiAgICAgICAgICAgIGxhbWJDb3MgPSAtVmVjdG9yLmRvdChcbiAgICAgICAgICAgICAgICBsaWdodERpcmVjdGlvbixcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0Tm9ybWFsKClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGxhbWJDb2xvciA9IGxhbWJDb2xvci5hZGQoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0XG4gICAgICAgICAgICAgICAgICAgIC5nZXRPd25lcigpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRNYXRlcmlhbCgpXG4gICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgIC5hZGQocmFkaWFuY2VDb2xvcilcbiAgICAgICAgICAgICAgICAgICAgLm11bHRpcGxlKFxuICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNjYWxlZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRQb3dlciAqIGxhbWJDb3MgKiBpbnRlcnNlY3QuZ2V0T3duZXIoKS5nZXRNYXRlcmlhbCgpLmdldExhbWJlcnRDb2VmZigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG5cblxuICAgICAgICAgICAgLy8gcGhvbmdcblxuICAgICAgICAgICAgcmVmbGVjdFBob25nVmVjdG9yRGlyID0gVmVjdG9yLnJlZmxlY3QoXG4gICAgICAgICAgICAgICAgbGlnaHREaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldE5vcm1hbCgpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcGhvbmdDb3MgPSAtVmVjdG9yLmRvdChyZWZsZWN0UGhvbmdWZWN0b3JEaXIsIHJheS5nZXREaXJlY3Rpb24oKSk7XG5cbiAgICAgICAgICAgIGlmIChwaG9uZ0NvcyA+IDApIHtcbiAgICAgICAgICAgICAgICBwaG9uZyA9IE1hdGgucG93KHBob25nQ29zLCAzNSk7XG4gICAgICAgICAgICAgICAgcGhvbmdDb2xvciA9IHBob25nQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3QuZ2V0T3duZXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldE1hdGVyaWFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb2xvcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAubXVsdGlwbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0TWF0ZXJpYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29sb3IoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRQb3dlciAqIHBob25nICogaW50ZXJzZWN0LmdldE93bmVyKCkuZ2V0TWF0ZXJpYWwoKS5nZXRQaG9uZ0NvZWZmKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vYW1iaWVudCBvY2NsdXNpb25cbiAgICAgICAgICAgIC8qbGV0IGMgPSAwO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYW9TYW1wbGVzOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgZGlyID0gdGhpcy5jb3NpbmVTYW1wbGVIZW1pc3BoZXJlKGludGVyc2VjdC5nZXRPd25lcigpLmdldE5vcm1hbChpbnRlcnNlY3QuZ2V0SGl0UG9pbnQoKSkpO1xuXG4gICAgICAgICAgICAgICAgbGV0IGFvSW50ZXJzZWN0ID0gdGhpcy50cmFjZShcbiAgICAgICAgICAgICAgICAgICAgbmV3IFJheShcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXRIaXRQb2ludCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlyXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFhb0ludGVyc2VjdC5nZXRJbnRlcnNlY3QoKSkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoYW9JbnRlcnNlY3QuZ2V0RGlzdGFuY2VGcm9tT3JpZ2luKCkgPiAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYysrO1xuICAgICAgICAgICAgfSovXG5cbiAgICAgICAgICAgIC8qcGl4ZWxDb2xvciA9IHBpeGVsQ29sb3IuYWRkKFxuICAgICAgICAgICAgICAgIGxhbWJDb2xvci5tdWx0aXBsZShDb2xvci53aGl0ZS5zY2FsZWQoMSAtIChjICogMC42NyAvIHRoaXMuYW9TYW1wbGVzKSkpLmFkZChwaG9uZ0NvbG9yKVxuICAgICAgICAgICAgKTsqL1xuXG4gICAgICAgICAgICBwaXhlbENvbG9yID0gcGl4ZWxDb2xvci5hZGQoXG4gICAgICAgICAgICAgICAgbGFtYkNvbG9yLmFkZChwaG9uZ0NvbG9yKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwaXhlbENvbG9yO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVmbGVjdGlvbkNvbG9yIChyYXk6IFJheSwgaW50ZXJzZWN0OiBhbnkpOiBhbnkge1xuICAgICAgICBsZXQgcmVmbGVjdGlvbkNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJlZmxlY3Rpb25WYWx1ZTogbnVtYmVyID0gaW50ZXJzZWN0LmdldE93bmVyKCkuZ2V0TWF0ZXJpYWwoKS5nZXRSZWZsZWN0aW9uVmFsdWUoKSxcbiAgICAgICAgICAgIHJlZmxlY3RlZFJheTogVmVjdG9yO1xuXG4gICAgICAgIGlmIChyZWZsZWN0aW9uVmFsdWUgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBDb2xvci5ibGFjaztcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZmxlY3RlZFJheSA9IFZlY3Rvci5yZWZsZWN0KFxuICAgICAgICAgICAgcmF5LmdldERpcmVjdGlvbigpLFxuICAgICAgICAgICAgaW50ZXJzZWN0LmdldE5vcm1hbCgpXG4gICAgICAgICk7XG5cbiAgICAgICAgcmVmbGVjdGlvbkNvbG9yID0gdGhpcy5nZXRDb2xvcihcbiAgICAgICAgICAgIG5ldyBSYXkoaW50ZXJzZWN0LmdldEhpdFBvaW50KCksIHJlZmxlY3RlZFJheSwgcmF5LmdldEl0ZXJhdGlvbigpKVxuICAgICAgICApLnNjYWxlZChyZWZsZWN0aW9uVmFsdWUpO1xuXG4gICAgICAgIHJldHVybiByZWZsZWN0aW9uQ29sb3I7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQZXJzcGVjdGl2ZVZlY3RvciAoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICAgICAgbGV0IGNhbWVyYTogQ2FtZXJhID0gdGhpcy5zY2VuZS5nZXRDYW1lcmEoKTtcblxuICAgICAgICByZXR1cm4gVmVjdG9yLm5vcm1hbGl6ZShcbiAgICAgICAgICAgIFZlY3Rvci5hZGQoXG4gICAgICAgICAgICAgICAgY2FtZXJhLmdldEZvcndhcmRWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICBWZWN0b3IuYWRkKFxuICAgICAgICAgICAgICAgICAgICBWZWN0b3Iuc2NhbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEuZ2V0UmlnaHRWZWN0b3IoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5yZWNlbnRlclgoeClcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnNjYWxlKFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLmdldFVwVmVjdG9yKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEucmVjZW50ZXJZKHkpXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRMaWdodFBvd2VyIChpbnRlcnNlY3Q6IGFueSwgbGlnaHQ6IEFic3RyYWN0TGlnaHQpOiBudW1iZXIge1xuICAgICAgICBsZXQgbGlnaHRQb3dlciA9IGxpZ2h0LmdldFBvd2VyKCksXG4gICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50OiBWZWN0b3IsXG4gICAgICAgICAgICBzaGFkb3dSYXk6IEludGVyc2VjdFBvaW50LFxuICAgICAgICAgICAgcmVzdWx0UG93ZXI6IG51bWJlciA9IDA7XG5cbiAgICAgICAgbGlnaHRSYW5kb21Qb2ludCA9IGxpZ2h0LmdldFJhbmRvbVBvaW50KCk7XG5cbiAgICAgICAgc2hhZG93UmF5ID0gdGhpcy50cmFjZShcbiAgICAgICAgICAgIG5ldyBSYXkoXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldEhpdFBvaW50KCksXG4gICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0LmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50XG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdC5nZXRIaXRQb2ludCgpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHNoYWRvd1JheS5nZXRJbnRlcnNlY3QoKSAmJlxuICAgICAgICAgICAgc2hhZG93UmF5LmdldE93bmVyKCkgaW5zdGFuY2VvZiBBYnN0cmFjdExpZ2h0XG4gICAgICAgICkge1xuICAgICAgICAgICAgcmVzdWx0UG93ZXIgKz0gKFxuICAgICAgICAgICAgICAgIGxpZ2h0UG93ZXIgLVxuICAgICAgICAgICAgICAgIChcbiAgICAgICAgICAgICAgICAgICAgVmVjdG9yLnN1YnN0cmFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFZlY3Rvci5zdWJzdHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHQuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodFJhbmRvbVBvaW50XG4gICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0LmdldEhpdFBvaW50KClcbiAgICAgICAgICAgICAgICAgICAgKS5nZXRMZW5ndGgoKSAqIChsaWdodFBvd2VyIC8gbGlnaHQuZ2V0RmFkZVJhZGl1cygpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0UG93ZXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmFjZSAocmF5OiBSYXkpOiBJbnRlcnNlY3RQb2ludCB7XG4gICAgICAgIGxldCBpbnRlcnNlY3Rpb24gPSBuZXcgSW50ZXJzZWN0UG9pbnQoKSxcbiAgICAgICAgICAgIGludGVyc2VjdERhdGE6IGFueSxcbiAgICAgICAgICAgIG1pbkRpc3RhbmNlOiBudW1iZXIgPSBJbmZpbml0eSxcbiAgICAgICAgICAgIHNjZW5lT2JqZWN0czogQWJzdHJhY3RPYmplY3RbXSZBYnN0cmFjdExpZ2h0W10gPSB0aGlzLnNjZW5lLmdldE9iamVjdHMoKS5jb25jYXQodGhpcy5zY2VuZS5nZXRMaWdodHMoKSk7XG5cbiAgICAgICAgZm9yIChsZXQgb2JqZWN0IG9mIHNjZW5lT2JqZWN0cykge1xuICAgICAgICAgICAgaW50ZXJzZWN0RGF0YSA9IG9iamVjdC5nZXRJbnRlcnNlY3REYXRhKHJheSk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3REYXRhICYmXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXSA8IG1pbkRpc3RhbmNlXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBtaW5EaXN0YW5jZSA9IGludGVyc2VjdERhdGFbJ2Rpc3RhbmNlJ107XG5cbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Rpb24uc2V0SW50ZXJzZWN0KCk7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uLnNldEhpdFBvaW50KGludGVyc2VjdERhdGFbJ2hpdFBvaW50J10pO1xuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvbi5zZXROb3JtYWwoaW50ZXJzZWN0RGF0YVsnbm9ybWFsJ10pO1xuICAgICAgICAgICAgICAgIGludGVyc2VjdGlvbi5zZXREaXN0YW5jZUZyb21PcmlnaW4oaW50ZXJzZWN0RGF0YVsnZGlzdGFuY2UnXSk7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uLnNldE93bmVyKG9iamVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaW50ZXJzZWN0aW9uO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIgKHNjcmVlbldpZHRoOiBudW1iZXIsIHNjcmVlbkhlaWdodDogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHJhbmRvTXVsdGlwbGllciA9IDAuNTtcblxuICAgICAgICBsZXQgYnVmZmVyOiBudW1iZXJbXSxcbiAgICAgICAgICAgIGNvbG9yOiBDb2xvcixcbiAgICAgICAgICAgIHJhbmQ6IG51bWJlcixcbiAgICAgICAgICAgIHJheTogUmF5O1xuXG4gICAgICAgIHRoaXMuc2NyZWVuV2lkdGggPSBzY3JlZW5XaWR0aDtcbiAgICAgICAgdGhpcy5zY3JlZW5IZWlnaHQgPSBzY3JlZW5IZWlnaHQ7XG5cbiAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgIGJ1ZmZlciA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpdGVyYXRpb24gPSAwOyBpdGVyYXRpb24gPCAxOyBpdGVyYXRpb24rKykge1xuICAgICAgICAgICAgICAgIGxldCBpID0gMDtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdGhpcy5zY3JlZW5IZWlnaHQ7IHkrKykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHRoaXMuc2NyZWVuV2lkdGg7IHgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmFuZCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC41KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZCArPSBNYXRoLnJhbmRvbSgpICogcmFuZG9NdWx0aXBsaWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZCAtPSBNYXRoLnJhbmRvbSgpICogcmFuZG9NdWx0aXBsaWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByYXkgPSBuZXcgUmF5KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuZ2V0Q2FtZXJhKCkuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFBlcnNwZWN0aXZlVmVjdG9yKHggKyByYW5kLCB5ICsgcmFuZClcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyW2ldID0gQ29sb3IuYmxhY2suYWRkKHRoaXMuZ2V0Q29sb3IocmF5KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGNvbXBvbmVudCBpbiB0aGlzLmJ1ZmZlcltpXS5nZXRDb2xvcigpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idWZmZXJbaV1bY29tcG9uZW50XSA9IENvbG9yLnNSR0JFbmNvZGUodGhpcy5idWZmZXJbaV1bY29tcG9uZW50XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKHRoaXMuYnVmZmVyW2ldLmdldENvbG9yKClbJ3JlZCddKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKHRoaXMuYnVmZmVyW2ldLmdldENvbG9yKClbJ2dyZWVuJ10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnB1c2godGhpcy5idWZmZXJbaV0uZ2V0Q29sb3IoKVsnYmx1ZSddKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IobGV0ICBpID0gMDsgaSA8IHRoaXMuYnVmZmVyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmZXJbaV0uZ2V0Q29sb3IoKVsncmVkJ10gPSAwLjA7XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmZXJbaV0uZ2V0Q29sb3IoKVsnZ3JlZW4nXSA9IDAuMDtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlcltpXS5nZXRDb2xvcigpWydibHVlJ10gPSAwLjA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoYnVmZmVyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzZXRTY2VuZSAoc2NlbmU6IFNjZW5lKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTtcbiAgICB9XG59XG5cbm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgdmFyIGRhdGEgPSBtZXNzYWdlLmRhdGE7XG5cbiAgICBpZiAodHlwZW9mKGRhdGEpID09ICdzdHJpbmcnKSB7XG4gICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKCdbJytkYXRhKyddJyk7XG4gICAgfVxuXG4gICAgbGV0IHRyYWNlciA9IG5ldyBUcmFjZXIoKTtcblxuICAgIHRyYWNlci5zZXRTY2VuZShcbiAgICAgICAgbmV3IFNjZW5lKHtcbiAgICAgICAgICAgIGNhbWVyYTogbmV3IENhbWVyYShcbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDAsIDAsIC02OTkpLFxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoMCwgMCwgMSksXG4gICAgICAgICAgICAgICAgZGF0YVswXSxcbiAgICAgICAgICAgICAgICBkYXRhWzFdXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbGlnaHRzOiBbXG4gICAgICAgICAgICAgICAgbmV3IFNwaGVyaWNhbExpZ2h0KG5ldyBWZWN0b3IgKDAsIDYwMCwgMCksIDEsIDEwMClcbiAgICAgICAgICAgICAgICAgICAgLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci53aGl0ZSkpLFxuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmljYWxMaWdodChuZXcgVmVjdG9yICgwLCAwLCAwKSwgMC42LCAxNTApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwobmV3IENvbG9yKG5ldyBSR0JDb2xvcigyNTUsIDIzNSwgMjAwKSkpKVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIG9iamVjdHM6IFtcbiAgICAgICAgICAgICAgICBuZXcgUGxhbmUobmV3IFZlY3RvcigwLCAxLCAwKSwgbmV3IFZlY3RvciAoMCwgLTcwMCwgMCkpLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci53aGl0ZSwgMCkpLFxuICAgICAgICAgICAgICAgIG5ldyBQbGFuZShuZXcgVmVjdG9yKDAsIC0xLCAwKSwgbmV3IFZlY3RvciAoMCwgNzAwLCAwKSkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLndoaXRlLCAwKSksXG4gICAgICAgICAgICAgICAgbmV3IFBsYW5lKG5ldyBWZWN0b3IoLTEsIDAsIDApLCBuZXcgVmVjdG9yICg3MDAsIDAsIDApKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3IuYmx1ZSwgMCkpLFxuICAgICAgICAgICAgICAgIG5ldyBQbGFuZShuZXcgVmVjdG9yKDEsIDAsIDApLCBuZXcgVmVjdG9yICgtNzAwLCAwLCAwKSkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLnJlZCwgMCkpLFxuICAgICAgICAgICAgICAgIG5ldyBQbGFuZShuZXcgVmVjdG9yKDAsIDAsIC0xKSwgbmV3IFZlY3RvciAoMCwgMCwgNzAwKSkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLndoaXRlLCAwKSksXG4gICAgICAgICAgICAgICAgbmV3IFBsYW5lKG5ldyBWZWN0b3IoMCwgMCwgMSksIG5ldyBWZWN0b3IgKDAsIDAsIC03MDApKS5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3IuYmxhY2ssIDApKSxcbiAgICAgICAgICAgICAgICAvLyBib3R0b20gcGxhbmVcbiAgICAgICAgICAgICAgICAvKm5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIDcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci53aGl0ZSwgMCkuc2V0TGFtYmVydENvZWZmKDEpKSxcbiAgICAgICAgICAgICAgICAvLyBmcm9udCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLndoaXRlLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vIHRvcCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKVxuICAgICAgICAgICAgICAgICkuc2V0TWF0ZXJpYWwobmV3IE1hdGVyaWFsKENvbG9yLndoaXRlLCAwKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vcmlnaHQgcGxhbmVcbiAgICAgICAgICAgICAgICBuZXcgUG9seWdvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCAtNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoNzAwLCA3MDAsIDcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci5ibHVlKS5zZXRMYW1iZXJ0Q29lZmYoMSkpLFxuICAgICAgICAgICAgICAgIC8vbGVmdCBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIC03MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIC03MDAsIDcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCA3MDApLFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKC03MDAsIDcwMCwgLTcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci5yZWQsIDApLnNldExhbWJlcnRDb2VmZigxKSksXG4gICAgICAgICAgICAgICAgLy8gYmFjayBwbGFuZVxuICAgICAgICAgICAgICAgIG5ldyBQb2x5Z29uKFxuICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yKDcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgLTcwMCwgLTcwMCksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IoLTcwMCwgNzAwLCAtNzAwKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3Rvcig3MDAsIDcwMCwgLTcwMClcbiAgICAgICAgICAgICAgICApLnNldE1hdGVyaWFsKG5ldyBNYXRlcmlhbChDb2xvci5ibGFjaywgMCkuc2V0TGFtYmVydENvZWZmKDEpKSwqL1xuICAgICAgICAgICAgICAgIG5ldyBTcGhlcmUobmV3IFZlY3RvcigtMjUwLCAtNTAwLCA0NTApLCAyMDApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3IuYmxhY2ssIDEpKSxcbiAgICAgICAgICAgICAgICBuZXcgU3BoZXJlKG5ldyBWZWN0b3IoMjUwLCAtNTAwLCA0MDApLCAyMDApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbChuZXcgTWF0ZXJpYWwoQ29sb3IuZ3JlZW4sIDApKVxuICAgICAgICAgICAgXVxuICAgICAgICB9KVxuICAgICk7XG5cbiAgICB0cmFjZXIucmVuZGVyKGRhdGFbMF0sIGRhdGFbMV0pO1xufTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
